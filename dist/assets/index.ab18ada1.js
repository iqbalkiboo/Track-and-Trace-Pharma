import{_ as ne}from"./t-permission-modal.bdf6acbc.js";import{_ as se}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as le}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as ie,b as ue,E as re,r as u,a1 as ce,f as de,e as pe,aF as O,p as me,o as m,c as $,a as D,k as n,w as s,q as d,t as j,i as t,h as g,j as h,F as z,ah as _e,as as fe,s as ve,v as ge,H as he,I as ke,ak as be,J as ye,K as we}from"./index.21c0d750.js";import{c as V}from"./constant.549d5c21.js";import{m as k}from"./master-mapping-produk.c84c6a61.js";import{A as Ce}from"./AlertCircleOutline.19cf574c.js";import{C as Pe}from"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const xe={class:"body-tnt"},De={class:"card-tnt"},Ve={class:"bottom-action-button"},Me={class:"action-item"},Ee=ie({__name:"index",setup(Be){const b=ue(),w=re(),H=u(),_=u(!1),i=u(!1),c=u(""),J=u({}),M=u({}),B=u([]),F=u([]),l=u({}),R=u(),T=u();T.value={company_id:{required:!0,message:"Company tidak boleh kosong",trigger:["input","blur"]},vendor_id:{required:!0,message:"Vendor tidak boleh kosong",trigger:["input","blur"]},code:{required:!0,message:"Kode Produk Vendor tidak boleh kosong",trigger:["input","blur"]},description:{required:!0,message:"Deskripsi tidak boleh kosong",trigger:["input","blur"]}};const a=u({show:u(!1),icon:ce(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),y=u({show:!1});de(()=>{H.value=pe.getAuth(),b.params.crud=="create"?(c.value="create",O.isGranted(V.accessPrivileges.mappingProduct+".create")?q():y.value.show=!0):(c.value="update",O.isGranted(V.accessPrivileges.mappingProduct+".update")?q():y.value.show=!0)});function Y(){y.value.show=!1}async function q(){c.value=="update"?(N(),U(),await K(),await Q()):(K(),N(),U())}async function Q(){_.value=!0,i.value=!0;const o=b.query.mapping_id;await k.getMappingProductDetail(o).then(e=>{J.value=e.data,W(e.data),_.value=!1,i.value=!1}).catch(e=>{_.value=!1,i.value=!1;const p=e.response.data;w.error(p.message)})}async function K(){_.value=!0,i.value=!0;const o=b.params.id;await k.getProductDetail(o).then(e=>{M.value=e.data,_.value=!1,i.value=!1}).catch(e=>{_.value=!1,i.value=!1;const p=e.response.data;w.error(p.message)})}async function N(){await k.getVendorList({limit:1e4}).then(o=>{o.data.list.forEach(e=>{F.value.push({label:e.name+" - "+e.erp_code,value:e.id})}),a.value.show=!1}).catch(o=>{const e=o.response.data;w.error(e.message)})}async function U(){await k.getCompany({limit:1e4}).then(o=>{o.data.list.forEach(e=>{B.value.push({label:e.name+" - "+e.erp_code,value:e.id})}),a.value.show=!1}).catch(o=>{const e=o.response.data;w.error(e.message)})}function W(o){l.value={company_id:o.company_id,vendor_id:o.vendor.id,code:o.code,description:o.description}}function X(){if(i.value=!0,c.value=="create"){const o={product_id:b.params.id,company_id:l.value.company_id,vendor_id:l.value.vendor_id,code:l.value.code,description:l.value.description};k.saveMappingProduk(o).then(()=>{i.value=!1,v(),setTimeout(()=>{S()},300)}).catch(e=>{const p=e.response.data;i.value=!1,v(),setTimeout(()=>{I(p)},300)})}else{const o=b.query.mapping_id,e={code:l.value.code,description:l.value.description};k.updateMappingProduk(o,e).then(()=>{i.value=!1,v(),setTimeout(()=>{S()},300)}).catch(p=>{const C=p.response.data;i.value=!1,v(),setTimeout(()=>{I(C)},300)})}}async function A(o){var e;o.preventDefault(),await((e=R.value)==null?void 0:e.validate()),Z()}function v(){a.value.show=!1}function Z(){a.value.type="confirm",a.value.hideIcon=!0,a.value.title="Konfirmasi",c.value=="create"?a.value.subtitle="Apakah Anda yakin untuk mapping produk?":a.value.subtitle="Apakah Anda yakin untuk mengubah mapping produk?",a.value.show=!0}function I(o){a.value.type="failed",a.value.hideIcon=!1,a.value.iconColor="#EB5757",a.value.icon=Ce,a.value.title="Gagal",Object.keys(o.validation).length>0?a.value.subtitle=o.validation:a.value.subtitle=o.message,a.value.show=!0}function S(){a.value.type="success",a.value.hideIcon=!1,a.value.iconColor="#219653",a.value.icon=Pe,c.value=="create"?(a.value.title="Berhasil",a.value.subtitle="Berhasil Mapping Produk"):(a.value.title="Berhasil Ubah Data",a.value.subtitle="Berhasil Ubah Data Mapping Produk"),a.value.show=!0}return(o,e)=>{const p=fe,C=ve,P=ge,ee=le,E=he,x=ke,G=be,te=ye,f=we,L=me("router-link"),ae=se,oe=ne;return m(),$(z,null,[D("div",xe,[n(P,{vertical:"",size:0},{default:s(()=>[n(p,{style:{"margin-bottom":"4px"}},{default:s(()=>[d(j(t(M).short_name),1)]),_:1}),n(C,null,{default:s(()=>[d(j(t(M).item_code),1)]),_:1})]),_:1}),D("div",De,[t(_)?(m(),g(ee,{key:0})):(m(),g(P,{key:1,vertical:""},{default:s(()=>[n(P,null,{default:s(()=>[n(C,{strong:"",style:{"font-size":"15px"}},{default:s(()=>[d("Mapping Vendor")]),_:1})]),_:1}),h("",!0),n(te,{ref_key:"formRef",ref:R,class:"form-tnt","show-require-mark":!1,"label-width":80,model:t(l),rules:t(T),style:{"margin-top":"14px"}},{default:s(()=>[n(x,{label:"Pilih Company",path:"company_id"},{default:s(()=>[n(E,{value:t(l).company_id,"onUpdate:value":e[0]||(e[0]=r=>t(l).company_id=r),options:t(B),disabled:t(c)=="update",filterable:"",clearable:"",placeholder:"Pilih Company",class:"select-tnt"},null,8,["value","options","disabled"])]),_:1}),n(x,{label:"Pilih Vendor",path:"vendor_id"},{default:s(()=>[n(E,{value:t(l).vendor_id,"onUpdate:value":e[1]||(e[1]=r=>t(l).vendor_id=r),options:t(F),disabled:t(c)=="update",filterable:"",clearable:"",placeholder:"Pilih Vendor",class:"select-tnt"},null,8,["value","options","disabled"])]),_:1}),n(x,{label:"Kode Produk Vendor",path:"code"},{default:s(()=>[n(G,{value:t(l).code,"onUpdate:value":e[2]||(e[2]=r=>t(l).code=r),placeholder:"Masukkan Kode Produk Vendor"},null,8,["value"])]),_:1}),n(x,{label:"Deskripsi",path:"description"},{default:s(()=>[n(G,{value:t(l).description,"onUpdate:value":e[3]||(e[3]=r=>t(l).description=r),placeholder:"Ketikkan Deskripsi",type:"textarea",autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),D("div",Ve,[D("div",Me,[n(L,{to:"/setting/master-mapping-produk",class:"text-decoration-none"},{default:s(()=>[n(f,{color:"#828282",class:"button-tnt"},{default:s(()=>[d(" Kembali")]),_:1})]),_:1}),t(c)==="create"&&o.$filters.isGranted(t(V).accessPrivileges.mappingProduct+".create")?(m(),g(f,{key:0,color:"#219653",class:"button-tnt",loading:t(i),onClick:A},{default:s(()=>[d(" Simpan ")]),_:1},8,["loading"])):h("",!0),t(c)==="update"&&o.$filters.isGranted(t(V).accessPrivileges.mappingProduct+".update")?(m(),g(f,{key:1,color:"#219653",class:"button-tnt",loading:t(i),onClick:A},{default:s(()=>[d(" Simpan ")]),_:1},8,["loading"])):h("",!0)])])]),n(ae,{show:t(a).show,"onUpdate:show":e[4]||(e[4]=r=>t(a).show=r),icon:t(a).icon,"icon-color":t(a).iconColor,"hide-icon":t(a).hideIcon,title:t(a).title,subtitle:t(a).subtitle},{default:s(()=>[n(P,{justify:"center"},{default:s(()=>[t(a).type=="confirm"?(m(),$(z,{key:0},[n(f,{loading:t(i),color:"#828282",class:"button-tnt",onClick:v},{default:s(()=>[d(" Tutup ")]),_:1},8,["loading"]),n(f,{loading:t(i),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:_e(X,["prevent"])},{default:s(()=>[d(" Yakin ")]),_:1},8,["loading","onClick"])],64)):h("",!0),t(a).type=="success"?(m(),g(L,{key:1,to:{name:"setting-master-mapping-produk"},class:"text-decoration-none"},{default:s(()=>[n(f,{color:"#219653",class:"button-tnt"},{default:s(()=>[d(" Kembali ke Beranda ")]),_:1})]),_:1})):h("",!0),t(a).type=="failed"?(m(),g(f,{key:2,color:"#828282",class:"button-tnt",onClick:v},{default:s(()=>[d(" Tutup ")]),_:1})):h("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),n(oe,{show:t(y).show,"onUpdate:show":e[5]||(e[5]=r=>t(y).show=r),"onClick:close":Y},null,8,["show"])],64)}}});export{Ee as default};
