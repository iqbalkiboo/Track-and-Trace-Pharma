import{_ as fe}from"./t-permission-modal.bdf6acbc.js";import{_ as me}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as pe}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as ke,b as ve,E as ge,r as i,a1 as be,f as ye,aF as Y,p as we,o as r,c as V,a as b,k as o,w as n,q as _,t as N,i as s,h as k,j as v,F as T,g as Q,ah as Ce,af as xe,am as Ee,an as Ae,ak as Re,I as Ve,s as Ne,b1 as Te,bt as Be,v as $e,ad as Fe,ae as De,J as Ue,K as ze}from"./index.21c0d750.js";import{c as F}from"./constant.549d5c21.js";import{a as D}from"./hak-akses.99e628b7.js";import{C as Pe}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Se}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";const Ge={class:"body-tnt"},Le={class:"card-tnt"},He={style:{"margin-top":"5px"}},Me={style:{"text-transform":"capitalize"}},Ie={style:{"text-transform":"capitalize"}},je={class:"bottom-action-button"},Ke={class:"action-item"},oa=ke({__name:"index",setup(Oe){const U=ve(),z=ge(),y=i(!1),h=i(!1),d=i(""),w=i([]),L=i({}),C=i({}),P=i([]),H=i(null),x=i({}),E=i(!1),M=i(),e=i({show:i(!1),icon:be(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),A=i({show:!1});ye(()=>{U.params.crud=="create"?(d.value="create",Y.isGranted(F.accessPrivileges.accessPrivileges+".create")?S():A.value.show=!0):(d.value="update",Y.isGranted(F.accessPrivileges.accessPrivileges+".update")?S():A.value.show=!0)});function W(){A.value.show=!1}async function S(){if(d.value=="update"){y.value=!0;const t=U.params.id;await I(),await D.getDetailRole(t).then(a=>{L.value=a.data,ae(a.data),y.value=!1}).catch(a=>{y.value=!1;const l=a.response.data;z.error(l.message)})}else y.value=!0,await I(),y.value=!1}async function I(){const t={limit:1e3};await D.getPermissionGroup(t).then(a=>{const l=a.data,c=Object.entries(l.list);c.forEach(f=>{f[0]={name:f[0],checked:!1},f[1].forEach(R=>{R.name=f[0].name,R.checked=!1,P.value.push(R)})}),C.value=c}).catch(a=>{const l=a.response.data;z.error(l.message)})}function qe(){E.value?w.value.forEach(t=>t.checked=!0):w.value.forEach(t=>t.checked=!1)}function Je(){const t=i(0);w.value.forEach(a=>{a.checked&&(t.value+=1)}),t.value==w.value.length?E.value=!0:E.value=!1}function X(t,a){const l=C.value[t][1];a.checked?l.forEach(c=>{c.checked=!0}):l.forEach(c=>{c.checked=!1})}function Z(t){const a=C.value[t][0],l=C.value[t][1],c=i(!1);l.forEach(f=>{f.checked&&(c.value=!0)}),c.value?a.checked=!0:a.checked=!1}async function j(t){var a;t.preventDefault(),await((a=H.value)==null?void 0:a.validate().then(()=>{ne()}).catch(()=>{z.error("Form tidak valid, tolong periksa kembali")}))}function ee(){h.value=!0;const t=new FormData;if(t.append("name",x.value.name),P.value.forEach(a=>{a.checked&&t.append("permissions[]",a.id)}),d.value=="create")D.createRole(t).then(()=>{h.value=!1,te(),g(),setTimeout(()=>{K()},300)}).catch(a=>{const l=a.response.data;h.value=!1,g(),setTimeout(()=>{O(l)},300)});else{const a=U.params.id;D.updateRole(a,t).then(()=>{h.value=!1,g(),setTimeout(()=>{K()},300)}).catch(l=>{const c=l.response.data;h.value=!1,g(),setTimeout(()=>{O(c)},300)})}}function ae(t){L.value.permissions.forEach(l=>{P.value.forEach(c=>{if(l.id==c.id)return c.checked=!0})}),C.value.forEach(l=>{l[1].forEach(c=>{c.checked&&c.name==l[0].name&&(l[0].checked=!0)})});const a=i(0);x.value={name:t.name},a.value==w.value.length?E.value=!0:E.value=!1}async function te(){await S(),x.value={name:""},E.value=!1,w.value.forEach(t=>t.checked=!1)}function g(){e.value.show=!1}function ne(){e.value.type="confirm",e.value.hideIcon=!0,e.value.title="Konfirmasi",d.value=="create"?e.value.subtitle="Apakah Anda yakin untuk menambah data hak akses?":e.value.subtitle="Apakah Anda yakin untuk mengubah data hak akses?",e.value.show=!0}function K(){e.value.type="success",e.value.hideIcon=!1,e.value.iconColor="#219653",e.value.icon=Pe,d.value=="create"?(e.value.title="Berhasil Tambah Data",e.value.subtitle="Data hak akses berhasil ditambahkan"):(e.value.title="Berhasil Ubah Data",e.value.subtitle="Data hak akses berhasil diubah"),e.value.show=!0}function O(t){e.value.type="failed",e.value.hideIcon=!1,e.value.iconColor="#EB5757",e.value.icon=Se,e.value.title="Gagal",Object.keys(t.validation).length>0?e.value.subtitle=t.validation:e.value.subtitle=t.message,e.value.show=!0}return M.value={name:{required:!0,message:"Nama hak akses tidak boleh kosong",trigger:"blur"}},(t,a)=>{const l=xe,c=we("router-link"),f=Ee,R=Ae,se=pe,oe=Re,le=Ve,ce=Ne,ie=Te,ue=Be,B=$e,G=Fe,q=De,re=Ue,m=ze,de=me,_e=fe;return r(),V(T,null,[b("div",Ge,[o(l,{style:{"margin-bottom":"4px"}},{default:n(()=>[_(N(s(d)=="create"?"Tambah Hak akses":"Edit Hak akses"),1)]),_:1}),o(R,null,{default:n(()=>[o(f,null,{default:n(()=>[o(c,{to:"/setting/hak-akses",class:"text-decoration-none"},{default:n(()=>[_(" Hak Akses ")]),_:1})]),_:1}),o(f,null,{default:n(()=>[_(N(s(d)=="create"?"Tambah Hak akses":"Edit Hak akses"),1)]),_:1})]),_:1}),b("div",Le,[s(y)?(r(),k(se,{key:0})):(r(),k(B,{key:1,vertical:"",size:24},{default:n(()=>[o(re,{ref_key:"formRef",ref:H,class:"form-tnt",model:s(x),rules:s(M),"show-require-mark":!1},{default:n(()=>[o(le,{path:"name",label:"Nama Hak Akses"},{default:n(()=>[o(oe,{disabled:s(d)==="update",value:s(x).name,"onUpdate:value":a[0]||(a[0]=u=>s(x).name=u),placeholder:"Masukkan Nama Hak Akses"},null,8,["disabled","value"])]),_:1}),b("div",He,[o(B,{vertical:"",size:16},{default:n(()=>[v("",!0),v("",!0)]),_:1}),o(B,{vertical:"",size:16},{default:n(()=>[(r(!0),V(T,null,Q(s(C),(u,$)=>(r(),k(q,{key:$,cols:"6","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:n(()=>[o(G,{span:"6 m:1"},{default:n(()=>[o(ie,{size:"large",checked:u[0].checked,"onUpdate:checked":[p=>u[0].checked=p,p=>X($,u[0])]},{default:n(()=>[o(ce,{style:{"text-transform":"capitalize"}},{default:n(()=>[_(N(u[0].name),1)]),_:2},1024)]),_:2},1032,["checked","onUpdate:checked"])]),_:2},1024),o(G,{span:"6 m:5"},{default:n(()=>[o(q,{cols:"8","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:n(()=>[(r(!0),V(T,null,Q(u[1],(p,he)=>(r(),k(G,{span:"4 m:1",key:he},{default:n(()=>[o(ue,{value:p.checked,"onUpdate:value":[J=>p.checked=J,J=>Z($)]},{checked:n(()=>[b("div",Me,N(p.action),1)]),unchecked:n(()=>[b("div",Ie,N(p.action),1)]),_:2},1032,["value","onUpdate:value"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1},8,["model","rules"])]),_:1}))]),b("div",je,[b("div",Ke,[o(c,{to:{name:"setting-hak-akses"},class:"text-decoration-none"},{default:n(()=>[o(m,{color:"#828282",class:"button-tnt"},{default:n(()=>[_(" Kembali ")]),_:1})]),_:1}),s(d)==="create"&&t.$filters.isGranted(s(F).accessPrivileges.accessPrivileges+".create")?(r(),k(m,{key:0,color:"#219653",class:"button-tnt",loading:s(h),onClick:j},{default:n(()=>[_(" Simpan ")]),_:1},8,["loading"])):v("",!0),s(d)==="update"&&t.$filters.isGranted(s(F).accessPrivileges.accessPrivileges+".update")?(r(),k(m,{key:1,color:"#219653",class:"button-tnt",loading:s(h),onClick:j},{default:n(()=>[_(" Simpan ")]),_:1},8,["loading"])):v("",!0)])])]),o(de,{show:s(e).show,"onUpdate:show":a[3]||(a[3]=u=>s(e).show=u),icon:s(e).icon,"icon-color":s(e).iconColor,"hide-icon":s(e).hideIcon,title:s(e).title,subtitle:s(e).subtitle},{default:n(()=>[o(B,{justify:"center"},{default:n(()=>[s(e).type=="confirm"?(r(),V(T,{key:0},[o(m,{loading:s(h),color:"#828282",class:"button-tnt",onClick:g},{default:n(()=>[_(" Tutup ")]),_:1},8,["loading"]),o(m,{loading:s(h),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Ce(ee,["prevent"])},{default:n(()=>[_(" Yakin ")]),_:1},8,["loading","onClick"])],64)):v("",!0),s(e).type=="success"?(r(),V(T,{key:1},[s(d)=="create"?(r(),k(m,{key:0,color:"#828282",class:"button-tnt",onClick:g},{default:n(()=>[_(" Tambah Lainya ")]),_:1})):v("",!0),o(c,{to:{name:"setting-hak-akses"},class:"text-decoration-none"},{default:n(()=>[o(m,{color:"#219653",class:"button-tnt"},{default:n(()=>[_(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):v("",!0),s(e).type=="failed"?(r(),k(m,{key:2,color:"#828282",class:"button-tnt",onClick:g},{default:n(()=>[_(" Tutup ")]),_:1})):v("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),o(_e,{show:s(A).show,"onUpdate:show":a[4]||(a[4]=u=>s(A).show=u),"onClick:close":W},null,8,["show"])],64)}}});export{oa as default};
