import{d as W,r as f,u as re,E as ne,aI as _e,f as Y,p as we,o as r,h as T,w as t,k as e,q as o,c as I,F as A,g as J,i as n,a,t as i,K as X,v as Z,ag as oe,M as pe,s as se,a7 as Ce,a8 as Oe,b as fe,j as E,ak as Be,S as je,al as Le,as as Ie,ac as Te,N as ie,y as me,aa as ge,ab as ye,_ as Ue,W as Ne,bm as Ke,af as Ae,ad as be,aj as Re,ae as Ee,a9 as Qe,L as Ve}from"./index.21c0d750.js";import{a as K}from"./agregasi.9b2e850f.js";import{_ as de}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{E as ve}from"./EllipsisVertical.56989e7a.js";import{r as De}from"./render-icon.8c81e0de.js";import{T as $e}from"./TrashOutline.31dd934b.js";import{A as F}from"./AddOutline.a2e673de.js";import{h as ae}from"./moment.62d3fb0a.js";import"./getCompanyId.7d0eb93b.js";const He=a("div",{style:{"font-size":"16px","font-weight":"500"}},"Pratinjau",-1),Fe={class:"label"},Ge={class:"label-content"},Je={class:"label-info"},We={class:"qr-box"},Ye={style:{width:"100%",margin:"auto"}},Xe={class:"qr-label"},Ze=a("p",{style:{width:"50%",display:"flex","justify-content":"space-between"},class:"qr-text"},[a("div",null,"Kode DO"),a("div",null,":")],-1),et={style:{width:"60%"},class:"qr-text"},tt={class:"qr-label"},at=a("p",{style:{width:"50%",display:"flex","justify-content":"space-between"},class:"qr-text"},[a("div",null,"ID Packing"),a("div",null,":")],-1),nt={style:{width:"60%"},class:"qr-text"},lt={class:"qr-label"},ot=a("p",{style:{width:"50%",display:"flex","justify-content":"space-between"},class:"qr-text"},[a("div",null,"Tujuan"),a("div",null,":")],-1),st={style:{width:"60%"},class:"qr-text"},it={class:"qr-label"},dt=a("p",{style:{width:"50%",display:"flex","justify-content":"space-between"},class:"qr-text"},[a("div",null,"Alamat"),a("div",null,":")],-1),ct={style:{width:"60%"},class:"qr-text"},ut={class:"label-qr"},rt=W({__name:"t-agregasi-barcode-bulk-produk-modal",props:{show:{type:Boolean,default:!1},title:{},manifest_id:{},detailDO:{}},setup(R){const q=R,b=f({q:"",dir:"desc",page:1,limit:10,manifest_id:q.manifest_id}),g=f(!1),S=f(!1),U=re(),w=ne(),l=f({}),y=f(null);async function D(){q.manifest_id&&(g.value=!0,S.value=!0,await K.getPacking(b.value).then(async k=>{l.value=await k.data,g.value=!1,S.value=!1}).catch(k=>{g.value=!1,S.value=!1,w.error(k)}))}_e(()=>{var k;(k=y.value)==null||k.focus()}),Y(()=>{D()});function j(k){b.value.page=1,b.value.limit=k,D()}async function d(){localStorage.setItem("is_label_open","0"),b.value.limit=1e3,b.value.page=1,D().then(()=>{localStorage.setItem("labels",JSON.stringify(l.value)),localStorage.setItem("label-do",JSON.stringify(q.detailDO));const P=document.createElement("a");P.target="_blank",P.href=U.resolve({name:"print-labels-agregasi"}).href,P.click(),P.remove()});const k={is_printed:!0};try{await K.printManyLabel(k,q.manifest_id)}catch(P){if(P.response){const $=P.response.data.message();w.error($)}}}return(k,P)=>{const $=X,z=Z,B=we("vue-qrcode"),m=oe,_=pe;return r(),T(_,{"mask-closable":!1,show:k.show,"auto-focus":"",preset:"card",role:"dialog",size:"huge",bordered:!1,style:{width:"850px","max-width":"100%","border-radius":"10px"},"onUpdate:show":P[1]||(P[1]=c=>k.$emit("click:close",c))},{default:t(()=>[e(z,{vertical:"",size:14},{default:t(()=>[e(z,{align:"center",justify:"space-between"},{default:t(()=>[He,e($,{type:"primary",onClick:d},{default:t(()=>[o("Cetak Label")]),_:1})]),_:1}),e(z,null,{default:t(()=>[(r(!0),I(A,null,J(n(l).list,(c,x)=>{var M,N,u,v,h,L,p;return r(),I("div",{key:x,class:"label-wrapper"},[a("div",Fe,[a("div",Ge,[a("div",Je,[a("div",We,[a("div",Ye,[a("div",Xe,[Ze,a("p",et,i((M=c.do)==null?void 0:M.code),1)]),a("div",tt,[at,a("p",nt,i(c.code),1)]),a("div",lt,[ot,a("p",st,i((u=(N=k.$props.detailDO)==null?void 0:N.customer)==null?void 0:u.name),1)]),a("div",it,[dt,a("p",ct,i(k.$filters.isEmpty((p=(L=(h=(v=k.$props.detailDO)==null?void 0:v.destination)==null?void 0:h.address)==null?void 0:L.province)==null?void 0:p.name)),1)])])])]),a("div",ut,[e(B,{options:{width:70,margin:0},value:c.code},null,8,["value"])])])])])}),128))]),_:1}),e(z,{justify:"center"},{default:t(()=>[e(m,{page:n(b).page,"onUpdate:page":[P[0]||(P[0]=c=>n(b).page=c),D],"page-count":n(l).total_page,"page-slot":7,"show-size-picker":n(l).total_data>10,"page-sizes":[10,20,30,40,50],"onUpdate:pageSize":j},null,8,["page","page-count","show-size-picker"])]),_:1})]),_:1})]),_:1},8,["show"])}}});const _t=a("div",{style:{"font-size":"16px","font-weight":"500"}},"Pratinjau",-1),pt=W({__name:"t-agregasi-barcode-produk-modal",props:{show:{type:Boolean,default:!1},title:{},packing_id:{},detailDO:{}},emits:["update:show","click:close"],setup(R,{emit:q}){const b=R,g=f(!1),S=f(!1),U=re(),w=f({}),l=ne();async function y(){g.value=!0,S.value=!0,await K.getDetailPacking(b.packing_id).then(async d=>{w.value=d.data,g.value=!1,S.value=!1}).catch(d=>{g.value=!1,S.value=!1,l.error(d)})}_e(()=>{var d;(d=D.value)==null||d.focus()}),Y(()=>{y()});const D=f(null);async function j(){localStorage.setItem("is_label_open","0"),localStorage.setItem("label-detail",JSON.stringify(w.value)),localStorage.setItem("label-do",JSON.stringify(b.detailDO));const d=document.createElement("a");d.target="_blank",d.href=U.resolve({name:"print-labels-agregasi"}).href,d.click(),d.remove();const k={is_printed:!0};try{await K.printLabel(k,b.packing_id)}catch(P){if(P.response){const $=P.response.data.message();l.error($)}}}return(d,k)=>{const P=X,$=Z,z=se,B=Ce,m=we("vue-qrcode"),_=Oe,c=pe;return r(),T(c,{"mask-closable":!1,show:d.show,"auto-focus":"",preset:"card",role:"dialog",size:"huge",bordered:!1,style:{width:"550px","max-width":"100%","border-radius":"10px"},"onUpdate:show":k[0]||(k[0]=x=>d.$emit("click:close",x))},{default:t(()=>[e($,{vertical:"",size:14},{default:t(()=>[e($,{align:"center",justify:"space-between"},{default:t(()=>[_t,e(P,{onClick:j,type:"primary",class:"button-tnt"},{default:t(()=>[o("Cetak Label")]),_:1})]),_:1}),e(_,null,{default:t(()=>[e(B,{span:12},{default:t(()=>[e($,{size:0,vertical:"",justify:"center",class:"card-tnt",style:{"margin-top":"1rem"}},{default:t(()=>[e($,{size:0},{default:t(()=>[e(z,{style:{display:"inline-block",width:"75px"}},{default:t(()=>[o("Kode DO")]),_:1}),e($,null,{default:t(()=>[e(z,null,{default:t(()=>[o(":")]),_:1}),e(z,null,{default:t(()=>{var x,M;return[o(i((M=(x=n(w))==null?void 0:x.do)==null?void 0:M.code),1)]}),_:1})]),_:1})]),_:1}),e($,{size:0},{default:t(()=>[e(z,{style:{display:"inline-block",width:"75px"}},{default:t(()=>[o("ID Packing")]),_:1}),e($,null,{default:t(()=>[e(z,null,{default:t(()=>[o(":")]),_:1}),e(z,null,{default:t(()=>[o(i(n(w).code),1)]),_:1})]),_:1})]),_:1}),e($,{size:0},{default:t(()=>[e(z,{style:{display:"inline-block",width:"75px"}},{default:t(()=>[o("Tujuan")]),_:1}),e($,null,{default:t(()=>[e(z,null,{default:t(()=>[o(":")]),_:1}),e(z,null,{default:t(()=>{var x,M;return[o(i((M=(x=d.$props.detailDO)==null?void 0:x.customer)==null?void 0:M.name),1)]}),_:1})]),_:1})]),_:1}),e($,{size:0},{default:t(()=>[e(z,{style:{display:"inline-block",width:"75px"}},{default:t(()=>[o("Alamat")]),_:1}),e($,null,{default:t(()=>[e(z,null,{default:t(()=>[o(":")]),_:1}),e(z,null,{default:t(()=>{var x,M,N,u;return[o(i(d.$filters.isEmpty((u=(N=(M=(x=d.$props.detailDO)==null?void 0:x.destination)==null?void 0:M.address)==null?void 0:N.province)==null?void 0:u.name)),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e($,{justify:"center"},{default:t(()=>[e(m,{value:n(w).code,options:{errorCorrectionLevel:"Q",width:200}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),ft={style:{"font-weight":"700"}},mt={key:0,class:"table-tnt",style:{"margin-top":"1rem"}},gt=a("thead",null,[a("tr",null,[a("th",null,"ID Serialization"),a("th",null,"Type"),a("th",null,"Item"),a("th",null,"Qty"),a("th",null,"Aksi")])],-1),yt={class:"table-footer"},vt=W({__name:"t-agregasi-add-produk-modal",props:{show:{type:Boolean,default:!1},title:{},packing_id:{},packing_code:{},produk_id:{},data:{},manifest_id:{}},emits:["update:show","click:close","getData","getDo","click:delete"],setup(R,{emit:q}){const b=R,g=f(""),S=ne(),U=fe(),w=f([]),l=f({}),y=f(!1),D=f(!1);_e(()=>{var m;(m=j.value)==null||m.focus()});const j=f(null),d=[{label:"Hapus",key:"delete"}];async function k(){var m;y.value=!0,D.value=!0,(m=j.value)==null||m.focus();try{const _=await K.postProduk({packing_code:b.packing_code,code:g.value});w.value.push(_.data),y.value=!1,D.value=!1,q("getData"),$(),S.success("berhasil"),g.value=""}catch(_){y.value=!1,D.value=!1;const c=_.response.data;S.error(c.message),g.value=""}}function P(){q("click:close",!1),w.value=[],q("getDo")}async function $(){y.value=!0,await K.getDetailDO(U.params.id).then(m=>{l.value=m.data,y.value=!1}).catch(m=>{y.value=!1;const _=m.response.data;S.error(_.message)})}function z(m,_){switch(m){case"delete":{const c=w.value.filter(x=>x.id!==_);w.value=c,B(_);break}}}async function B(m){await K.deleteProduk(m).then(()=>{y.value=!1,q("getData")}).catch(_=>{y.value=!1;const c=_.response.data;S.error(c.message)})}return Y(()=>{$(),w.value=[]}),(m,_)=>{const c=Ie,x=se,M=Z,N=X,u=Te,v=de,h=ie,L=me,p=ge,C=ye,Q=pe;return r(),T(Q,{"mask-closable":!1,show:m.show,preset:"card","auto-focus":"",role:"dialog",size:"huge",bordered:!1,style:{width:"900px","max-width":"100%","border-radius":"10px"},"onUpdate:show":_[1]||(_[1]=O=>m.$emit("click:close",O))},{default:t(()=>[e(M,{justify:"space-between"},{default:t(()=>[e(M,{vertical:"",size:0},{default:t(()=>[e(c,{style:{margin:"0"}},{default:t(()=>[o("Tambah Ke Packing ")]),_:1}),e(x,{style:{margin:"0"}},{default:t(()=>[o("ID DO : "),a("span",null,i(n(l).code),1)]),_:1})]),_:1}),e(M,{vertical:"",size:0},{default:t(()=>[e(x,null,{default:t(()=>[o("Total Qty Pesan :")]),_:1}),a("span",ft,i(n(l).total.qty_packed)+" / "+i(n(l).total.qty_request),1)]),_:1})]),_:1}),e(M,{vertical:"",align:"center",justify:"center",size:14},{default:t(()=>[m.title?(r(),T(c,{key:0,style:{"margin-bottom":"0"}},{default:t(()=>[o(i(m.title),1)]),_:1})):E("",!0),e(M,{vertical:"",align:"center"},{default:t(()=>[e(x,null,{default:t(()=>[o("Silakan masukkan Kode")]),_:1}),e(M,null,{default:t(()=>[e(n(Be),{ref_key:"input",ref:j,value:n(g),"onUpdate:value":_[0]||(_[0]=O=>je(g)?g.value=O:null),placeholder:"Tambah Serialisasi",style:{width:"600px","max-width":"100%"},onKeyup:Le(k,["enter"])},null,8,["value","onKeyup"]),E("",!0)]),_:1})]),_:1}),e(u,{style:{"font-size":"0.8rem"}},{default:t(()=>[o("Atau Scan Kode")]),_:1}),e(N,{type:"primary",class:"button-tnt",onClick:k,disabled:n(g)==="",loading:n(D)},{default:t(()=>[o("Scan Kode")]),_:1},8,["disabled","loading"])]),_:1}),n(w).length>0?(r(),I("div",mt,[n(y)?(r(),T(v,{key:0})):(r(),T(C,{key:1,"x-scrollable":""},{default:t(()=>[e(p,{"single-line":!1},{default:t(()=>[gt,a("tbody",null,[(r(!0),I(A,null,J(n(w),(O,G)=>(r(),I("tr",{key:G},[a("td",null,i(O.serializations.code),1),a("td",null,i(O.serializations.name),1),a("td",null,i(O.serializations.product_name),1),a("td",null,i(O.serializations.qty),1),a("td",null,[e(L,{placement:"bottom-end",options:d,onSelect:V=>z(V,O.id),"show-arrow":""},{default:t(()=>[e(N,{tertiary:""},{icon:t(()=>[e(h,null,{default:t(()=>[e(n(ve))]),_:1})]),_:1})]),_:2},1032,["onSelect"])])]))),128))])]),_:1}),a("div",yt,[e(N,{type:"primary",class:"button-tnt",onClick:P,loading:n(D)},{default:t(()=>[o("Simpan")]),_:1},8,["loading"])])]),_:1}))])):E("",!0)]),_:1},8,["show"])}}}),kt={class:"card-tnt",style:{"border-radius":"12px",background:"#fafafa"}},ht={key:0,class:"card-tnt",style:{"border-radius":"12px"}},bt={class:"table-tnt"},wt=a("thead",null,[a("tr",null,[a("th",null,"ID Serialization"),a("th",null,"Type"),a("th",null,"Item"),a("th",null,"Qty"),a("th",null,"Aksi")])],-1),Dt={class:"table-footer"},$t=W({__name:"t-agregasi-list-produk",props:{packing_id:{},manifest_id:{},typeDisabled:{},packing_code:{},detailDO:{}},emits:["getDo"],setup(R,{emit:q}){const b=R,g=f({q:"",status:"",page:1,sort:"created_at",dir:"desc",limit:5,manifest_packing_id:b.packing_id});function S(){q("getDo")}const U=f(!1),w=f(!1),l=f({}),y=f(!0),D=f(!1),j=f("");async function d(){y.value=!0,D.value=!0,await K.getPackingSerialization(g.value).then(async _=>{l.value=_.data,y.value=!1,D.value=!1,j.value=await _.data.list[0].id}).catch(()=>{y.value=!1,D.value=!1})}const k=[{label:"Hapus",key:"delete",icon:De($e),disabled:b.typeDisabled}];async function P(_){K.deleteProduk(_).then(()=>{y.value=!1,D.value=!1,d()}).catch(()=>{y.value=!1,D.value=!1})}async function $(){U.value=!1,q("getDo")}async function z(){w.value=!1}function B(_){g.value.page=1,g.value.limit=_,d()}function m(_,c){switch(_){case"delete":P(c);break}}return Y(()=>{d()}),(_,c)=>{const x=de,M=ie,N=X,u=me,v=ge,h=ye,L=oe,p=Z,C=vt,Q=pt;return r(),I(A,null,[a("div",kt,[n(l).total_data!==0?(r(),I("div",ht,[a("div",bt,[n(y)?(r(),T(x,{key:0})):(r(),T(h,{key:1,"x-scrollable":""},{default:t(()=>[e(v,{"single-line":!1},{default:t(()=>[wt,a("tbody",null,[(r(!0),I(A,null,J(n(l).list,(O,G)=>{var V;return r(),I("tr",{key:G},[a("td",null,i(O.serializations.code),1),a("td",null,i(O.serializations.name),1),a("td",null,i(O.serializations.product_name),1),a("td",null,i((V=O.serializations)==null?void 0:V.qty),1),a("td",null,[e(u,{placement:"bottom-end",options:k,onSelect:ce=>m(ce,O.id),"show-arrow":""},{default:t(()=>[e(N,{tertiary:""},{icon:t(()=>[e(M,null,{default:t(()=>[e(n(ve))]),_:1})]),_:1})]),_:2},1032,["onSelect"])])])}),128))])]),_:1})]),_:1})),a("div",Dt,[e(L,{page:n(g).page,"onUpdate:page":[c[0]||(c[0]=O=>n(g).page=O),d],"page-count":n(l).total_page,"page-slot":7,"show-size-picker":n(l).total_data>5,"page-sizes":[5,10,20,40,50],"onUpdate:pageSize":B},null,8,["page","page-count","show-size-picker"])])]),n(l).total_data!==0?(r(),T(p,{key:0,style:{"margin-top":"1rem"},justify:"center"},{default:t(()=>[e(N,{quaternary:"",type:"primary",onClick:c[1]||(c[1]=O=>U.value=!0),disabled:_.typeDisabled},{icon:t(()=>[e(M,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o(" Tambah Item")]),_:1},8,["disabled"]),e(N,{quaternary:"",type:"primary",onClick:c[2]||(c[2]=O=>w.value=!0)},{icon:t(()=>[e(M,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o(" Cetak Label Packing")]),_:1})]),_:1})):E("",!0)])):E("",!0),n(l).total_data===0?(r(),T(p,{key:1,justify:"center",align:"center"},{default:t(()=>[e(N,{onClick:c[3]||(c[3]=O=>U.value=!0),type:"primary",loading:!1},{icon:t(()=>[e(M,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o("Tambah Produk ")]),_:1})]),_:1})):E("",!0)]),e(C,{packing_id:b.packing_id,manifest_id:b.manifest_id,produk_id:n(j),packing_code:_.packing_code,show:n(U),onGetData:c[4]||(c[4]=O=>d()),data:n(l),"onClick:close":$,"onClick:delete":P,onGetDo:S},null,8,["packing_id","manifest_id","produk_id","packing_code","show","data"]),e(Q,{show:n(w),packing_id:b.packing_id,detailDO:b.detailDO,"onClick:close":z},null,8,["show","packing_id","detailDO"])],64)}}}),Pt=["onClick"],zt=W({__name:"t-agregasi-list-packing",props:{id_manifest:{},total:{},totalPacking:{},typeDisabled:{},detailDO:{}},emits:["getDo","getDataManifest"],setup(R,{emit:q}){const b=R,g=f({q:"",dir:"desc",page:1,limit:10,manifest_id:b.id_manifest});function S(){q("getDo")}const U=ne(),w=fe(),l=f({}),y=f({}),D=f(!0),j=f(!1),d=f(!1);async function k(){D.value=!0,d.value=!0,await K.getPacking(g.value).then(B=>{const m=B.data.list.map(_=>({..._,active:!1}));y.value=B.data,l.value=m,D.value=!1,d.value=!1}).catch(()=>{D.value=!1,d.value=!1})}async function P(){b.total.qty_packed>=b.total.qty_request?U.error("Maaf, tidak bisa menambah packing karena pesanan sudah penuh"):(D.value=!0,d.value=!0,await K.postPacking({do_id:w.params.id,manifest_id:b.id_manifest}).then(()=>{k(),q("getDataManifest"),D.value=!1,d.value=!1}).catch(B=>{D.value=!1,d.value=!1;const m=B.response.data;U.error(m.message)}))}function $(B){g.value.page=1,g.value.limit=B,k()}async function z(){j.value=!1}return Y(()=>{b.totalPacking<=0?P():k()}),(B,m)=>{const _=se,c=Z,x=X,M=de,N=$t,u=Ue,v=oe,h=ie,L=rt;return r(),I(A,null,[e(c,{justify:"space-between",align:"center"},{default:t(()=>[e(c,{vertical:""},{default:t(()=>[e(_,{strong:"",style:{"font-size":"14px",opacity:"0.8","margin-bottom":"0"}},{default:t(()=>[o("Daftar Packing")]),_:1})]),_:1}),n(l).length>0?(r(),T(x,{key:0,type:"info",class:"button-tnt",tertiary:"",onClick:m[0]||(m[0]=p=>j.value=!0)},{default:t(()=>[o("Bulk Cetak Label Packing")]),_:1})):E("",!0)]),_:1}),n(l).length>0?(r(),T(c,{key:0,vertical:"",size:10,style:{"margin-top":"1rem"}},{default:t(()=>[n(D)?(r(),T(M,{key:0})):(r(!0),I(A,{key:1},J(n(l),(p,C)=>(r(),I("div",{class:"card-tnt card-box-tnt",style:{background:"#eee","margin-top":"0","border-radius":"12px"},key:C},[e(c,{justify:"space-between"},{default:t(()=>[e(_,null,{default:t(()=>[o("ID Packing: "+i(p.code),1)]),_:2},1024),p.total.qty>0?(r(),I("div",{key:0,class:"text_link",onClick:Q=>p.active=!p.active},i(p.active?"Tampilkan lebih sedikit":"Detail"),9,Pt)):E("",!0)]),_:2},1024),e(u,{show:p.total.qty>0?p.active:!0},{default:t(()=>[e(N,{packing_id:p.id,packing_code:p.code,manifest_id:b.id_manifest,typeDisabled:B.typeDisabled,detailDO:b.detailDO,onGetDo:S},null,8,["packing_id","packing_code","manifest_id","typeDisabled","detailDO"])]),_:2},1032,["show"])]))),128)),e(c,{justify:"center"},{default:t(()=>[e(v,{page:n(g).page,"onUpdate:page":[m[1]||(m[1]=p=>n(g).page=p),k],"page-count":n(y).total_page,"page-slot":7,"show-size-picker":n(y).total_data>10,"page-sizes":[10,20,30,40,50],"onUpdate:pageSize":$},null,8,["page","page-count","show-size-picker"])]),_:1}),e(x,{type:"primary",class:"button-tnt",quaternary:"",loading:n(d),onClick:P,disabled:B.typeDisabled},{icon:t(()=>[e(h,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o(" Tambah Packing ")]),_:1},8,["loading","disabled"])]),_:1})):(r(),T(c,{key:1,justify:"center"},{default:t(()=>[e(x,{type:"primary",class:"button-tnt",loading:n(d),onClick:P,disabled:B.typeDisabled},{icon:t(()=>[e(h,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o("Tambah Packing ")]),_:1},8,["loading","disabled"])]),_:1})),e(L,{show:n(j),manifest_id:n(g).manifest_id,detailDO:b.detailDO,"onClick:close":z},null,8,["show","manifest_id","detailDO"])],64)}}}),Mt={class:"body-tnt"},St=a("span",null,"Estimasi Pengiriman : ",-1),xt=a("span",null,"Estimasi Sampai : ",-1),qt=a("span",null,"Status : ",-1),Ct={class:"card-tnt"},Ot={class:"table-tnt"},Bt=a("thead",null,[a("tr",null,[a("th",{style:{"text-align":"center"}},"NO"),a("th",null,"Kode Produk"),a("th",null,"Nama Produk"),a("th",null,"Building"),a("th",null,"Room"),a("th",null,"Rack"),a("th",null,"Bin"),a("th",null,"Batch"),a("th",null,"Exp Date"),a("th",null,"Qty Pesan"),a("th",null,"Qty Packing")])],-1),jt={"data-label":"No",style:{"text-align":"center"}},Lt={"data-label":"Kode Produk"},It={"data-label":"Nama Produk"},Tt={"data-label":"Building"},Ut={"data-label":"Room"},Nt={"data-label":"Rack"},Kt={"data-label":"Bin"},At={"data-label":"Batch"},Rt={"data-label":"Exp Date"},Et={"data-label":"Qty Pesan"},Qt={"data-label":"Qty Packing"},Vt={class:"card-tnt"},Ht={class:"bottom-action-button"},Ft={class:"action-item"},na=W({__name:"add",setup(R){const q=fe(),b=re(),g=f({q:"",page:1,limit:10,sort:"desc",do_id:q.params.id}),S=ne(),U=f(!0),w=f(!1),l=f({}),y=f({}),D=f(!1),j=f({delivery_date:null,target_delivery_date:null});f(q.params.type);const d=Ne(()=>l.value.is_done);function k(u){var L;const v=parseInt((L=u.customer)==null?void 0:L.standart_sla),h=ae(u.do_date).add(v,"d");j.value={delivery_date:u.set_delivery_date||ae(u.do_date).format("yyyy-MM-DD"),target_delivery_date:u.set_delivered_date||ae(h).format("yyyy-MM-DD")}}async function P(){U.value=!0,w.value=!0,await K.getDetailDO(q.params.id).then(u=>{var v,h;l.value=u.data,k(l.value),((h=(v=l==null?void 0:l.value)==null?void 0:v.total)==null?void 0:h.manifest)<=0?z():$()}).catch(u=>{U.value=!1,w.value=!1;const v=u.response.data;S.error(v.message)})}async function $(){D.value=!0,w.value=!0,await K.getManifest(g.value).then(u=>{y.value=u.data,D.value=!1,w.value=!1}).catch(u=>{D.value=!1,w.value=!1;const v=u.response.data;S.error(v.message)}).finally(()=>{U.value=!1})}async function z(){D.value=!0,w.value=!0,await K.postManifest({do_id:q.params.id}).then(()=>{w.value=!1,$()}).catch(u=>{D.value=!1,w.value=!1;const v=u.response.data;S.error(v.message)})}async function B(){if(y.value.total_data>0){const u=await j.value,v={delivery_date:u.delivery_date,target_delivery_date:u.target_delivery_date};await K.updateManifestDate(v,q.params.id).then(()=>{}).catch(h=>{const L=h.response.data;S.error(L.message)})}else j.value={target_delivery_date:null,delivery_date:null},S.error("Anda Harus Menambahkan Manifest")}async function m(){(l.value.set_delivery_date===""||l.value.set_delivered_date==="")&&await B(),_()}async function _(){const u=await y.value.list.some(h=>(h.total.packing===0&&S.error(`Anda Harus Menambahkan Packing Di Manifest ${h.code}`),h.total.packing===0)),v=await y.value.list.some(h=>(h.total.qty===0&&S.error(`Anda Harus Menambahkan Produk Di Manifest ${h.code}`),h.total.qty===0));if(!u&&!v)try{await K.decreaseStock(q.params.id),b.push({name:"pengiriman-id-list-manifest",params:{id:q.params.id}})}catch(h){if(h.response){const L=h.response.data.message;S.error(L)}}}function c(u){g.value.page=1,g.value.limit=u,$()}const x=u=>[{label:"Delete",key:"delete",icon:De($e),disabled:u}];async function M(u,v){switch(u){case"delete":await K.deleteManifest(v).then(()=>{P()}).catch(h=>{if(h.response){const L=h.response.data.message;S.error(L)}});break}}function N(){b.go(-1)}return Y(()=>{P()}),(u,v)=>{const h=de,L=Ae,p=se,C=Z,Q=be,O=Re,G=Ee,V=be,ce=Qe,Pe=ge,ze=ye,ue=ie,ee=X,Me=me,Se=zt,xe=Ve,qe=oe;return r(),I("div",Mt,[n(U)?(r(),T(h,{key:0})):(r(),I(A,{key:1},[e(G,{cols:"3","item-responsive":"",responsive:"screen","x-gap":"16","y-gap":"16"},{default:t(()=>[e(V,{span:"3 m:1"},{default:t(()=>[e(L,{style:{"margin-bottom":"16px"}},{default:t(()=>{var s;return[o("Kode DO: "+i((s=n(l))==null?void 0:s.code),1)]}),_:1}),e(C,{vertical:"",size:15},{default:t(()=>[e(C,{align:"center"},{default:t(()=>[e(p,null,{default:t(()=>[o(" Created BY : ")]),_:1}),e(p,null,{default:t(()=>{var s,H,te,le,ke,he;return[o(i((H=(s=n(l))==null?void 0:s.created_by)!=null&&H.is_superadmin?(le=(te=n(l).created_by)==null?void 0:te.superadmin)==null?void 0:le.name:(he=(ke=n(l).created_by)==null?void 0:ke.user)==null?void 0:he.name),1)]}),_:1})]),_:1}),e(C,{align:"center"},{default:t(()=>[e(p,null,{default:t(()=>[o(" Tanggal DO : ")]),_:1}),e(p,null,{default:t(()=>{var s;return[o(i(n(ae)((s=n(l))==null?void 0:s.do_date).format("yyyy-MM-DD")),1)]}),_:1})]),_:1}),e(C,{vertical:"",size:0},{default:t(()=>[e(G,{cols:"2"},{default:t(()=>[e(Q,null,{default:t(()=>[e(C,{vertical:""},{default:t(()=>[e(p,{style:{"margin-bottom":"0"}},{default:t(()=>[St]),_:1}),e(p,{style:{"margin-bottom":"0"}},{default:t(()=>[xt]),_:1})]),_:1})]),_:1}),e(Q,null,{default:t(()=>[e(C,null,{default:t(()=>[e(O,{clearable:"","formatted-value":n(j).delivery_date,"onUpdate:formattedValue":v[0]||(v[0]=s=>n(j).delivery_date=s),"onUpdate:value":B,"value-format":"yyyy-MM-dd",type:"date"},null,8,["formatted-value"]),e(O,{clearable:"","formatted-value":n(j).target_delivery_date,"onUpdate:formattedValue":v[1]||(v[1]=s=>n(j).target_delivery_date=s),"onUpdate:value":B,type:"date"},null,8,["formatted-value"])]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{align:"center"},{default:t(()=>[e(p,null,{default:t(()=>[o(" Total Qty Pesan : ")]),_:1}),e(p,null,{default:t(()=>{var s;return[o(i((s=n(l).total)==null?void 0:s.qty_request),1)]}),_:1})]),_:1}),e(C,{align:"center"},{default:t(()=>[e(p,null,{default:t(()=>[o(" Berat : ")]),_:1}),e(p,null,{default:t(()=>[o(i(n(l).weight),1)]),_:1})]),_:1}),e(C,{align:"center"},{default:t(()=>[e(p,null,{default:t(()=>[o(" Volume : ")]),_:1}),e(p,null,{default:t(()=>[o(i(n(l).volume)+" cm3",1)]),_:1})]),_:1})]),_:1})]),_:1}),e(V,{span:"3 m:1"},{default:t(()=>[e(L,{style:{"margin-bottom":"16px"}},{default:t(()=>{var s;return[o("Tujuan: "+i((s=n(l).customer)==null?void 0:s.name),1)]}),_:1}),o(" ID Customer: "),e(p,null,{default:t(()=>{var s;return[o(i((s=n(l).customer)==null?void 0:s.erp_code),1)]}),_:1}),e(C,{vertical:"",size:15},{default:t(()=>[e(C,{vertical:"",size:0},{default:t(()=>[e(p,{style:{"margin-bottom":"0"}},{default:t(()=>{var s;return[o(i(u.$filters.setAddress((s=n(l).destination)==null?void 0:s.address)),1)]}),_:1})]),_:1}),e(C,{vertical:"",size:0},{default:t(()=>[e(p,{style:{"margin-bottom":"0"}},{default:t(()=>[qt,e(ce,{type:"info",round:""},{default:t(()=>[o(i(n(l).status),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a("div",Ct,[a("div",Ot,[e(ze,{"x-scrollable":""},{default:t(()=>[e(Pe,{"single-line":!1},{default:t(()=>[Bt,a("tbody",null,[(r(!0),I(A,null,J(n(l).products,(s,H)=>(r(),I("tr",{key:H},[a("td",jt,i(H+1),1),a("td",Lt,i(s.code),1),a("td",It,i(s.name),1),a("td",Tt,i(s.warehouse_building.erp_code),1),a("td",Ut,i(s.warehouse_room.erp_code),1),a("td",Nt,i(s.warehouse_rack.erp_code),1),a("td",Kt,i(s.warehouse_bin.code),1),a("td",At,i(s.batch),1),a("td",Rt,i(s.expired_date?n(ae)(s.expired_date).format("yyyy-MM-DD"):"-"),1),a("td",Et,i(s.qty_request),1),a("td",Qt,i(s.qty_packed),1)]))),128))])]),_:1})]),_:1})])]),a("div",Vt,[n(y).total_data===0?(r(),T(C,{key:0,justify:"center"},{default:t(()=>[e(ee,{class:"button-tnt",type:"primary",loading:n(w),onClick:z,disabled:n(d)},{icon:t(()=>[e(ue,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o("Tambah Manifest ")]),_:1},8,["loading","disabled"])]),_:1})):(r(),I(A,{key:1},[e(C,{vertical:""},{default:t(()=>[n(U)?(r(),T(h,{key:0})):(r(),I(A,{key:1},[e(Ke,{name:"list",tag:"div"},{default:t(()=>[(r(!0),I(A,null,J(n(y).list,(s,H)=>(r(),T(xe,{key:H,style:{"border-radius":"12px","margin-bottom":"1rem"}},{default:t(()=>[e(C,{vertical:""},{default:t(()=>{var te;return[e(C,{vertical:""},{default:t(()=>[e(C,{align:"center",justify:"space-between"},{default:t(()=>[e(p,null,{default:t(()=>[o("ID Manifest : "+i(s.code),1)]),_:2},1024),e(Me,{options:x(n(d)),onSelect:le=>M(le,s.id)},{default:t(()=>[e(ee,{tertiary:"",style:{padding:"0"}},{icon:t(()=>[e(ue,null,{default:t(()=>[e(n(ve))]),_:1})]),_:1})]),_:2},1032,["options","onSelect"])]),_:2},1024)]),_:2},1024),e(Se,{id_manifest:s.id,total:n(l).total,totalPacking:(te=s.total)==null?void 0:te.packing,typeDisabled:n(d),detailDO:n(l),onGetDo:P,onGetDataManifest:$},null,8,["id_manifest","total","totalPacking","typeDisabled","detailDO"])]}),_:2},1024)]),_:2},1024))),128))]),_:1}),n(y).total_data>0?(r(),T(ee,{key:0,onClick:z,quaternary:"",class:"button-tnt",type:"primary",disabled:n(d)},{icon:t(()=>[e(ue,null,{default:t(()=>[e(n(F))]),_:1})]),default:t(()=>[o("Tambah Manifest ")]),_:1},8,["disabled"])):E("",!0)],64))]),_:1}),e(C,{justify:"center"},{default:t(()=>[e(qe,{page:n(g).page,"onUpdate:page":[v[2]||(v[2]=s=>n(g).page=s),$],"page-count":n(y).total_page,"page-slot":7,"show-size-picker":n(y).total_data>10,"page-sizes":[10,20,30,40,50],"onUpdate:pageSize":c},null,8,["page","page-count","show-size-picker"])]),_:1})],64))]),a("div",Ht,[a("div",Ft,[e(ee,{onClick:N,class:"button-tnt",style:{width:"120px"},color:"#828282"},{default:t(()=>[o("Kembali")]),_:1}),n(l).weight>0&&n(l).total_data!==0?(r(),T(ee,{key:0,type:"primary",onClick:v[3]||(v[3]=s=>m()),class:"button-tnt",style:{width:"120px"}},{default:t(()=>[o("Selesai")]),_:1})):E("",!0)])])],64))])}}});export{na as default};
