import{_ as ve}from"./t-permission-modal.bdf6acbc.js";import{_ as _e}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as fe}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as be,b as he,E as ke,r as p,a1 as ye,f as we,e as Pe,aF as Q,p as De,o as v,c as A,a as U,k as n,w as o,q as m,t as F,i as a,h as b,j as y,F as I,ah as Ue,af as Ce,am as Le,an as xe,ak as Ee,I as Ke,s as Te,H as Ve,K as Me,aM as qe,R as Ae,bq as Fe,v as Ie,J as Se}from"./index.21c0d750.js";import{c as x}from"./constant.549d5c21.js";import{o as E}from"./option.2657b089.js";import{s as Ne}from"./storage.731d7fd8.js";import{m as S}from"./master-threepl.f4c7982d.js";import{C as $e}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Be}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const Oe={class:"body-tnt"},Re={class:"card-tnt"},je=U("div",{class:"divider-horizontal-tnt",style:{"border-color":"#dfdfdf","margin-top":"5px"}},null,-1),He={class:"bottom-action-button"},ze={class:"action-item"},ia=be({__name:"index",setup(Ge){const K=he(),h=ke(),C=p(),L=p(!1),c=p(!1),g=p(""),T=p([]),V=p([]),M=p([]),q=p([]),N=p(null),t=p({image:{id:"",url:""},status:1}),$=p(!0),W=[{label:"Aktif",value:1},{label:"Tidak Aktif",value:0}],i=p({show:p(!1),icon:ye(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),B=p(),P=p({show:!1});we(()=>{C.value=Pe.getAuth(),K.params.crud=="create"?(g.value="create",Q.isGranted(x.accessPrivileges.threepl+".create")?O():P.value.show=!0):(g.value="update",Q.isGranted(x.accessPrivileges.threepl+".update")?O():P.value.show=!0)});function X(){P.value.show=!1}async function O(){if(g.value=="update"){L.value=!0;const l=K.params.id;await R(),await j(),await H(),await z(),await S.getDetailThreepl(l).then(e=>{le(e.data),L.value=!1}).catch(e=>{L.value=!1;const r=e.response.data;h.error(r.message)})}else await R()}async function R(){t.value.province=null;const l={limit:1e3};await E.getProvinces(l).then(e=>{T.value=[],e.data.list.forEach(u=>{T.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;h.error(r.message)})}async function j(){t.value.district=null;const l={limit:1e3,province_id:t.value.province};await E.getDistricts(l).then(e=>{V.value=[],e.data.list.forEach(u=>{V.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;h.error(r.message)})}async function H(){t.value.subDistrict=null;const l={limit:1e3,district_id:t.value.district};await E.getSubDistricts(l).then(e=>{M.value=[],e.data.list.forEach(u=>{M.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;h.error(r.message)})}async function z(){t.value.urbanVillage=null;const l={limit:1e3,sub_district_id:t.value.subDistrict};await E.getUrbanVillages(l).then(e=>{q.value=[],e.data.list.forEach(u=>{q.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;h.error(r.message)})}async function ee(l){var r;return["image/png","image/jpeg"].indexOf(String((r=l.file.file)==null?void 0:r.type))===-1?(h.error("Format gambar harus png atau jpg, tolong upload ulang"),!1):!0}function ae({file:l,onFinish:e}){c.value=!0;const r=new FormData;r.append("file",l.file),r.append("source","upload"),r.append("title",l.name),r.append("caption",l.name),r.append("alt",l.name),Ne.uploadStorage(r).then(u=>{t.value.image.id=u.data.data.id,t.value.image.url=u.data.data.public_url,c.value=!1,e()}).catch(u=>{const w=u.response.data;h.error(w.message),c.value=!1,e()})}async function G(l){var e;l.preventDefault(),await((e=N.value)==null?void 0:e.validate().then(()=>{oe()}).catch(()=>{h.error("Form tidak valid, tolong periksa kembali")}))}function te(){c.value=!0;let l="";C.value.xxtype==="5up3r4dm1n"?l=C.value["xx-usertype-access"].holding_id:l=C.value.users.user_type.id;const e=new FormData;if(e.append("holding_id",l),e.append("media_id",t.value.image.id),e.append("name",t.value.name),e.append("api_key",t.value.apiKey),e.append("phone",t.value.phone),e.append("email",t.value.email),e.append("province_id",t.value.province),e.append("district_id",t.value.district),e.append("sub_district_id",t.value.subDistrict),e.append("urban_village_id",t.value.urbanVillage),e.append("address",t.value.address),e.append("langitude",t.value.longitude),e.append("latitude",t.value.latitude),e.append("pic_name",t.value.pic),e.append("status",t.value.status),e.append("erp_code",t.value.erp_code),g.value=="create")S.createThreepl(e).then(()=>{c.value=!1,ne(),k(),setTimeout(()=>{Z()},300)}).catch(r=>{const u=r.response.data;c.value=!1,k(),setTimeout(()=>{J(u)},300)});else{const r=K.params.id;S.updateThreepl(r,e).then(()=>{c.value=!1,k(),setTimeout(()=>{Z()},300)}).catch(u=>{const w=u.response.data;c.value=!1,k(),setTimeout(()=>{J(w)},300)})}}function le(l){t.value={name:l.name,apiKey:l.api_key,phone:l.phone,email:l.email,province:l.address.province.id,district:l.address.district.id,subDistrict:l.address.sub_district.id,urbanVillage:l.address.urban_village.id,address:l.address.detail,longitude:l.location.coordinates[1],latitude:l.location.coordinates[0],image:{id:l.image.id,url:l.image.url},pic:l.pic_name,status:l.status.value,erp_code:l.erp_code}}function ne(){t.value={name:"",apiKey:"",phone:"",email:"",province:null,district:null,subDistrict:null,urbanVillage:null,address:"",longitude:0,latitude:0,image:{id:"",url:""},pic:"",status:null,erp_code:""}}function k(){i.value.show=!1}function oe(){i.value.type="confirm",i.value.hideIcon=!0,i.value.title="Konfirmasi",g.value=="create"?i.value.subtitle="Apakah Anda yakin untuk menambah data 3PL?":i.value.subtitle="Apakah Anda yakin untuk mengubah data 3PL?",i.value.show=!0}function Z(){i.value.type="success",i.value.hideIcon=!1,i.value.iconColor="#219653",i.value.icon=$e,g.value=="create"?(i.value.title="Berhasil Tambah Data",i.value.subtitle="Data 3PL berhasil ditambahkan"):(i.value.title="Berhasil Ubah Data",i.value.subtitle="Data 3PL berhasil diubah"),i.value.show=!0}function J(l){i.value.type="failed",i.value.hideIcon=!1,i.value.iconColor="#EB5757",i.value.icon=Be,i.value.title="Gagal",Object.keys(l.validation).length>0?i.value.subtitle=l.validation:i.value.subtitle=l.message,i.value.show=!0}return B.value={name:{required:!0,message:"Nama 3PL tidak boleh kosong",trigger:["input","blur"]},apiKey:{required:!0,message:"API key tidak boleh kosong",trigger:["input","blur"]},phone:{required:!0,validator(l,e){if(e)if(/^\d*$/.test(e)){if(e.length<8)return new Error("No. Hp kurang dari 8 angka")}else return new Error("No. Hp harus angka");else return new Error("No. Hp tidak boleh kosong");return!0},trigger:["input","blur"]},email:{required:!0,validator(l,e){const r=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(e){if(!e.match(r))return new Error("Email tidak valid")}else return new Error("Email tidak boleh kosong");return!0},trigger:["input","blur"]},province:{required:!0,message:"Provinsi tidak boleh kosong",trigger:["input","blur"]},district:{required:!0,message:"Kota/Kabupaten tidak boleh kosong",trigger:["input","blur"]},subDistrict:{required:!0,message:"Kecamatan tidak boleh kosong",trigger:["input","blur"]},urbanVillage:{required:!0,message:"Kelurahan tidak boleh kosong",trigger:["input","blur"]},address:{required:!0,message:"Keterangan alamat tidak boleh kosong",trigger:["input","blur"]},longitude:{required:!0,validator(l,e){if(!e)return new Error("Longitude tidak boleh kosong");if(String(e).includes(","))return new Error("Longitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Longitude harus angka atau tidak valid")},trigger:["input","blur"]},latitude:{required:!0,validator(l,e){if(!e)return new Error("Latitude tidak boleh kosong");if(String(e).includes(","))return new Error("Latitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Latitude harus angka atau tidak valid")},trigger:["input","blur"]},pic:{required:!0,message:"PIC tidak boleh kosong",trigger:["input","blur"]},status:{type:"number",required:!0,message:"Status tidak boleh kosong",trigger:["input","blur"]},erp_code:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:["input","blur"]}},(l,e)=>{const r=Ce,u=De("router-link"),w=Le,ie=xe,se=fe,f=Ee,d=Ke,re=Te,D=Ve,_=Me,ue=qe,de=Ae,pe=Fe,Y=Ie,ce=Se,me=_e,ge=ve;return v(),A(I,null,[U("div",Oe,[n(r,{style:{"margin-bottom":"4px"}},{default:o(()=>[m(F(a(g)=="create"?"Tambah 3PL":"Ubah 3PL"),1)]),_:1}),n(ie,null,{default:o(()=>[n(w,null,{default:o(()=>[n(u,{to:"/setting/master-threepl",class:"text-decoration-none"},{default:o(()=>[m(" Master 3PL ")]),_:1})]),_:1}),n(w,null,{default:o(()=>[m(F(a(g)=="create"?"Tambah 3PL":"Ubah 3PL"),1)]),_:1})]),_:1}),U("div",Re,[a(L)?(v(),b(se,{key:0})):(v(),b(ce,{key:1,ref_key:"formRef",ref:N,class:"form-tnt",model:a(t),rules:a(B),"show-require-mark":!1},{default:o(()=>[n(d,{path:"name",label:"Nama 3PL"},{default:o(()=>[n(f,{value:a(t).name,"onUpdate:value":e[0]||(e[0]=s=>a(t).name=s),placeholder:"Masukkan nama 3PL"},null,8,["value"])]),_:1}),n(d,{path:"apiKey",label:"API Key"},{default:o(()=>[n(f,{value:a(t).apiKey,"onUpdate:value":e[1]||(e[1]=s=>a(t).apiKey=s),placeholder:"Masukkan API key"},null,8,["value"])]),_:1}),n(d,{label:"No. Hp",path:"phone"},{default:o(()=>[n(f,{value:a(t).phone,"onUpdate:value":e[2]||(e[2]=s=>a(t).phone=s),placeholder:"Masukkan nomer handphone"},null,8,["value"])]),_:1}),n(d,{label:"Email",path:"email"},{default:o(()=>[n(f,{readonly:a($),onFocus:e[3]||(e[3]=s=>$.value=!1),value:a(t).email,"onUpdate:value":e[4]||(e[4]=s=>a(t).email=s),placeholder:"Masukkan email"},null,8,["readonly","value"])]),_:1}),je,n(re,{style:{display:"block","font-weight":"500",margin:"10px 0 15px 0"}},{default:o(()=>[m("Alamat ")]),_:1}),n(d,{label:"Provinsi",path:"province"},{default:o(()=>[n(D,{value:a(t).province,"onUpdate:value":[e[5]||(e[5]=s=>a(t).province=s),j],options:a(T),filterable:"",placeholder:"Pilih provinsi"},null,8,["value","options"])]),_:1}),n(d,{label:"Kota/Kabupaten",path:"district"},{default:o(()=>[n(D,{value:a(t).district,"onUpdate:value":[e[6]||(e[6]=s=>a(t).district=s),H],options:a(V),filterable:"",placeholder:"Pilih kota/kabupaten"},null,8,["value","options"])]),_:1}),n(d,{label:"Kecamatan",path:"subDistrict"},{default:o(()=>[n(D,{value:a(t).subDistrict,"onUpdate:value":[e[7]||(e[7]=s=>a(t).subDistrict=s),z],options:a(M),filterable:"",placeholder:"Pilih kecamatan"},null,8,["value","options"])]),_:1}),n(d,{label:"Kelurahan",path:"urbanVillage"},{default:o(()=>[n(D,{value:a(t).urbanVillage,"onUpdate:value":e[8]||(e[8]=s=>a(t).urbanVillage=s),options:a(q),filterable:"",placeholder:"Pilih kelurahan"},null,8,["value","options"])]),_:1}),n(d,{label:"Keterangan Alamat (Nama jalan dan No. Bangunan)",path:"address"},{default:o(()=>[n(f,{value:a(t).address,"onUpdate:value":e[9]||(e[9]=s=>a(t).address=s),placeholder:"Masukkan keterangan alamat"},null,8,["value"])]),_:1}),n(d,{label:"Longitude",path:"longitude"},{default:o(()=>[n(f,{value:a(t).longitude,"onUpdate:value":e[10]||(e[10]=s=>a(t).longitude=s),style:{width:"100%"},placeholder:"Masukkan longitude"},null,8,["value"])]),_:1}),n(d,{label:"Latitude",path:"latitude"},{default:o(()=>[n(f,{value:a(t).latitude,"onUpdate:value":e[11]||(e[11]=s=>a(t).latitude=s),style:{width:"100%"},placeholder:"Masukkan latitude"},null,8,["value"])]),_:1}),n(d,{label:"Upload Logo","show-feedback":!1},{default:o(()=>[n(ue,{action:"",onBeforeUpload:ee,"show-file-list":!1,"custom-request":ae},{default:o(()=>[n(_,{loading:a(c),color:"#219653",class:"button-tnt"},{default:o(()=>[m(F(a(g)=="create"?"Upload Logo":"Ubah Logo"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(c)?(v(),b(Y,{key:1,size:8},{default:o(()=>[n(pe,{height:"90px",width:"96px"})]),_:1})):(v(),b(de,{key:0,width:"110",src:a(t).image.url,style:{"margin-top":"10px","border-radius":"12px"}},null,8,["src"])),n(d,{label:"PIC",path:"pic",style:{"margin-top":"15px"}},{default:o(()=>[n(f,{value:a(t).pic,"onUpdate:value":e[12]||(e[12]=s=>a(t).pic=s),placeholder:"Masukkan PIC"},null,8,["value"])]),_:1}),n(d,{label:"Kode ERP",path:"erp_code",style:{"margin-top":"15px"}},{default:o(()=>[n(f,{value:a(t).erp_code,"onUpdate:value":e[13]||(e[13]=s=>a(t).erp_code=s),placeholder:"Kode ERP"},null,8,["value"])]),_:1}),n(d,{label:"Status",path:"status"},{default:o(()=>[n(D,{value:a(t).status,"onUpdate:value":e[14]||(e[14]=s=>a(t).status=s),options:W,filterable:"",placeholder:"Pilih Status"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),U("div",He,[U("div",ze,[n(u,{to:{name:"setting-master-threepl"},class:"text-decoration-none"},{default:o(()=>[n(_,{color:"#828282",class:"button-tnt"},{default:o(()=>[m("Kembali")]),_:1})]),_:1}),a(g)==="create"&&l.$filters.isGranted(a(x).accessPrivileges.threepl+".create")?(v(),b(_,{key:0,color:"#219653",class:"button-tnt",loading:a(c),onClick:G},{default:o(()=>[m(" Simpan ")]),_:1},8,["loading"])):y("",!0),a(g)==="update"&&l.$filters.isGranted(a(x).accessPrivileges.threepl+".update")?(v(),b(_,{key:1,color:"#219653",class:"button-tnt",loading:a(c),onClick:G},{default:o(()=>[m(" Simpan ")]),_:1},8,["loading"])):y("",!0)])])]),n(me,{show:a(i).show,"onUpdate:show":e[15]||(e[15]=s=>a(i).show=s),icon:a(i).icon,"icon-color":a(i).iconColor,"hide-icon":a(i).hideIcon,title:a(i).title,subtitle:a(i).subtitle},{default:o(()=>[n(Y,{justify:"center"},{default:o(()=>[a(i).type=="confirm"?(v(),A(I,{key:0},[n(_,{loading:a(c),color:"#828282",class:"button-tnt",onClick:k},{default:o(()=>[m(" Tutup ")]),_:1},8,["loading"]),n(_,{loading:a(c),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Ue(te,["prevent"])},{default:o(()=>[m(" Yakin ")]),_:1},8,["loading","onClick"])],64)):y("",!0),a(i).type=="success"?(v(),A(I,{key:1},[a(g)=="create"?(v(),b(_,{key:0,color:"#828282",class:"button-tnt",onClick:k},{default:o(()=>[m(" Tambah Lainya ")]),_:1})):y("",!0),a(g)=="update"?(v(),b(_,{key:1,color:"#828282",class:"button-tnt",onClick:k},{default:o(()=>[m(" Tutup ")]),_:1})):y("",!0),n(u,{to:{name:"setting-master-threepl"},class:"text-decoration-none"},{default:o(()=>[n(_,{color:"#219653",class:"button-tnt"},{default:o(()=>[m(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):y("",!0),a(i).type=="failed"?(v(),b(_,{key:2,color:"#828282",class:"button-tnt",onClick:k},{default:o(()=>[m(" Tutup ")]),_:1})):y("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),n(ge,{show:a(P).show,"onUpdate:show":e[16]||(e[16]=s=>a(P).show=s),"onClick:close":X},null,8,["show"])],64)}}});export{ia as default};
