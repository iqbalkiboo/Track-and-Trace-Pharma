import{_ as be}from"./t-permission-modal.bdf6acbc.js";import{_ as he}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as ke}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as ye,b as we,E as Ce,r as d,f as Te,e as Ee,aF as Y,Q as X,N as Pe,a1 as Ue,p as De,o as g,c as V,a as E,k as l,w as o,q as p,t as ee,i as a,h as C,j as h,F as I,ah as Se,af as Me,am as Ne,an as xe,K as Ae,v as Fe,ak as qe,I as Ke,H as Be,s as Ve,J as Ie}from"./index.21c0d750.js";import{c as D}from"./constant.549d5c21.js";import{m as $}from"./master-customer.9a7cd6cf.js";import{m as $e}from"./master-customer-category.438843cd.js";import{o as S}from"./option.2657b089.js";import{_ as Le}from"./modal-add-customer-category.vue_vue_type_script_setup_true_lang.79aa60a7.js";import{A as Oe}from"./Add.4f3b52cf.js";import{C as Re}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as je}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const Ge={class:"body-tnt"},ze={class:"card-tnt"},He=E("div",{class:"divider-horizontal-tnt",style:{"border-color":"#DFDFDF","margin-top":"10px"}},null,-1),Ze={class:"bottom-action-button"},Je={class:"action-item"},ca=ye({__name:"index",setup(Qe){const M=we(),k=Ce(),P=d(),U=d(!1),v=d(!1),m=d(""),N=d([]),x=d([]),A=d([]),F=d([]),ae=d([{label:"Aktif",value:1},{label:"Tidak Aktif",value:0}]),t=d({status:1}),L=d(),O=d();O.value={name:{required:!0,message:"Nama customer tidak boleh kosong",trigger:["input","blur"]},customer_category:{required:!0,message:"Tipe customer tidak boleh kosong",trigger:["input","blur"]},province_id:{required:!0,message:"Provinsi tidak boleh kosong",trigger:["input","blur"]},district_id:{required:!0,message:"Kota/Kabupaten tidak boleh kosong",trigger:["input","blur"]},sub_district_id:{required:!0,message:"Kecamatan tidak boleh kosong",trigger:["input","blur"]},urban_village_id:{required:!0,message:"Kelurahan tidak boleh kosong",trigger:["input","blur"]},address:{required:!0,message:"Keterangan alamat tidak boleh kosong",trigger:["input","blur"]},langitude:{required:!0,validator(n,e){if(!e)return new Error("Longitude tidak boleh kosong");if(e.includes(","))return new Error("Longitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Longitude harus angka atau tidak valid")},trigger:["input","blur"]},latitude:{required:!0,validator(n,e){if(!e)return new Error("Latitude tidak boleh kosong");if(e.includes(","))return new Error("Latitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Latitude harus angka atau tidak valid")},trigger:["input","blur"]},erp_code:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:["input","blur"]},bpom_destination_id:{required:!0,message:"Tujuan BPOM tidak boleh kosong",trigger:["input","blur"]},pic_name:{required:!0,message:"Nama PIC tidak boleh kosong",trigger:["input","blur"]},pic_phone:{required:!0,validator(n,e){if(e)if(/^\d*$/.test(e)){if(e.length<8)return new Error("No. Hp kurang dari 8 angka")}else return new Error("No. Telp harus angka");else return new Error("No. Telp tidak boleh kosong");return!0},trigger:["input","blur"]},pic_email:{required:!0,validator(n,e){const r=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(e){if(!e.match(r))return new Error("Email tidak valid")}else return new Error("Email tidak boleh kosong");return!0},trigger:["input","blur"]},status:{type:"number",required:!0,message:"Status tidak boleh kosong",trigger:["input","blur"]},standart_sla:{required:!0,validator(n,e){if(!e)return new Error("Standar SLA tidak boleh kosong");if(!/^[0-9]*$/.test(e))return new Error("Standar SLA harus angka atau tidak valid")},trigger:["input","blur"]}};const q=d([]),K=d(!1),te=d(),T=d({show:!1});Te(()=>{P.value=Ee.getAuth(),M.params.crud=="create"?(m.value="create",Y.isGranted(D.accessPrivileges.customer+".create")?R():T.value.show=!0):(m.value="update",Y.isGranted(D.accessPrivileges.customer+".update")?R():T.value.show=!0)});function ne(){T.value.show=!1}async function R(){if(m.value=="update"){U.value=!0;const n=M.params.id;await j(),await G(),await z(),await H(),await B(""),await $.getDetailCustomer(n).then(e=>{oe(e.data),console.log(e.data),U.value=!1}).catch(e=>{U.value=!1;const r=e.response.data;k.error(r.message)})}else await j(),await B("")}async function j(){t.value.province_id=null;const n={limit:1e3};await S.getProvinces(n).then(e=>{A.value=[],e.data.list.forEach(u=>{A.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;k.error(r.message)})}async function G(){t.value.district_id=null;const n={limit:1e3,province_id:t.value.province_id};await S.getDistricts(n).then(e=>{N.value=[],e.data.list.forEach(u=>{N.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;k.error(r.message)})}async function z(){t.value.sub_district_id=null;const n={limit:1e3,district_id:t.value.district_id};await S.getSubDistricts(n).then(e=>{x.value=[],e.data.list.forEach(u=>{x.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;k.error(r.message)})}async function H(){t.value.urban_village_id=null;const n={limit:1e3,sub_district_id:t.value.sub_district_id};await S.getUrbanVillages(n).then(e=>{F.value=[],e.data.list.forEach(u=>{F.value.push({label:u.name,value:u.id})})}).catch(e=>{const r=e.response.data;k.error(r.message)})}async function B(n){t.value.customer=null;const e={limit:1e3};await $e.getCustomerCategory(e).then(r=>{q.value=[{key:"add",value:"add",label:()=>X("span",{style:{color:"#0B8F9D",fontWeight:600}},[X(Pe,{component:Oe}),"Tambah Tipe Customer"])}];const u=r.data.data.list;u.forEach(f=>{q.value.push({key:f.name,label:f.name,value:f.id})}),n==="after_create"&&(t.value.customer_category=u[r.data.data.list.length-1].id)}).catch(r=>{const u=r.response.data;k.error(u.message)})}function le(){v.value=!0;let n="";P.value.xxtype==="5up3r4dm1n"?n=P.value["xx-usertype-access"].company_id:n=P.value.users.user_type.id;const e=new FormData;if(e.append("company_id",n),e.append("name",t.value.name),e.append("customer_category",t.value.customer_category),e.append("province_id",t.value.province_id),e.append("district_id",t.value.district_id),e.append("sub_district_id",t.value.sub_district_id),e.append("urban_village_id",t.value.urban_village_id),e.append("address",t.value.address),e.append("latitude",t.value.latitude),e.append("langitude",t.value.langitude),e.append("erp_code",t.value.erp_code),e.append("bpom_destination_id",t.value.bpom_destination_id),e.append("pic_name",t.value.pic_name),e.append("pic_phone",t.value.pic_phone),e.append("pic_email",t.value.pic_email),e.append("status",t.value.status),e.append("standart_sla",t.value.standart_sla),m.value=="create")$.createCustomer(e).then(()=>{v.value=!1,ie(),y(),setTimeout(()=>{Z()},300)}).catch(r=>{const u=r.response.data;v.value=!1,y(),setTimeout(()=>{J(u)},300)});else{const r=M.params.id;$.updateCustomer(r,e).then(()=>{v.value=!1,y(),setTimeout(()=>{Z()},300)}).catch(u=>{const f=u.response.data;v.value=!1,y(),setTimeout(()=>{J(f)},300)})}}function oe(n){t.value={name:n.name,customer_category:n.customers_category.id,province_id:n.address.province.id,district_id:n.address.district.id,sub_district_id:n.address.sub_district.id,urban_village_id:n.address.urban_village.id,address:n.address.detail,latitude:String(n.location.coordinates[0]),langitude:String(n.location.coordinates[1]),erp_code:n.erp_code,bpom_destination_id:n.bpom_destination_id,pic_name:n.pic.name,pic_phone:n.pic.phone,pic_email:n.pic.email,status:n.status.value,standart_sla:n.standart_sla}}function ie(){t.value={name:"",customer_category:null,province_id:null,district_id:null,sub_district_id:null,urban_village:null,address:"",langitude:"",latitude:"",imageUrl:"",erp_code:"",bpom_destination_id:"",pic_name:"",pic_phone:"",pic_email:"",status:null,standart_sla:""}}function se(){K.value=!1}const s=d({show:d(!1),icon:Ue(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""});function y(){s.value.show=!1}function re(){s.value.type="confirm",s.value.hideIcon=!0,s.value.title="Konfirmasi",m.value=="create"?s.value.subtitle="Apakah Anda yakin untuk menambah data customer?":s.value.subtitle="Apakah Anda yakin untuk mengubah data customer?",s.value.show=!0}function Z(){s.value.type="success",s.value.hideIcon=!1,s.value.iconColor="#219653",s.value.icon=Re,m.value=="create"?(s.value.title="Berhasil Tambah Data",s.value.subtitle="Data customer berhasil ditambahkan"):(s.value.title="Berhasil Ubah Data",s.value.subtitle="Data customer berhasil diubah"),s.value.show=!0}function J(n){s.value.type="failed",s.value.hideIcon=!1,s.value.iconColor="#EB5757",s.value.icon=je,s.value.title="Gagal",Object.keys(n.validation).length>0?s.value.subtitle=n.validation:s.value.subtitle=n.message,s.value.show=!0}async function Q(n){var e;n.preventDefault(),await((e=L.value)==null?void 0:e.validate().then(()=>{re()}).catch(()=>{k.error("Form tidak valid, tolong periksa kembali")}))}function ue(n){n&&(te.value=t.value.userType)}function de(n){n=="add"&&ce()}function ce(){K.value=!0}return(n,e)=>{const r=Me,u=De("router-link"),f=Ne,pe=xe,b=Ae,W=Fe,me=ke,_=qe,c=Ke,w=Be,_e=Ve,ve=Ie,ge=he,fe=be;return g(),V(I,null,[E("div",Ge,[l(r,{style:{"margin-bottom":"4px"}},{default:o(()=>[p(ee(a(m)=="create"?"Tambah Customer":"Edit Customer"),1)]),_:1}),l(pe,null,{default:o(()=>[l(f,null,{default:o(()=>[l(u,{to:"/setting/master-customer",class:"text-decoration-none"},{default:o(()=>[p(" Master Customer ")]),_:1})]),_:1}),l(f,null,{default:o(()=>[p(ee(a(m)=="create"?"Tambah Customer":"Edit Customer"),1)]),_:1})]),_:1}),E("div",ze,[l(W,null,{default:o(()=>[h("",!0)]),_:1}),h("",!0),a(U)?(g(),C(me,{key:1})):(g(),C(ve,{key:2,ref_key:"formRef",ref:L,model:a(t),rules:a(O),"show-require-mark":!1,class:"form-tnt"},{default:o(()=>[l(c,{path:"name",label:"Nama Customer"},{default:o(()=>[l(_,{value:a(t).name,"onUpdate:value":e[0]||(e[0]=i=>a(t).name=i),placeholder:"Masukkan Nama Customer"},null,8,["value"])]),_:1}),l(c,{path:"customerType",label:"Tipe Customer"},{default:o(()=>[l(w,{value:a(t).customer_category,"onUpdate:value":[e[1]||(e[1]=i=>a(t).customer_category=i),de],options:a(q),placeholder:"Tentukan Tipe Customer","onUpdate:show":ue},null,8,["value","options"])]),_:1}),He,l(_e,{style:{display:"block","font-weight":"500",margin:"10px 0 15px 0"}},{default:o(()=>[p("Alamat Customer")]),_:1}),l(c,{label:"Provinsi",path:"province_id"},{default:o(()=>[l(w,{value:a(t).province_id,"onUpdate:value":[e[2]||(e[2]=i=>a(t).province_id=i),G],options:a(A),filterable:"",placeholder:"Pilih provinsi"},null,8,["value","options"])]),_:1}),l(c,{label:"Kota/Kabupaten",path:"district_id"},{default:o(()=>[l(w,{value:a(t).district_id,"onUpdate:value":[e[3]||(e[3]=i=>a(t).district_id=i),z],options:a(N),filterable:"",placeholder:"Pilih kota/kabupaten"},null,8,["value","options"])]),_:1}),l(c,{label:"Kecamatan",path:"sub_district_id"},{default:o(()=>[l(w,{value:a(t).sub_district_id,"onUpdate:value":[e[4]||(e[4]=i=>a(t).sub_district_id=i),H],options:a(x),filterable:"",placeholder:"Pilih kecamatan"},null,8,["value","options"])]),_:1}),l(c,{label:"Kelurahan",path:"urban_village_id"},{default:o(()=>[l(w,{value:a(t).urban_village_id,"onUpdate:value":e[5]||(e[5]=i=>a(t).urban_village_id=i),options:a(F),filterable:"",placeholder:"Pilih kecamatan"},null,8,["value","options"])]),_:1}),l(c,{label:"Keterangan Alamat (Nama jalan dan No. Bangunan)",path:"address"},{default:o(()=>[l(_,{value:a(t).address,"onUpdate:value":e[6]||(e[6]=i=>a(t).address=i),placeholder:"Masukkan keterangan alamat"},null,8,["value"])]),_:1}),l(c,{label:"Longitude",path:"langitude"},{default:o(()=>[l(_,{value:a(t).langitude,"onUpdate:value":e[7]||(e[7]=i=>a(t).langitude=i),placeholder:"Masukkan longitude"},null,8,["value"])]),_:1}),l(c,{label:"Latitude",path:"latitude"},{default:o(()=>[l(_,{value:a(t).latitude,"onUpdate:value":e[8]||(e[8]=i=>a(t).latitude=i),placeholder:"Masukkan latitude"},null,8,["value"])]),_:1}),l(c,{path:"erp_code",label:"Kode ERP"},{default:o(()=>[l(_,{value:a(t).erp_code,"onUpdate:value":e[9]||(e[9]=i=>a(t).erp_code=i),placeholder:"Masukkan Kode ERP"},null,8,["value"])]),_:1}),l(c,{path:"bpom_destination_id",label:"ID Tujuan BPOM"},{default:o(()=>[l(_,{value:a(t).bpom_destination_id,"onUpdate:value":e[10]||(e[10]=i=>a(t).bpom_destination_id=i),placeholder:"Masukkan Kode ERP"},null,8,["value"])]),_:1}),l(c,{path:"pic_name",label:"Nama PIC"},{default:o(()=>[l(_,{value:a(t).pic_name,"onUpdate:value":e[11]||(e[11]=i=>a(t).pic_name=i),placeholder:"Masukkan Nama PIC"},null,8,["value"])]),_:1}),l(c,{path:"pic_phone",label:"No. Telp PIC"},{default:o(()=>[l(_,{value:a(t).pic_phone,"onUpdate:value":e[12]||(e[12]=i=>a(t).pic_phone=i),placeholder:"Masukkan No. Telp"},null,8,["value"])]),_:1}),l(c,{path:"pic_email",label:"Email PIC"},{default:o(()=>[l(_,{value:a(t).pic_email,"onUpdate:value":e[13]||(e[13]=i=>a(t).pic_email=i),placeholder:"Masukkan Email"},null,8,["value"])]),_:1}),l(c,{path:"status",label:"Status"},{default:o(()=>[l(w,{value:a(t).status,"onUpdate:value":e[14]||(e[14]=i=>a(t).status=i),options:a(ae),placeholder:"Pilih Status User",style:{width:"100%"}},null,8,["value","options"])]),_:1}),l(c,{path:"standart_sla",label:"Standart Sla"},{default:o(()=>[l(_,{value:a(t).standart_sla,"onUpdate:value":e[15]||(e[15]=i=>a(t).standart_sla=i),placeholder:"Masukkan Standart Sla",style:{width:"50%"}},{suffix:o(()=>[p(" hari ")]),_:1},8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),E("div",Ze,[E("div",Je,[l(u,{to:{name:"setting-master-customer"},class:"text-decoration-none"},{default:o(()=>[l(b,{color:"#828282",class:"button-tnt"},{default:o(()=>[p("Kembali")]),_:1})]),_:1}),a(m)==="create"&&n.$filters.isGranted(a(D).accessPrivileges.customer+".create")?(g(),C(b,{key:0,color:"#219653",class:"button-tnt",loading:a(v),onClick:Q},{default:o(()=>[p(" Simpan ")]),_:1},8,["loading"])):h("",!0),a(m)==="update"&&n.$filters.isGranted(a(D).accessPrivileges.customer+".update")?(g(),C(b,{key:1,color:"#219653",class:"button-tnt",loading:a(v),onClick:Q},{default:o(()=>[p(" Simpan ")]),_:1},8,["loading"])):h("",!0)])])]),l(Le,{"is-show-modal":a(K),onFetchData:e[16]||(e[16]=i=>B("after_create")),onHideModal:se},null,8,["is-show-modal"]),l(ge,{show:a(s).show,"onUpdate:show":e[17]||(e[17]=i=>a(s).show=i),icon:a(s).icon,"icon-color":a(s).iconColor,"hide-icon":a(s).hideIcon,title:a(s).title,subtitle:a(s).subtitle},{default:o(()=>[l(W,{justify:"center"},{default:o(()=>[a(s).type=="confirm"?(g(),V(I,{key:0},[l(b,{loading:a(v),color:"#828282",class:"button-tnt",onClick:y},{default:o(()=>[p(" Tutup ")]),_:1},8,["loading"]),l(b,{loading:a(v),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Se(le,["prevent"])},{default:o(()=>[p(" Yakin ")]),_:1},8,["loading","onClick"])],64)):h("",!0),a(s).type=="success"?(g(),V(I,{key:1},[a(m)=="create"?(g(),C(b,{key:0,color:"#828282",class:"button-tnt",onClick:y},{default:o(()=>[p(" Tambah Lainya ")]),_:1})):h("",!0),l(u,{to:{name:"setting-master-customer"},class:"text-decoration-none"},{default:o(()=>[l(b,{color:"#219653",class:"button-tnt"},{default:o(()=>[p(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):h("",!0),a(s).type=="failed"?(g(),C(b,{key:2,color:"#828282",class:"button-tnt",onClick:y},{default:o(()=>[p(" Tutup ")]),_:1})):h("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),l(fe,{show:a(T).show,"onUpdate:show":e[18]||(e[18]=i=>a(T).show=i),"onClick:close":ne},null,8,["show"])],64)}}});export{ca as default};
