import{d as ie,E as ue,r as g,p as J,o as p,h as z,w as t,k as e,a as h,c as F,F as j,g as O,i as l,q as n,K as re,v as de,M as Te,b as Ie,u as $e,f as Fe,W as Le,t as _,j as E,S as Re,s as je,as as Be,ad as le,ae as Ne,_ as Ue,ab as Ve,ak as Ae,R as qe}from"./index.21c0d750.js";import{_ as Ge}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as Ke}from"./t-product-location-modal.vue_vue_type_script_setup_true_lang.ce2f4aa0.js";import{_ as Ye}from"./t-table-packing-penerimaan.vue_vue_type_script_setup_true_lang.eeb8e0cd.js";import{_ as He}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as Ee,h as Je,i as Oe,e as We,j as Qe}from"./reception.0ba4dd71.js";import{s as se}from"./storage.731d7fd8.js";import{t as w,h as Xe}from"./feedback.0313b46e.js";import{h as Ze}from"./moment.62d3fb0a.js";import"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";const et={style:{border:"solid 1px #eee",overflow:"hidden"}},tt=ie({__name:"t-modal-signature",props:{show:{type:Boolean},formValue:{}},emits:["click:close","handleSetImageSignature"],setup(ce,{expose:N,emit:U}){N({clearSign:B});const W=ue(),P=g(!1),c={width:500,height:200},k=g([]),T=g(),I=()=>{P.value=!1},L=()=>{var v,S;P.value=!0;const u=(S=(v=T.value)==null?void 0:v.getStage())==null?void 0:S.getPointerPosition();P.value&&(k.value=[...k.value,{points:[u==null?void 0:u.x,u==null?void 0:u.y],color:"#000",mode:"brush"}])},V=()=>{var S,$;if(!P.value)return;const u=($=(S=T.value)==null?void 0:S.getStage())==null?void 0:$.getPointerPosition(),v=k.value[k.value.length-1];v.points=v.points.concat([u.x,u.y]),k.value.splice(k.value.length-1,1,v),k.value=k.value.concat()};function R(u){U("handleSetImageSignature",u)}const q=async()=>{var u;if(k.value.length>0){const v=(u=T.value)==null?void 0:u.getStage().toDataURL({pixelRatio:2}),$=await(await fetch(v)).blob(),A=new File([$],"sign.png",{type:"image/png"});R(A),U("click:close",!1)}else W.error("Gambar tidak boleh kosong")};function B(){k.value=[]}return(u,v)=>{const S=J("v-line"),$=J("v-layer"),A=J("v-stage"),G=re,K=de,Y=Te;return p(),z(Y,{show:u.show,preset:"card",title:"Masukkan Tanda Tangan Anda",style:{"max-width":"500px"},"onUpdate:show":v[0]||(v[0]=b=>u.$emit("click:close",b))},{default:t(()=>[e(K,{vertical:""},{default:t(()=>[h("div",et,[e(A,{ref_key:"stage",ref:T,config:c,onTouchstart:L,onTouchmove:V,onMousedown:L,onMousemove:V,onTouchend:I,onMouseup:I},{default:t(()=>[e($,null,{default:t(()=>[(p(!0),F(j,null,O(l(k),b=>(p(),z(S,{key:b==null?void 0:b.points,config:{points:b==null?void 0:b.points,stroke:b==null?void 0:b.color,strokeWidth:3,lineCap:"round",globalCompositeOperation:b.mode=="erase"?"destination-out":"source-over"}},null,8,["config"]))),128))]),_:1})]),_:1},512)]),e(K,{justify:"center",style:{"margin-top":"1rem"}},{default:t(()=>[e(G,{onClick:q,type:"primary",secondary:"",strong:"",class:"button-tnt"},{default:t(()=>[n(" Simpan ")]),_:1}),e(G,{onClick:B,secondary:"",strong:"",class:"button-tnt"},{default:t(()=>[n(" Hapus ")]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])}}}),at={class:"body-tnt"},nt=h("div",null,null,-1),ot={style:{"margin-top":"18px"}},lt={class:"card-tnt",style:{border:"1px solid #e5e5e5","margin-top":"0",padding:"8px","text-align":"center"}},st={class:"card-tnt",style:{border:"1px solid #e5e5e5","margin-top":"0",padding:"8px","text-align":"center"}},it={class:"card-tnt",style:{border:"1px solid #e5e5e5","margin-top":"0",padding:"8px","text-align":"center"}},ut={class:"card-tnt"},rt=["onClick"],dt={class:"text_link"},ct=["onClick"],_t=["onClick"],pt=["multiple"],ft={class:"bottom-action-button"},gt={class:"action-item"},Mt=ie({__name:"form",setup(ce){const N=ue(),U=Ie(),W=$e(),P=g(!1),c=g({}),k=g(),T=g(!1),I=g(!1),L=g(null),V=g(null),R=g(!1),q=g(null),B=g(),u=g({images:[],signature:{}}),v=g(!1),S=g(null);Fe(()=>{$()});async function $(){P.value=!0,await G(),await Y(),P.value=!1}async function A(s){return u.value={desc:s.description,gr:s.gr_number,images:s.images||[],signature:s.signature||{}}}async function G(){const s=await Ee(U.params.id);c.value=s.data,await A(s.data.finish_info),B.value={page:1,limit:10,reception_id:c.value.id,company_id:""}}function K(){w.value.type="konfirmasi",w.value.hideIcon=!0,w.value.iconColor="#219653",w.value.title="Konfirmasi",w.value.subtitle="Apakah Anda yakin untuk mengkonfirmasi form data?",w.value.show=!0}async function Y(){if(B.value){const s=await Je(B.value);q.value=s.data}}async function b(s){s.active=!s.active}function _e(s,r){V.value=s,L.value=r,I.value=!0}async function pe(s){L.value?(await Oe({warehouse_building_id:s,reception_id:U.params.id,packing_code:V.value.packing.code,product_code:L.value.code,company_id:""}),await Y(),N.success("Lokasi produk berhasil diperbarui."),I.value=!1):N.error("Tidak ada produk yang dipilih!")}async function fe(s){s.active=!s.active,s.active&&(s.loading=!0,await ge(1,s),s.loading=!1)}async function ge(s,r){var o;const a=await We({page:(o=r.page)!=null?o:1,limit:10,product_code:r.code,reception_code:c==null?void 0:c.value.code});r.serialize=a.data.list,r.page=a.data.page,r.total_page=a.data.total_page}async function me(s){const a=s.target.files;if(console.log(a),a==null)return;const o=[];for(const C of a){const x=new FormData;x.append("file",C,C.name),x.append("source","upload"),x.append("title",C.name),x.append("caption",C.name),x.append("alt",C.name);const{data:y}=await se.uploadStorage(x);o.push({id:y.data.id,type:"image",url:y.data.public_url})}v.value?o.map(C=>{u.value.images.push(C)}):u.value.signature=o[0]}function ve(){v.value=!0,setTimeout(()=>{var s;(s=S.value)==null||s.click()},100)}const ye=g(!1);async function he(){var x;ye.value=!1,R.value=!0;const s=new Date,r=s.getFullYear(),a=(s.getMonth()+1).toString().padStart(2,"0"),o=s.getDate().toString().padStart(2,"0"),C=`${r}-${a}-${o}`;try{await Qe({reception_id:c.value.id,finished_date:C,description:u.value.desc,images:u.value.images.map(y=>y.id),signature:(x=u.value.signature)==null?void 0:x.id,gr_number:u.value.gr,company_id:""}),W.push({name:"penerimaan-reception"}),R.value=!1}catch(y){N.error(y),R.value=!1}}const ke=Le(()=>{var s,r;return(r=(s=c.value)==null?void 0:s.products)==null?void 0:r.reduce((a,o)=>a+o.qty,0)});function be(){T.value=!1}async function we(s){const r=new FormData;r.append("file",s),r.append("source","upload"),r.append("title",s.name),r.append("caption",s.name),r.append("alt",s.name);const{data:a}=await se.uploadStorage(r);u.value.signature={id:a.data.id,type:"image",url:a.data.public_url}}function xe(){k.value.clearSign(),u.value.signature={}}return(s,r)=>{var te,ae,ne;const a=je,o=de,C=Be,x=He,y=le,Q=Ne,D=re,Se=Ye,X=Ue,Ce=Ve,Z=Ae,H=le,ee=qe,De=J("router-link"),Me=Ke,ze=Ge,Pe=tt;return p(),F(j,null,[h("div",at,[e(o,{justify:"space-between"},{default:t(()=>[e(o,{vertical:"",size:0},{default:t(()=>[e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("ID Manifest : ")]),_:1}),e(a,{strong:""},{default:t(()=>{var i;return[n(_((i=l(c).manifest)==null?void 0:i.code),1)]}),_:1})]),_:1}),e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("ID DO : ")]),_:1}),e(a,{strong:""},{default:t(()=>{var i;return[n(_((i=l(c).do)==null?void 0:i.code),1)]}),_:1})]),_:1}),e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Total Item : ")]),_:1}),e(a,{strong:""},{default:t(()=>[n(_(l(ke)),1)]),_:1})]),_:1})]),_:1}),e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Tujuan : ")]),_:1}),e(a,{strong:""},{default:t(()=>{var i,f;return[n(_(((f=(i=l(c).do)==null?void 0:i.destination)==null?void 0:f.name)||"-"),1)]}),_:1})]),_:1}),nt]),_:1}),e(C,{style:{"margin-bottom":"4px"}},{default:t(()=>[n(" Daftar Packing ")]),_:1}),l(P)?(p(),z(x,{key:0})):(p(),F(j,{key:1},[h("div",ot,[e(Q,{cols:"3","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:t(()=>[e(y,{span:"3 m:1"},{default:t(()=>[h("div",lt,[e(a,{style:{"font-size":"13px","margin-bottom":"0"}},{default:t(()=>{var i;return[n("Aproved ("+_(((i=l(c).total)==null?void 0:i.approved)||0)+")",1)]}),_:1})])]),_:1}),e(y,{span:"3 m:1"},{default:t(()=>[h("div",st,[e(a,{style:{"font-size":"13px","margin-bottom":"0"}},{default:t(()=>{var i;return[n("Broken ("+_(((i=l(c).total)==null?void 0:i.broken)||0)+")",1)]}),_:1})])]),_:1}),e(y,{span:"3 m:1"},{default:t(()=>[h("div",it,[e(a,{style:{"font-size":"13px","margin-bottom":"0"}},{default:t(()=>{var i;return[n("Missing ("+_(((i=l(c).total)==null?void 0:i.missing)||0)+")",1)]}),_:1})])]),_:1})]),_:1})]),h("div",ut,[e(o,{vertical:"",size:16},{default:t(()=>{var i,f;return[(p(!0),F(j,null,O((f=(i=l(q))==null?void 0:i.list)!=null?f:[],m=>(p(),F("div",{class:"card-tnt",key:m.id,style:{padding:"1.2rem","margin-top":"0","border-radius":"12px","background-color":"#eee"}},[e(o,{wrap:!1,justify:"space-between",align:"center",style:{position:"relative"}},{default:t(()=>[e(o,{vertical:"",size:0},{default:t(()=>[e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Packing Code : ")]),_:1}),e(a,{strong:""},{default:t(()=>[n(_(m.packing.code),1)]),_:2},1024)]),_:2},1024),e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n(" Jenis Product : ")]),_:1}),e(a,{strong:""},{default:t(()=>{var d;return[n(_((d=m.total)==null?void 0:d.product),1)]}),_:2},1024)]),_:2},1024),e(o,null,{default:t(()=>[e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Qty Product :")]),_:1}),e(a,{strong:""},{default:t(()=>{var d;return[n(_((d=m.total)==null?void 0:d.qty),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{align:"center"},{default:t(()=>[e(a,{style:{"font-size":"0.8rem"}},{default:t(()=>{var d,M;return[n(_((((d=m.total)==null?void 0:d.approved)/((M=m.total)==null?void 0:M.qty)*100).toFixed(2))+"% Approved",1)]}),_:2},1024),h("div",{onClick:d=>b(m)},[h("div",dt,_(m.active?"Tampilkan Lebih Sedikit":"Tampilkan Detail"),1)],8,rt)]),_:2},1024)]),_:2},1024),e(X,{show:!!m.active},{default:t(()=>[e(Ce,{"x-scrollable":""},{default:t(()=>[(p(!0),F(j,null,O(m.products,d=>(p(),z(o,{key:d.id,vertical:"",style:{padding:"1rem"}},{default:t(()=>[e(o,{justify:"space-between"},{default:t(()=>[e(o,{align:"center",justify:"space-between"},{default:t(()=>[e(o,{vertical:"",size:0},{default:t(()=>[e(o,{size:4,align:"center"},{default:t(()=>[e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Product : ")]),_:1}),e(a,{strong:"",style:{"margin-bottom":"0"}},{default:t(()=>[n(_(d.name)+" ("+_(d.approved)+"/"+_(d.qty)+") ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{size:4,align:"center"},{default:t(()=>[e(o,null,{default:t(()=>[e(a,null,{default:t(()=>[n("Location : ")]),_:1}),e(a,{strong:""},{default:t(()=>[n(_(d.warehouse_building.code)+" - "+_(d.warehouse_building.name),1)]),_:2},1024)]),_:2},1024),h("div",{class:"text_link",onClick:M=>_e(m,d)}," edit ",8,ct)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(o,{justify:"space-between",style:{"margin-top":"0.5rem"}},{default:t(()=>[e(Q,{cols:"3","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:t(()=>[e(y,{span:"3 m:1"},{default:t(()=>[e(D,{style:{"border-radius":"1rem",padding:"10px 24px","font-size":"13px"},type:"primary",strong:"",secondary:""},{default:t(()=>[n(" Aproved ("+_(d.approved||0)+") ",1)]),_:2},1024)]),_:2},1024),e(y,{span:"3 m:1"},{default:t(()=>[e(D,{style:{"border-radius":"1rem",padding:"10px 24px","font-size":"13px"},type:"warning",strong:"",secondary:""},{default:t(()=>[n(" Broken ("+_(d.broken||0)+") ",1)]),_:2},1024)]),_:2},1024),e(y,{span:"3 m:1"},{default:t(()=>[e(D,{style:{"border-radius":"1rem",padding:"10px 24px","font-size":"13px"},type:"error",strong:"",secondary:""},{default:t(()=>[n(" Missing ("+_(d.missing||0)+") ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),h("div",{onClick:M=>fe(d),class:"text_link"},_(d.active?"Tampilkan Lebih Sedikit":"Tampilkan Detail"),9,_t)]),_:2},1024)]),_:2},1024),e(X,{show:!!d.active},{default:t(()=>[e(o,{vertical:""},{default:t(()=>{var M;return[d.loading?(p(),z(x,{key:0})):(p(),z(Se,{key:1,product:d,reception_code:l(c).code,packing_code:(M=m.packing)==null?void 0:M.code},null,8,["product","reception_code","packing_code"]))]}),_:2},1024)]),_:2},1032,["show"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["show"])]))),128))]}),_:1}),e(o,{vertical:"",size:16},{default:t(()=>[h("input",{ref_key:"inputFile",ref:S,type:"file",style:{display:"none"},multiple:l(v),accept:"image/*",onChange:me},null,40,pt),e(Q,{cols:"2","x-gap":16,"y-gap":16},{default:t(()=>[e(y,null,{default:t(()=>[e(o,null,{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("Nama Penerima :")]),_:1}),e(a,{style:{margin:"0"},strong:""},{default:t(()=>{var i,f,m,d,M,oe;return[n(_((i=l(c).created_by)!=null&&i.is_superadmin?(m=(f=l(c).created_by)==null?void 0:f.superadmin)==null?void 0:m.name:(oe=(M=(d=l(c))==null?void 0:d.created_by)==null?void 0:M.user)==null?void 0:oe.name),1)]}),_:1})]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(o,null,{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("Tanggal Diterima :")]),_:1}),e(a,{style:{margin:"0"},strong:""},{default:t(()=>{var i,f;return[n(_((i=l(c).finish_info)!=null&&i.finished_date?l(Ze)((f=l(c).finish_info)==null?void 0:f.finished_date).format("YYYY-MM-DD"):"-"),1)]}),_:1})]),_:1})]),_:1}),e(H,{span:"2"},{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("Alasan")]),_:1}),e(Z,{value:l(u).desc,"onUpdate:value":r[0]||(r[0]=i=>l(u).desc=i),placeholder:"Input Alasan"},null,8,["value"])]),_:1}),e(H,{span:"2"},{default:t(()=>[e(o,{vertical:"",size:0},{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("Bukti")]),_:1}),e(D,{type:"primary",strong:"",secondary:"",round:"",onClick:ve},{default:t(()=>[n("Upload foto")]),_:1}),e(a,{style:{"font-size":"9px"}},{default:t(()=>[n("Menggunakan file dengan format JPG, JPEG, PNG ukuran maksimal file tidak boleh lebih dari 2MB")]),_:1})]),_:1}),l(u).images.length?(p(),z(o,{key:0,size:8,"wrap-item":"",style:{"margin-top":"1rem"}},{default:t(()=>[(p(!0),F(j,null,O(l(u).images,(i,f)=>(p(),z(o,{vertical:"",size:4,key:i.id},{default:t(()=>[e(ee,{src:i.url,height:200,width:200,"object-fit":"cover"},null,8,["src"]),e(D,{size:"small",quaternary:"",round:"",type:"primary",onClick:m=>l(u).images.splice(f,1)},{default:t(()=>[n("Hapus")]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):E("",!0)]),_:1}),e(H,{span:"2"},{default:t(()=>{var i;return[e(o,{vertical:"",size:0},{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("Tanda Tangan Digital")]),_:1}),e(D,{strong:"",secondary:"",type:"primary",round:"",onClick:r[1]||(r[1]=f=>T.value=!0)},{default:t(()=>[n("Upload foto")]),_:1})]),_:1}),(i=l(u).signature)!=null&&i.url?(p(),z(o,{key:0,vertical:"",style:{"margin-top":"1rem"},size:0},{default:t(()=>{var f;return[e(ee,{src:(f=l(u).signature)==null?void 0:f.url,height:180,width:400,"object-fit":"cover"},null,8,["src"]),e(D,{size:"small",quaternary:"",round:"",type:"primary",onClick:xe},{default:t(()=>[n("Hapus")]),_:1})]}),_:1})):E("",!0)]}),_:1}),e(H,{span:"2"},{default:t(()=>[e(a,{style:{margin:"0"}},{default:t(()=>[n("No GR")]),_:1}),e(Z,{placeholder:"Input Nomor GR",value:l(u).gr,"onUpdate:value":r[2]||(r[2]=i=>l(u).gr=i)},null,8,["value"])]),_:1})]),_:1})]),_:1})])],64)),h("div",ft,[h("div",gt,[e(De,{to:{name:"penerimaan-reception"},class:"text-decoration-none"},{default:t(()=>[e(D,{color:"#828282",class:"button-tnt"},{default:t(()=>[n("Kembali")]),_:1})]),_:1}),l(c).status!=="received"?(p(),z(D,{key:0,type:"primary",class:"button-tnt",onClick:K},{default:t(()=>[n("Konfirmasi")]),_:1})):E("",!0)])])]),e(Me,{show:l(I),"onUpdate:show":r[3]||(r[3]=i=>Re(I)?I.value=i:null),name:(te=l(L))==null?void 0:te.name,warehouse_id:(ne=(ae=l(c).do)==null?void 0:ae.destination)==null?void 0:ne.id,"onClick:submit":pe},null,8,["show","name","warehouse_id"]),e(ze,{show:l(w).show,"onUpdate:show":r[4]||(r[4]=i=>l(w).show=i),icon:l(w).icon,"icon-color":l(w).iconColor,"hide-icon":l(w).hideIcon,title:l(w).title,subtitle:l(w).subtitle},{default:t(()=>[e(o,{justify:"center"},{default:t(()=>[l(w).type=="konfirmasi"?(p(),F(j,{key:0},[e(D,{loading:l(R),color:"#828282",secondary:"",strong:"",class:"button-tnt",onClick:l(Xe)},{default:t(()=>[n(" Tutup ")]),_:1},8,["loading","onClick"]),e(D,{loading:l(R),type:"primary",secondary:"",strong:"",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:he},{default:t(()=>[n(" Yakin ")]),_:1},8,["loading"])],64)):E("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),e(Pe,{ref_key:"modalSignatureRef",ref:k,show:l(T),"onClick:close":be,formValue:l(u),onHandleSetImageSignature:we},null,8,["show","formValue"])],64)}}});export{Mt as default};
