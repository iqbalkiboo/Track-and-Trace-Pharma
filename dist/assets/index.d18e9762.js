import{_ as de}from"./t-permission-modal.bdf6acbc.js";import{_ as me}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as pe}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as _e,b as he,E as ve,r,a1 as fe,f as ge,e as ke,aF as j,Q as H,N as be,p as ye,o as _,c as U,a as T,k as l,w as s,q as m,t as L,i as a,h as k,j as b,F as D,ah as we,af as Ce,am as Ve,an as xe,ak as Te,I as Me,H as Ke,J as Pe,K as Ae,v as Be}from"./index.21c0d750.js";import{c as M}from"./constant.549d5c21.js";import{m as E}from"./master-kendaraan.dfe5bfd2.js";import{m as Fe}from"./master-kategori-kendaraan.1100df56.js";import{m as Ue}from"./master-warehouse.353b4b3b.js";import{_ as De}from"./modal-add-tipe-kendaraan.vue_vue_type_script_setup_true_lang.a6641fe4.js";import{A as Ee}from"./Add.4f3b52cf.js";import{C as Ie}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Se}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";const Ne={class:"body-tnt"},qe={class:"card-tnt"},$e={class:"bottom-action-button"},We={class:"action-item"},ta=_e({__name:"index",setup(Oe){const K=he(),w=ve(),C=r(),V=r(!1),p=r(!1),d=r(""),I=r(),S=r();S.value={plate_number:{required:!0,message:"Plat nomor kendaraan tidak boleh kosong",trigger:"blur"},vehicle_category_id:{required:!0,message:"Kategori kendaraan tidak boleh kosong",trigger:"blur"},volume:{required:!0,validator(o,e){if(e){if(!/^\d*$/.test(e))return new Error("Volume harus angka")}else return new Error("Volume tidak boleh kosong");return!0},trigger:["input","blur"]},maximum_weight:{required:!0,validator(o,e){if(e){if(!/^\d*$/.test(e))return new Error("Berat maksimum harus angka")}else return new Error("Berat maksimum tidak boleh kosong");return!0},trigger:["input","blur"]},warehouse_ids:{type:"array",required:!0,message:"Plant/Cabang tidak boleh kosong",trigger:"blur"},apikey_iot:{required:!0,message:"Api key IoT tidak boleh kosong",trigger:"blur"},status:{type:"number",required:!0,message:"Status tidak boleh kosong",trigger:"blur"}};const n=r({status:1}),P=r([]),N=r([]),J=r([{label:"Aktif",value:1},{label:"Tidak Aktif",value:0}]),t=r({show:r(!1),icon:fe(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),y=r({show:!1});ge(()=>{C.value=ke.getAuth(),K.params.crud=="create"?(d.value="create",j.isGranted(M.accessPrivileges.vehicle+".create")?q():y.value.show=!0):(d.value="update",j.isGranted(M.accessPrivileges.vehicle+".update")?q():y.value.show=!0)});function Q(){y.value.show=!1}async function q(){if(d.value=="update"){V.value=!0;const o=K.params.id;await A(""),await $(),await E.getDetailVehicle(o).then(e=>{Y(e.data),V.value=!1}).catch(e=>{V.value=!1;const u=e.response.data;w.error(u.message)})}else await A(""),await $()}async function A(o){n.value.vehicle_category_id="";const e={limit:1e3};await Fe.getVehicleCategory(e).then(u=>{P.value=[{key:"add",value:"add",label:()=>H("span",{style:{color:"#0B8F9D",fontWeight:600}},[H(be,{component:Ee}),"Tambah Kategori Kendaraan"])}];const c=u.data.data.list;c.forEach(h=>{P.value.push({key:h.name,label:h.name,value:h.id})}),o==="after_create"&&(n.value.vehicle_category_id=c[u.data.data.list.length-1].id)}).catch(u=>{const c=u.response.data;w.error(c.message)})}async function $(){n.value.warehouse_ids=[];const o={limit:1e3};await Ue.getWarehouse(o).then(e=>{e.data.list.forEach(c=>{N.value.push({key:c.name,label:c.name,value:c.id})})}).catch(e=>{const u=e.response.data;w.error(u.message)})}function Y(o){const e=r([]);o.warehouses.forEach(u=>{e.value.push(u.id)}),n.value={vehicle_category_id:o.vehicle_categories.id,warehouse_ids:e.value,plate_number:o.plate_number,volume:o.volume,maximum_weight:o.maximum_weight,apikey_iot:o.apikey_iot,status:o.status.value}}function W(){n.value={vehicle_category_id:null,plate_number:"",volume:"",maximum_weight:"",warehouse_ids:null,apikey_iot:"",status:null}}function z(){p.value=!0;let o="";C.value.xxtype==="5up3r4dm1n"?o=C.value["xx-usertype-access"].company_id:o=C.value.users.user_type.id;const e={company_id:o,vehicle_category_id:n.value.vehicle_category_id,plate_number:n.value.plate_number,volume:parseInt(n.value.volume),maximum_weight:parseInt(n.value.maximum_weight),warehouse_ids:n.value.warehouse_ids,apikey_iot:n.value.apikey_iot,status:n.value.status};if(d.value=="create")E.createVehicle(e).then(()=>{p.value=!1,W(),f(),setTimeout(()=>{R()},300)}).catch(u=>{const c=u.response.data;p.value=!1,f(),setTimeout(()=>{G(c)},300)});else{const u=K.params.id;E.updateVehicle(u,e).then(()=>{p.value=!1,W(),f(),setTimeout(()=>{R()},300)}).catch(c=>{const h=c.response.data;p.value=!1,f(),setTimeout(()=>{G(h)},300)})}}async function O(o){var e;o.preventDefault(),await((e=I.value)==null?void 0:e.validate().then(()=>{X()}).catch(()=>{w.error("Form tidak valid, tolong periksa kembali")}))}function f(){t.value.show=!1}function X(){t.value.type="confirm",t.value.hideIcon=!0,t.value.title="Konfirmasi",d.value=="create"?t.value.subtitle="Apakah Anda yakin untuk menambah kendaraan?":t.value.subtitle="Apakah Anda yakin untuk mengubah data kendaraan?",t.value.show=!0}function R(){t.value.type="success",t.value.hideIcon=!1,t.value.iconColor="#219653",t.value.icon=Ie,d.value=="create"?(t.value.title="Berhasil Tambah Data",t.value.subtitle="Data kendaraan berhasil ditambahkan"):(t.value.title="Berhasil Ubah Data",t.value.subtitle="Data kendaraan berhasil diubah"),t.value.show=!0}function G(o){t.value.type="failed",t.value.hideIcon=!1,t.value.iconColor="#EB5757",t.value.icon=Se,t.value.title="Gagal",Object.keys(o.validation).length>0?t.value.subtitle=o.validation:t.value.subtitle=o.message,t.value.show=!0}const B=r(!1),Z=r(),ee=r();ee.value={name:[{required:!0,validator:(o,e)=>{if(!e||e.length<1)return new Error("Nama Tipe User tidak boleh kosong")},trigger:["input","blur"]}]};function ae(o){o&&(Z.value=n.value.vehicle_category_id)}function te(o){o=="add"&&oe()}function oe(){B.value=!0}function le(){B.value=!1}return(o,e)=>{const u=Ce,c=ye("router-link"),h=Ve,ne=xe,se=pe,x=Te,g=Me,F=Ke,ie=Pe,v=Ae,ue=Be,re=me,ce=de;return _(),U(D,null,[T("div",Ne,[l(u,{style:{"margin-bottom":"4px"}},{default:s(()=>[m(L(a(d)=="create"?"Tambah Kendaraan":"Edit Kendaraan"),1)]),_:1}),l(ne,null,{default:s(()=>[l(h,null,{default:s(()=>[l(c,{to:"/setting/master-kendaraan",class:"text-decoration-none"},{default:s(()=>[m(" Master Kendaraan ")]),_:1})]),_:1}),l(h,null,{default:s(()=>[m(L(a(d)=="create"?"Tambah Kendaraan":"Edit Kendaraan"),1)]),_:1})]),_:1}),T("div",qe,[a(V)?(_(),k(se,{key:0})):(_(),k(ie,{key:1,ref_key:"formRef",ref:I,model:a(n),rules:a(S),"show-require-mark":!1,class:"form-tnt"},{default:s(()=>[l(g,{path:"plate_number",label:"Plat Nomor Kendaraan"},{default:s(()=>[l(x,{value:a(n).plate_number,"onUpdate:value":e[0]||(e[0]=i=>a(n).plate_number=i),placeholder:"Masukkan Plat Nomor Kendaraan"},null,8,["value"])]),_:1}),l(g,{path:"vehicleType",label:"Kategori Kendaraan"},{default:s(()=>[l(F,{value:a(n).vehicle_category_id,"onUpdate:value":[e[1]||(e[1]=i=>a(n).vehicle_category_id=i),te],options:a(P),placeholder:"Pilih Kategori Kendaraan","onUpdate:show":ae},null,8,["value","options"])]),_:1}),l(g,{path:"volume",label:"Volume (m3)"},{default:s(()=>[l(x,{value:a(n).volume,"onUpdate:value":e[2]||(e[2]=i=>a(n).volume=i),placeholder:"Masukkan Volume"},null,8,["value"])]),_:1}),l(g,{path:"maxWeight",label:"Berat Maksimum (gram)"},{default:s(()=>[l(x,{value:a(n).maximum_weight,"onUpdate:value":e[3]||(e[3]=i=>a(n).maximum_weight=i),placeholder:"Masukkan Berat Maksimum"},null,8,["value"])]),_:1}),l(g,{path:"plant",label:"Nama Plant/Cabang"},{default:s(()=>[l(F,{multiple:"",value:a(n).warehouse_ids,"onUpdate:value":e[4]||(e[4]=i=>a(n).warehouse_ids=i),options:a(N),placeholder:"Pilih Plant/Cabang"},null,8,["value","options"])]),_:1}),l(g,{path:"iot",label:"Api key IoT"},{default:s(()=>[l(x,{value:a(n).apikey_iot,"onUpdate:value":e[5]||(e[5]=i=>a(n).apikey_iot=i),placeholder:"Masukkan Api key IoT"},null,8,["value"])]),_:1}),l(g,{path:"status",label:"Status"},{default:s(()=>[l(F,{value:a(n).status,"onUpdate:value":e[6]||(e[6]=i=>a(n).status=i),options:a(J),placeholder:"Pilih Status User",style:{width:"100%"}},null,8,["value","options"])]),_:1})]),_:1},8,["model","rules"]))]),T("div",$e,[T("div",We,[l(c,{to:{name:"setting-master-kendaraan"},style:{"text-decoration":"none"}},{default:s(()=>[l(v,{color:"#828282",class:"button-tnt"},{default:s(()=>[m("Kembali")]),_:1})]),_:1}),a(d)==="create"&&o.$filters.isGranted(a(M).accessPrivileges.vehicle+".create")?(_(),k(v,{key:0,color:"#219653",class:"button-tnt",loading:a(p),onClick:O},{default:s(()=>[m(" Simpan ")]),_:1},8,["loading"])):b("",!0),a(d)==="update"&&o.$filters.isGranted(a(M).accessPrivileges.vehicle+".update")?(_(),k(v,{key:1,color:"#219653",class:"button-tnt",loading:a(p),onClick:O},{default:s(()=>[m(" Simpan ")]),_:1},8,["loading"])):b("",!0)])])]),l(De,{"is-show-modal":a(B),onFetchData:e[7]||(e[7]=i=>A("after_create")),onHideModal:le},null,8,["is-show-modal"]),l(re,{show:a(t).show,"onUpdate:show":e[8]||(e[8]=i=>a(t).show=i),icon:a(t).icon,"icon-color":a(t).iconColor,"hide-icon":a(t).hideIcon,title:a(t).title,subtitle:a(t).subtitle},{default:s(()=>[l(ue,{justify:"center"},{default:s(()=>[a(t).type=="confirm"?(_(),U(D,{key:0},[l(v,{loading:a(p),color:"#828282",class:"button-tnt",onClick:f},{default:s(()=>[m(" Tutup ")]),_:1},8,["loading"]),l(v,{loading:a(p),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:we(z,["prevent"])},{default:s(()=>[m(" Yakin ")]),_:1},8,["loading","onClick"])],64)):b("",!0),a(t).type=="success"?(_(),U(D,{key:1},[a(d)==="create"?(_(),k(v,{key:0,color:"#828282",class:"button-tnt",onClick:f},{default:s(()=>[m(" Tambah Lainya ")]),_:1})):b("",!0),l(c,{to:{name:"setting-master-kendaraan"},class:"text-decoration-none"},{default:s(()=>[l(v,{color:"#219653",class:"button-tnt"},{default:s(()=>[m(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):b("",!0),a(t).type=="failed"?(_(),k(v,{key:2,color:"#828282",class:"button-tnt",onClick:f},{default:s(()=>[m(" Tutup ")]),_:1})):b("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),l(ce,{show:a(y).show,"onUpdate:show":e[9]||(e[9]=i=>a(y).show=i),"onClick:close":Q},null,8,["show"])],64)}}});export{ta as default};
