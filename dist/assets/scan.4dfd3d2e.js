import{_ as de}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as _e}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as pe,b as fe,E as me,r as f,f as he,e as ye,a1 as ge,p as ve,o as d,c as m,a as n,i as e,k as t,F as I,w as a,q as o,t as r,ak as ke,S as be,al as ze,j as K,g as G,h as J,af as xe,a9 as we,v as De,s as Ce,a7 as Se,ac as qe,ar as Ke,L as Ee,a8 as Ne,K as Ie,aa as Be}from"./index.21c0d750.js";import{h as W}from"./moment.62d3fb0a.js";import{s as R}from"./serialisasi-external.c8482290.js";import{C as Qe}from"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";const Te={class:"body-tnt"},$e={key:0,class:"card-tnt"},Le={key:0,class:"card-tnt",style:{"margin-top":"0","background-color":"#eeeeee"}},Me={key:1,class:"card-tnt",style:{"margin-top":"0"}},Re={class:"table-tnt",style:{"margin-top":"10px"}},Fe=n("thead",null,[n("tr",null,[n("th",null,"No"),n("th",null,"Kode Serialisasi"),n("th",null,"Batch"),n("th",{style:{"text-align":"center"}},"Level"),n("th",{style:{"text-align":"center"}},"Qty"),n("th",{style:{"text-align":"center"}},"Aksi")])],-1),Oe={style:{"text-align":"center"}},Ae={style:{"text-align":"center"}},Ve={style:{"text-align":"center"}},Pe={key:2,class:"card-tnt",style:{"margin-top":"0"}},je={class:"table-tnt",style:{"margin-top":"10px"}},He=n("thead",null,[n("tr",null,[n("th",null,"No"),n("th",null,"Kode Serialisasi"),n("th",null,"Batch"),n("th",{style:{"text-align":"center"}},"Level"),n("th",{style:{"text-align":"center"}},"Qty")])],-1),Ue={style:{"text-align":"center"}},Ye={style:{"text-align":"center"}},Ge={class:"bottom-action-button"},Je={class:"action-item"},it=pe({__name:"scan",setup(We){const D=fe(),z=me(),X=f(),A=f(!1),h=f(!1),x=f({}),b=f({}),w=f({}),c=f([]),C=f(""),Z=f();Z.value={reason:{required:!0,message:"Alasan tidak boleh kosong",trigger:["input","blur"]}};const F=f(null);he(()=>{X.value=ye.getAuth(),j()});async function j(){A.value=!0,ee(),await te(),await ae(),A.value=!1}async function ee(){const u=D.params.id;await R.getDetailSerialize(u).then(i=>{x.value=i.data}).catch(i=>{const l=i.response.data;z.error(l.message)})}async function te(){const u=D.query.product_id;await R.getDetailSerializeProduct(u).then(async i=>{b.value=i.data}).catch(i=>{const l=i.response.data;z.error(l.message)})}async function ae(){const u=D.query.product_id,i={import_serialization_id:D.params.id,import_serialization_product_id:u,is_scan:!0,limit:1e3};await R.getSerializeDetailList(i).then(async l=>{w.value=l.data}).catch(l=>{const _=l.response.data;z.error(_.message)})}async function H(){h.value=!0;const u=D.query.product_id,i={code:C.value,import_serialization_product_id:u};await R.scanSerializeExternal(i).then(l=>{var _,O,y,g,E;c.value.length>0?parseInt((O=(_=l==null?void 0:l.data)==null?void 0:_.serialize)==null?void 0:O.first_level_qty)+B(w.value.list)+B(c.value)>b.value.qty?z.error("Qty serialisasi tidak dapat melebihi Qty DO"):c.value.forEach(Q=>{var S;if(Q.id===l.data.id)z.error("Kode serialisasi sudah ada di list");else{const V=c.value.filter(P=>P.id!==l.data.id);c.value=V,c.value.push(l.data),(S=F.value)==null||S.focus()}}):parseInt((g=(y=l==null?void 0:l.data)==null?void 0:y.serialize)==null?void 0:g.first_level_qty)+B(w.value.list)>b.value.qty?z.error("Qty serialisasi tidak dapat melebihi Qty TO"):w.value.list.length>0?w.value.list.forEach(Q=>{var S;Q.serialize.id===l.data.id?z.error("Kode serialisasi sudah ada di list"):(c.value.push(l.data),(S=F.value)==null||S.focus())}):(c.value.push(l.data),(E=F.value)==null||E.focus()),C.value="",h.value=!1}).catch(l=>{C.value="",h.value=!1;const _=l.response.data;z.error(_.message)})}function B(u){if(u){let i=0;return u.forEach(l=>{i+=l.serialize.first_level_qty}),i}else return 0}function ne(){oe()}function le(){h.value=!0;let u=[];c.value.forEach(l=>{var _;u.push((_=l.serialize)==null?void 0:_.code)});const i=D.query.product_id;R.confirmSerializeExternal({code:u,import_serialization_id:D.params.id,import_serialization_product_id:i}).then(()=>{h.value=!1,setTimeout(()=>{s.value.title="Berhasil Konfirmasi",s.value.subtitle=`${B(c.value)} kode serialisai berhasil dikonfirmasi`,re()},300)}).catch(l=>{h.value=!1;const _=l.response.data;z.error(_.message)})}const s=f({show:f(!1),type:"",icon:ge(),iconColor:"",hideIcon:!1,title:"",subtitle:"",align:"center"});function se(){s.value.show=!1}function ie(){c.value=[],j(),s.value.show=!1}function oe(){s.value.type="confirm",s.value.hideIcon=!0,s.value.title="Konfirmasi",s.value.subtitle="Apakah Anda yakin untuk melakukan konfirmasi serialisasi?",s.value.show=!0}function re(){s.value.type="success",s.value.hideIcon=!1,s.value.iconColor="#219653",s.value.icon=Qe,s.value.show=!0}return(u,i)=>{const l=_e,_=xe,O=we,y=De,g=Ce,E=Se,Q=qe,S=Ke,V=Ee,P=Ne,q=Ie,U=Be,ue=ve("router-link"),ce=de;return d(),m(I,null,[n("div",Te,[e(A)?(d(),m("div",$e,[t(l)])):(d(),m(I,{key:1},[t(y,{justify:"space-between"},{default:a(()=>[t(_,{style:{"margin-bottom":"0","margin-top":"5px"}},{default:a(()=>[o("No DO Vendor : "+r(e(x).vendor_no),1)]),_:1}),t(O,{round:"",bordered:!1,strong:"",type:e(x).status==="complete"?"success":e(x).status==="pending"?"warning":e(x).status==="cancel"?"error":"default",size:"large"},{default:a(()=>[o(r(u.$filters.toStatus(e(x).status)),1)]),_:1},8,["type"])]),_:1}),t(P,{gutter:"16",style:{"margin-top":"14px"}},{default:a(()=>[t(E,{span:8},{default:a(()=>[t(y,{vertical:"",size:0},{default:a(()=>[t(g,null,{default:a(()=>[o("Tanggal DO : "+r(e(W)(e(x).created_at).format("yyyy-MM-DD")),1)]),_:1}),t(g,null,{default:a(()=>{var p,v;return[o("Kode Produk : "+r((v=(p=e(b))==null?void 0:p.product)==null?void 0:v.item_code),1)]}),_:1}),t(g,null,{default:a(()=>{var p,v;return[o("Nama Produk : "+r((v=(p=e(b))==null?void 0:p.product)==null?void 0:v.short_name),1)]}),_:1})]),_:1})]),_:1}),t(E,{span:8},{default:a(()=>[t(y,{vertical:"",size:0},{default:a(()=>[t(g,null,{default:a(()=>[o("Batch : "+r(u.$filters.isEmpty(e(b).batch)),1)]),_:1}),t(g,null,{default:a(()=>[o("Exp Date : "+r(e(W)(e(b).expired_date).format("yyyy-MM-DD")),1)]),_:1})]),_:1})]),_:1}),t(E,{span:8},{default:a(()=>[t(y,{vertical:"",size:10,align:"end"},{default:a(()=>[t(V,{style:{width:"250px","text-align":"center","border-radius":"15px",background:"#eee"}},{default:a(()=>[t(Q,{style:{"font-size":"14px"}},{default:a(()=>[o("Qty Terkonfirmasi/Qty DO :")]),_:1}),t(S,{style:{"margin-top":"0","margin-bottom":"0"}},{default:a(()=>{var p,v;return[o(r(((p=e(b))==null?void 0:p.current_qty)+"/"+u.$filters.toNumber((v=e(b))==null?void 0:v.qty)),1)]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(y,{vertical:"",size:24,style:{"margin-top":"24px"}},{default:a(()=>{var p,v,Y;return[((p=e(w))==null?void 0:p.list)&&e(x).status!=="cancel"?(d(),m(I,{key:0},[B(e(w).list)!==((v=e(b))==null?void 0:v.qty)?(d(),m("div",Le,[t(y,{vertical:"",align:"center"},{default:a(()=>[t(g,null,{default:a(()=>[o("Silakan masukkan Kode Serialisasi")]),_:1}),t(y,null,{default:a(()=>[t(e(ke),{ref_key:"input",ref:F,value:e(C),"onUpdate:value":i[0]||(i[0]=k=>be(C)?C.value=k:null),placeholder:"",clearable:"",onKeyup:ze(H,["enter"]),style:{width:"35rem"}},null,8,["value","onKeyup"]),t(q,{loading:e(h),disabled:e(C)=="",strong:"",secondary:"",type:"primary",class:"button-tnt",onClick:H},{default:a(()=>[o("Cari")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})])):K("",!0)],64)):K("",!0),e(c).length>0?(d(),m("div",Me,[t(g,null,{default:a(()=>[o("Serialisasi Terscan")]),_:1}),n("div",Re,[t(U,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:a(()=>[Fe,n("tbody",null,[(d(!0),m(I,null,G(e(c),(k,N)=>{var T,$,L,M;return d(),m("tr",{key:N},[n("td",null,r(N+1),1),n("td",null,r((T=k.serialize)==null?void 0:T.code),1),n("td",null,r(($=k.serialize)==null?void 0:$.batch),1),n("td",Oe,r((L=k.serialize)==null?void 0:L.level),1),n("td",Ae,r((M=k.serialize)==null?void 0:M.first_level_qty),1),n("td",Ve,[t(q,{text:"",type:"error",onClick:Xe=>e(c).splice(N,1)},{default:a(()=>[o(" Hapus ")]),_:2},1032,["onClick"])])])}),128))])]),_:1})])])):K("",!0),((Y=e(w).list)==null?void 0:Y.length)>0?(d(),m("div",Pe,[t(g,null,{default:a(()=>[o("Serialisasi Terkonfirmasi")]),_:1}),n("div",je,[t(U,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:a(()=>[He,n("tbody",null,[(d(!0),m(I,null,G(e(w).list,(k,N)=>{var T,$,L,M;return d(),m("tr",{key:N},[n("td",null,r(N+1),1),n("td",null,r((T=k.serialize)==null?void 0:T.code),1),n("td",null,r(($=k.serialize)==null?void 0:$.batch),1),n("td",Ue,r((L=k.serialize)==null?void 0:L.level),1),n("td",Ye,r((M=k.serialize)==null?void 0:M.first_level_qty),1)])}),128))])]),_:1})])])):K("",!0)]}),_:1})],64)),n("div",Ge,[n("div",Je,[t(ue,{to:{name:"penerimaan-serialisasi-external-id"},class:"text-decoration-none"},{default:a(()=>[t(q,{loading:e(h),color:"#828282",class:"button-tnt",style:{width:"120px"}},{default:a(()=>[o("Kembali")]),_:1},8,["loading"])]),_:1}),e(x).status==="pending"?(d(),J(q,{key:0,loading:e(h),disabled:e(c).length===0,type:"primary",class:"button-tnt",style:{width:"120px"},onClick:ne},{default:a(()=>[o(" Konfirmasi ")]),_:1},8,["loading","disabled"])):K("",!0)])])]),t(ce,{show:e(s).show,"onUpdate:show":i[1]||(i[1]=p=>e(s).show=p),icon:e(s).icon,"hide-icon":e(s).hideIcon,title:e(s).title,subtitle:e(s).subtitle,align:e(s).align},{default:a(()=>[t(y,{justify:"center"},{default:a(()=>[e(s).type=="confirm"?(d(),m(I,{key:0},[t(q,{loading:e(h),color:"#828282",class:"button-tnt",onClick:se},{default:a(()=>[o(" Tutup ")]),_:1},8,["loading"]),t(q,{loading:e(h),type:"primary",class:"button-tnt",onClick:le},{default:a(()=>[o(" Yakin ")]),_:1},8,["loading"])],64)):K("",!0),e(s).type=="success"?(d(),J(q,{key:1,color:"#828282",class:"button-tnt",onClick:ie},{default:a(()=>[o(" Tutup ")]),_:1})):K("",!0)]),_:1})]),_:1},8,["show","icon","hide-icon","title","subtitle","align"])],64)}}});export{it as default};
