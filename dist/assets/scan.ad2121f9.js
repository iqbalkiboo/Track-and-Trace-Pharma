import{_ as ye}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as he}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as ge,b as ve,u as be,E as ke,r as y,f as we,e as De,a1 as qe,W as xe,p as Se,o as v,c as b,a as l,i as a,k as e,h as Q,w as t,q as u,t as i,ak as Ce,S as $e,al as Re,F as K,g as H,N as U,j as N,aG as Ee,v as ze,s as Be,a7 as Ke,a9 as Ne,ac as Me,ar as Te,L as Ae,a8 as Fe,K as Ie,y as je,aa as Le}from"./index.21c0d750.js";import{r as $}from"./return.bfb09c74.js";import{h as F}from"./moment.62d3fb0a.js";import{E as G}from"./EllipsisVertical.56989e7a.js";import{C as Pe}from"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";const Ve={class:"body-tnt"},Oe={key:0,class:"card-tnt"},Qe={class:"card-tnt",style:{"background-color":"#eeeeee"}},He={key:0,class:"card-tnt",style:{"margin-top":"0"}},Ue={class:"table-tnt",style:{"margin-top":"10px"}},Ge=l("thead",null,[l("tr",null,[l("th",null,"No"),l("th",null,"Kode Serialisasi"),l("th",null,"Expired Date"),l("th",{style:{"text-align":"center"}},"Batch"),l("th",{style:{"text-align":"center"}},"Level"),l("th",{style:{"text-align":"center"}},"Qty"),l("th",{style:{"text-align":"center"}},"Aksi")])],-1),Je={style:{"text-align":"center"}},We={style:{"text-align":"center"}},Ye={style:{"text-align":"center"}},Xe={style:{"text-align":"center"}},Ze={key:1,class:"card-tnt",style:{"margin-top":"0"}},et={class:"table-tnt",style:{"margin-top":"10px"}},tt=l("thead",null,[l("tr",null,[l("th",null,"No"),l("th",null,"Kode Serialisasi"),l("th",null,"Expired Date"),l("th",{style:{"text-align":"center"}},"Batch"),l("th",{style:{"text-align":"center"}},"Level"),l("th",{style:{"text-align":"center"}},"Qty"),l("th",{style:{"text-align":"center"}},"Aksi")])],-1),at={style:{"text-align":"center"}},nt={style:{"text-align":"center"}},lt={style:{"text-align":"center"}},ot={style:{"text-align":"center"}},st={class:"bottom-action-button"},it={class:"action-item"},ht=ge({__name:"scan",setup(rt){const q=ve();be();const k=ke(),J=y(),M=y(!1),h=y(!1),m=y({}),D=y({}),W=y([]);JSON.parse(localStorage.getItem("rr-product-data"));const T=y({}),g=y([]),x=y({current_qty:0,qty:0}),S=y(""),Y=y();Y.value={reason:{required:!0,message:"Alasan tidak boleh kosong",trigger:["input","blur"]}};const I=y(null);we(()=>{J.value=De.getAuth(),A()});async function A(){M.value=!0,X(),Z(),await ee(),M.value=!1}async function X(){const s=q.query.product_id,c={};await $.getDetailProduct(s,c).then(r=>{const _=r.data;x.value={current_qty:_.current_qty,qty:_.qty},m.value=_,W.value=_}).catch(r=>{const _=r.response.data;k.error(_.message)})}async function Z(){const s=q.query.return_id;await $.getDetailReturn(s).then(c=>{D.value=c.data}).catch(c=>{const r=c.response.data;k.error(r.message)})}async function ee(){const s=q.query.product_id,c={};await $.getListDetailProduct(s,c).then(async r=>{T.value=r.data}).catch(r=>{const _=r.response.data;k.error(_.message)})}async function j(){h.value=!0;const s=new FormData;s.append("code",S.value),s.append("rr_product_id",q.query.product_id),await $.getSerializeScan(s).then(c=>{var p;const r=c.data,_=y(!1);x.value.current_qty>=x.value.qty&&(_.value=!0,k.error("Maaf, tidak boleh melebihin qty return")),g.value.forEach(f=>{r.code===f.code&&(_.value=!0,k.error("Maaf, tidak boleh scan code yang sama"))}),_.value||(g.value.push(r),x.value.current_qty=g.value.reduce((f,C)=>f+C.serialize.first_level_qty,0)),(p=I.value)==null||p.focus(),S.value="",h.value=!1,_.value=!1}).catch(c=>{h.value=!1;const r=c.response.data;k.error(r.message)})}function te(){se()}function ae(){const s=q.query.product_id;h.value=!0;const c=new FormData;for(let r=0;r<g.value.length;r++)c.append(`codes[${r}]`,g.value[r].code);$.scanConfirmation(s,c).then(()=>{h.value=!1,setTimeout(()=>{d.value.title="Berhasil Konfirmasi Scan",d.value.subtitle="kode serialisai berhasil dikonfirmasi",ie()},300)}).catch(r=>{h.value=!1;const _=r.response.data;k.error(_.message)})}async function ne(s){const c=q.query.product_id,r=new FormData;r.set("codes[0]",s),await $.deleteDetailItem(c,r).then(()=>{A()}).catch(_=>{if(_.response){const p=_.response.data;k.error(p.message)}})}const d=y({show:y(!1),type:"",icon:qe(),iconColor:"",hideIcon:!1,title:"",subtitle:"",align:"center"});function le(){d.value.show=!1}function oe(){g.value=[],A(),d.value.show=!1}function se(){d.value.type="confirm",d.value.hideIcon=!0,d.value.title="Konfirmasi",d.value.subtitle="Apakah Anda yakin untuk melakukan konfirmasi scan?",d.value.show=!0}function ie(){d.value.type="success",d.value.hideIcon=!1,d.value.iconColor="#219653",d.value.icon=Pe,d.value.show=!0}async function L(s,c,r){var _;switch(s){case"delete":if(r==="temporary"){const p=g.value.findIndex(f=>f.id===c.id);g.value.splice(p,1)}else await ne((_=c.serialize)==null?void 0:_.code);break}}const P=xe(()=>{var s;return[{label:"Hapus",key:"delete",disabled:((s=D.value)==null?void 0:s.status)==="complete"}]});return(s,c)=>{const r=he,_=Ee,p=ze,f=Be,C=Ke,re=Ne,ue=Me,ce=Te,de=Ae,_e=Fe,w=Ie,V=je,O=Le,fe=Se("router-link"),pe=ye;return v(),b(K,null,[l("div",Ve,[a(M)?(v(),b("div",Oe,[e(r)])):(v(),Q(p,{key:1,vertical:"",size:14},{default:t(()=>{var z;return[e(p,{justify:"space-between"},{default:t(()=>[e(p,{align:"center"},{default:t(()=>[e(_,{style:{"font-weight":"600","font-size":"18px",margin:"auto"}},{default:t(()=>[u(" DO Return : "+i(a(D).code),1)]),_:1})]),_:1})]),_:1}),e(_e,{cols:12,gutter:10},{default:t(()=>[e(C,{span:6},{default:t(()=>[e(p,{vertical:""},{default:t(()=>[e(f,null,{default:t(()=>[u("Tanggal Return: "+i(a(F)(a(m).created_at).format("yyyy-MM-DD")),1)]),_:1}),e(f,null,{default:t(()=>{var n;return[u("Kode Produk : "+i((n=a(m).product)==null?void 0:n.item_code),1)]}),_:1}),e(f,null,{default:t(()=>{var n;return[u("Produk : "+i((n=a(m).product)==null?void 0:n.short_name),1)]}),_:1})]),_:1})]),_:1}),e(C,{span:6},{default:t(()=>[e(p,{vertical:""},{default:t(()=>[e(f,null,{default:t(()=>[u("Batch : "+i(a(m).batch),1)]),_:1})]),_:1}),e(p,{vertical:""},{default:t(()=>[e(f,null,{default:t(()=>{var n,o;return[u("Plant/Cabang Asal : "+i(s.$filters.isEmpty((o=(n=a(m).from)==null?void 0:n.warehouse)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Building Asal : "+i(s.$filters.isEmpty((o=(n=a(m).from)==null?void 0:n.building)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Room Asal : "+i(s.$filters.isEmpty((o=(n=a(m).from)==null?void 0:n.room)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Rack Asal : "+i(s.$filters.isEmpty((o=(n=a(m).from)==null?void 0:n.rack_pallete)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Bin Asal : "+i(s.$filters.isEmpty((o=(n=a(m).from)==null?void 0:n.bin)==null?void 0:o.name)),1)]}),_:1})]),_:1})]),_:1}),e(C,{span:6},{default:t(()=>[e(p,{vertical:""},{default:t(()=>[e(f,null,{default:t(()=>{var n,o;return[u("Plant/Cabang Tujuan : "+i(s.$filters.isEmpty((o=(n=a(m).to)==null?void 0:n.warehouse)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Building Tujuan : "+i(s.$filters.isEmpty((o=(n=a(m).to)==null?void 0:n.building)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Room Tujuan : "+i(s.$filters.isEmpty((o=(n=a(m).to)==null?void 0:n.room)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Rack Tujuan : "+i(s.$filters.isEmpty((o=(n=a(m).to)==null?void 0:n.rack_pallete)==null?void 0:o.name)),1)]}),_:1}),e(f,null,{default:t(()=>{var n,o;return[u("Bin Tujuan : "+i(s.$filters.isEmpty((o=(n=a(m).to)==null?void 0:n.bin)==null?void 0:o.name)),1)]}),_:1})]),_:1})]),_:1}),e(C,{span:6},{default:t(()=>[e(p,{vertical:"",size:15,align:"end"},{default:t(()=>[e(re,{round:"",bordered:!1,strong:"",type:a(D).status==="cancel"?"error":a(D).status==="pending"?"warning":a(D).status==="complete"?"primary":"success",size:"large"},{default:t(()=>[u(i(s.$filters.toStatus(a(D).status)),1)]),_:1},8,["type"]),e(de,{style:{width:"250px","text-align":"center","border-radius":"15px",background:"#eee"}},{default:t(()=>[e(ue,{style:{"font-size":"14px"}},{default:t(()=>[u("Qty Konfirmasi/Qyt Return")]),_:1}),e(ce,{style:{"margin-top":"0px"}},{default:t(()=>[u(i(`${a(x).current_qty}/${a(x).qty}`),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l("div",Qe,[e(p,{vertical:"",align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u("Silakan masukkan Kode Serialisasi")]),_:1}),e(p,null,{default:t(()=>[e(a(Ce),{ref_key:"input",ref:I,value:a(S),"onUpdate:value":c[0]||(c[0]=n=>$e(S)?S.value=n:null),placeholder:"",clearable:"",onKeyup:Re(j,["enter"]),style:{width:"35rem"}},null,8,["value","onKeyup"]),e(w,{loading:a(h),disabled:a(S)=="",strong:"",secondary:"",type:"primary",class:"button-tnt",onClick:j},{default:t(()=>[u("Cari ")]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),a(g).length>0?(v(),b("div",He,[e(f,null,{default:t(()=>[u("Serialisasi Terscan")]),_:1}),l("div",Ue,[e(O,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:t(()=>[Ge,l("tbody",null,[(v(!0),b(K,null,H(a(g),(n,o)=>{var R,E,B;return v(),b("tr",{key:o},[l("td",null,i(o+1),1),l("td",null,i(n.code),1),l("td",null,i(a(F)((R=n.product)==null?void 0:R.expired_date).format("yyyy-MM-DD")),1),l("td",Je,i(n.batch),1),l("td",We,i((E=n.serialize)==null?void 0:E.level),1),l("td",Ye,i(s.$filters.toNumber((B=n.serialize)==null?void 0:B.first_level_qty)),1),l("td",Xe,[e(V,{placement:"bottom-end",options:a(P),"show-arrow":!0,onSelect:me=>L(me,n,"temporary")},{default:t(()=>[e(w,{tertiary:""},{icon:t(()=>[e(a(U),null,{default:t(()=>[e(a(G))]),_:1})]),_:1})]),_:2},1032,["options","onSelect"])])])}),128))])]),_:1})])])):N("",!0),((z=a(T).list)==null?void 0:z.length)>0?(v(),b("div",Ze,[e(f,null,{default:t(()=>[u("Serialisasi Terkonfirmasi")]),_:1}),l("div",et,[e(O,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:t(()=>[tt,l("tbody",null,[(v(!0),b(K,null,H(a(T).list,(n,o)=>{var R,E;return v(),b("tr",{key:o},[l("td",null,i(o+1),1),l("td",null,i(n.serialize.code),1),l("td",null,i(a(F)(n.expired_date).format("yyyy-MM-DD")),1),l("td",at,i(n.serialize.batch),1),l("td",nt,i((R=n.serialize)==null?void 0:R.level),1),l("td",lt,i(s.$filters.toNumber((E=n.serialize)==null?void 0:E.first_level_qty)),1),l("td",ot,[e(V,{placement:"bottom-end",options:a(P),"show-arrow":!0,onSelect:B=>L(B,n,"list")},{default:t(()=>[e(w,{tertiary:""},{icon:t(()=>[e(a(U),null,{default:t(()=>[e(a(G))]),_:1})]),_:1})]),_:2},1032,["options","onSelect"])])])}),128))])]),_:1})])])):N("",!0)]}),_:1})),l("div",st,[l("div",it,[e(fe,{to:{name:"penerimaan-return-code",query:{return_id:s.$route.query.return_id}},class:"text-decoration-none"},{default:t(()=>[e(w,{loading:a(h),color:"#828282",class:"button-tnt",style:{width:"120px"}},{default:t(()=>[u("Kembali ")]),_:1},8,["loading"])]),_:1},8,["to"]),e(w,{loading:a(h),disabled:a(g).length===0,type:"primary",class:"button-tnt",style:{width:"120px"},onClick:te},{default:t(()=>[u(" Konfirmasi ")]),_:1},8,["loading","disabled"])])])]),e(pe,{show:a(d).show,"onUpdate:show":c[1]||(c[1]=z=>a(d).show=z),icon:a(d).icon,"hide-icon":a(d).hideIcon,title:a(d).title,subtitle:a(d).subtitle,align:a(d).align},{default:t(()=>[e(p,{justify:"center"},{default:t(()=>[a(d).type=="confirm"?(v(),b(K,{key:0},[e(w,{loading:a(h),color:"#828282",class:"button-tnt",onClick:le},{default:t(()=>[u(" Tutup ")]),_:1},8,["loading"]),e(w,{loading:a(h),type:"primary",class:"button-tnt",onClick:ae},{default:t(()=>[u(" Yakin ")]),_:1},8,["loading"])],64)):N("",!0),a(d).type=="success"?(v(),Q(w,{key:1,color:"#828282",class:"button-tnt",onClick:oe},{default:t(()=>[u(" Tutup ")]),_:1})):N("",!0)]),_:1})]),_:1},8,["show","icon","hide-icon","title","subtitle","align"])],64)}}});export{ht as default};
