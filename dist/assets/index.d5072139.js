import{d as ce,b as pe,r as w,E as ve,W as Z,p as B,i,o as U,h as ee,c as ae,k as n,w as o,q as b,t as P,ah as ge,a as fe,F as te,g as be,S as he,bw as ye,aG as ke,bo as we,bp as Se,ak as Me,I as Te,K as De,J as Pe,v as xe,bx as Ee,M as Ne,a4 as ne}from"./index.21c0d750.js";import{u as qe,a as Re}from"./http.7151dc47.js";import{D as oe}from"./datetime.3abe85e9.js";function Ue(C){return new Promise((S,y)=>{const v=new FileReader;v.readAsDataURL(C),v.onload=()=>S(v.result),v.onerror=M=>y(M)})}const je={style:{border:"solid 1px #eee",overflow:"hidden"}},Be=ce({__name:"index",setup(C){var I,J,K;const S=pe(),y=w(!1),v=w(!1),M=w(),H=ve(),L=w(),j=w(!1),ie={name:[{required:!0,message:"Nama wajib diisi",trigger:["input","blur"]}],phone:[{required:!0,message:"No Hp wajib diisi",trigger:["input","blur"]}],email:[{required:!0,message:"Email wajib diisi",trigger:["input","blur"]},{type:"email",message:"Masukkan email valid",trigger:["input","blur"]}],department:[{required:!0,message:"Jabatan wajib diisi",trigger:["input","blur"]}]},u=w({id:(I=S.query.id)==null?void 0:I.toString(),manifest_id:(J=S.query.manifest_id)==null?void 0:J.toString(),department:void 0,name:void 0,phone:void 0,email:void 0,signature:void 0,packings:(K=S.query.packings)==null?void 0:K.toString().split(",").map(e=>({id:e}))}),{mutate:le,isLoading:ue}=qe("shipping/v1/driver/reception/confirm",{method:"POST",queryOptions:{onError:e=>{const t=e.data.validation;Object.keys(t).forEach(l=>{t[l].forEach(s=>{H.error(`${s}`)})})},onSuccess:e=>{H.success(e==null?void 0:e.message),j.value=!0}}}),{data:c,isFetching:se}=Re(Z(()=>`shipping/v1/manifest-log/detail/${S.query.id}`),{queryOptions:{onSuccess:e=>{var t,l,s,r,h,p,m,f,k;u.value.manifest_id=(l=(t=e==null?void 0:e.data)==null?void 0:t.manifest)==null?void 0:l.id,u.value.name=(r=(s=e==null?void 0:e.data)==null?void 0:s.attributes)==null?void 0:r.receiver.name,u.value.phone=(p=(h=e==null?void 0:e.data)==null?void 0:h.attributes)==null?void 0:p.receiver.phone,u.value.email=(f=(m=e==null?void 0:e.data)==null?void 0:m.attributes)==null?void 0:f.receiver.email,j.value=((k=e==null?void 0:e.data)==null?void 0:k.is_confirmed)||!1}}}),re={width:500,height:200},g=w([]),O=()=>{v.value=!1},F=()=>{var t,l;v.value=!0;const e=(l=(t=M.value)==null?void 0:t.getStage())==null?void 0:l.getPointerPosition();v.value&&(g.value=[...g.value,{points:[e==null?void 0:e.x,e==null?void 0:e.y],color:"#000",mode:"brush"}])},A=()=>{var l,s;if(!v.value)return;const e=(s=(l=M.value)==null?void 0:l.getStage())==null?void 0:s.getPointerPosition(),t=g.value[g.value.length-1];t.points=t.points.concat([e.x,e.y]),g.value.splice(g.value.length-1,1,t),g.value=g.value.concat()},de=async()=>{var r;const e=(r=M.value)==null?void 0:r.getStage().toDataURL({pixelRatio:2}),l=await(await fetch(e)).blob(),s=new File([l],"sign.png",{type:"image/png"});u.value.signature=await Ue(s),y.value=!1},me=()=>{var e;(e=L.value)==null||e.validate(t=>{t!=null&&t.length||le(u.value)})},_e=Z(()=>{var e,t,l,s,r,h,p,m,f,k,T,x,E,N,q,R,a,d,_,D,W,$,V,G,Y,z,Q,X;return[(s=(l=(t=(e=c.value)==null?void 0:e.data)==null?void 0:t.delivery_order)==null?void 0:l.destination)==null?void 0:s.name,(p=(h=(r=c.value)==null?void 0:r.data)==null?void 0:h.delivery_order)==null?void 0:p.destination.address.detail,(k=(f=(m=c.value)==null?void 0:m.data)==null?void 0:f.delivery_order)==null?void 0:k.destination.address.urban_village.name,(R=(q=(N=(E=(x=(T=c.value)==null?void 0:T.data)==null?void 0:x.delivery_order)==null?void 0:E.destination)==null?void 0:N.address)==null?void 0:q.sub_district)==null?void 0:R.name,($=(W=(D=(_=(d=(a=c.value)==null?void 0:a.data)==null?void 0:d.delivery_order)==null?void 0:_.destination)==null?void 0:D.address)==null?void 0:W.district)==null?void 0:$.name,(X=(Q=(z=(Y=(G=(V=c.value)==null?void 0:V.data)==null?void 0:G.delivery_order)==null?void 0:Y.destination)==null?void 0:z.address)==null?void 0:Q.province)==null?void 0:X.name].filter(Boolean).join(", ")});return(e,t)=>{const l=ye,s=ke,r=we,h=Se,p=Me,m=Te,f=De,k=Pe,T=xe,x=Ee,E=B("v-line"),N=B("v-layer"),q=B("v-stage"),R=Ne;return i(j)?(U(),ee(l,{key:0,status:"success",title:"Berhasil konfirmasi penerimaan barang"})):(U(),ae(te,{key:1},[n(x,{show:i(se)},{default:o(()=>[n(T,{vertical:"",style:{"row-gap":"2rem",padding:"3rem"}},{default:o(()=>[n(s,null,{default:o(()=>[b(" Form Serah Terima ")]),_:1}),n(h,null,{default:o(()=>[n(r,null,{default:o(()=>{var a,d,_;return[b(" ID DO : "+P((_=(d=(a=i(c))==null?void 0:a.data)==null?void 0:d.do)==null?void 0:_.code),1)]}),_:1}),n(r,null,{default:o(()=>[b(" Tujuan : "+P(i(_e)),1)]),_:1})]),_:1}),n(h,null,{default:o(()=>[n(r,null,{default:o(()=>{var a,d,_;return[b(" Nama Driver : "+P((_=(d=(a=i(c))==null?void 0:a.data)==null?void 0:d.driver)==null?void 0:_.name),1)]}),_:1}),n(r,null,{default:o(()=>{var a,d;return[b(" Tanggal Diterima : "+P(i(oe).fromISO((d=(a=i(c))==null?void 0:a.data)==null?void 0:d.created_at).toLocaleString(i(oe).DATE_MED_WITH_WEEKDAY,{locale:"id"})),1)]}),_:1}),n(r,null,{default:o(()=>{var a,d,_,D;return[b(" Plat No Kendaraan : "+P((D=(_=(d=(a=i(c))==null?void 0:a.data)==null?void 0:d.driver)==null?void 0:_.vehicle)==null?void 0:D.plate_number),1)]}),_:1})]),_:1}),n(k,{ref_key:"formRef",ref:L,onSubmit:ge(me,["prevent"]),rules:ie,model:i(u)},{default:o(()=>[n(m,{label:"Nama Penerima",path:"name"},{default:o(()=>[n(p,{value:i(u).name,"onUpdate:value":t[0]||(t[0]=a=>i(u).name=a),type:"text",placeholder:"Masukkan Nama Penerima"},null,8,["value"])]),_:1}),n(m,{label:"No. HP Penerima",path:"phone"},{default:o(()=>[n(p,{value:i(u).phone,"onUpdate:value":t[1]||(t[1]=a=>i(u).phone=a),type:"text",placeholder:"Masukkan No. HP Penerima"},null,8,["value"])]),_:1}),n(m,{label:"Email Penerima",path:"email"},{default:o(()=>[n(p,{value:i(u).email,"onUpdate:value":t[2]||(t[2]=a=>i(u).email=a),type:"text",placeholder:"Masukkan Email Penerima"},null,8,["value"])]),_:1}),n(m,{label:"Jabatan Penerima",path:"department"},{default:o(()=>[n(p,{value:i(u).department,"onUpdate:value":t[3]||(t[3]=a=>i(u).department=a),type:"text",placeholder:"Masukkan Jabatan Penerima"},null,8,["value"])]),_:1}),n(m,{label:"Tanda Tangan Digital"},{default:o(()=>[n(f,{text:"",onClick:t[4]||(t[4]=a=>y.value=!0)},{default:o(()=>[b(" + Tanda Tangan Digital ")]),_:1})]),_:1}),n(f,{loading:i(ue),"attr-type":"submit"},{default:o(()=>[b(" Terima ")]),_:1},8,["loading"])]),_:1},8,["onSubmit","model"])]),_:1})]),_:1},8,["show"]),n(R,{show:i(y),"onUpdate:show":t[5]||(t[5]=a=>he(y)?y.value=a:null),preset:"card",title:"Masukkan Tanda Tangan Anda"},{default:o(()=>[n(T,{vertical:""},{default:o(()=>[fe("div",je,[n(q,{ref_key:"stage",ref:M,config:re,onTouchstart:F,onTouchmove:A,onMousedown:F,onMousemove:A,onTouchend:O,onMouseup:O},{default:o(()=>[n(N,null,{default:o(()=>[(U(!0),ae(te,null,be(i(g),a=>(U(),ee(E,{key:a==null?void 0:a.points,config:{points:a==null?void 0:a.points,stroke:a==null?void 0:a.color,strokeWidth:3,lineCap:"round",globalCompositeOperation:a.mode=="erase"?"destination-out":"source-over"}},null,8,["config"]))),128))]),_:1})]),_:1},512)]),n(T,null,{default:o(()=>[n(f,{onClick:de},{default:o(()=>[b(" Simpan ")]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])],64))}}});typeof ne=="function"&&ne(Be);export{Be as default};
