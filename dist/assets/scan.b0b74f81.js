import{_ as re}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as _e}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as fe,b as pe,E as me,r as b,f as he,a1 as ge,p as ye,o as _,c as k,a as s,i as e,k as a,h as F,w as t,q as c,t as d,j,F as N,ak as ve,S as be,al as ke,ah as we,g as O,aG as Ce,a9 as xe,v as Se,s as De,a7 as je,ac as ze,ar as Ke,L as qe,a8 as Ae,K as Ie,aa as Be}from"./index.21c0d750.js";import{a as P}from"./adjustment.098753fc.js";import{_ as Re}from"./modal-produk-hilang.vue_vue_type_script_setup_true_lang.1273b82e.js";import{C as Me}from"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";import"./moment.62d3fb0a.js";const Ne={class:"body-tnt"},Pe={key:0,class:"card-tnt"},Qe={key:0,class:"card-tnt",style:{"margin-top":"0","background-color":"#eeeeee"}},Ee={key:1,class:"card-tnt",style:{"margin-top":"0"}},Fe={class:"table-tnt",style:{"margin-top":"10px"}},Le=s("thead",null,[s("tr",null,[s("th",null,"No"),s("th",null,"Kode Serialisasi"),s("th",{style:{"text-align":"center"}},"Level"),s("th",null,"Batch"),s("th",{style:{"text-align":"center"}},"Qty"),s("th",{style:{"text-align":"center"}},"Aksi")])],-1),Te={style:{"text-align":"center"}},$e={style:{"text-align":"center"}},He={style:{"text-align":"center"}},Ve={key:2,class:"card-tnt",style:{"margin-top":"0"}},Ue={class:"table-tnt",style:{"margin-top":"10px"}},We=s("thead",null,[s("tr",null,[s("th",null,"No"),s("th",null,"Kode Serialisasi"),s("th",{style:{"text-align":"center"}},"Level"),s("th",null,"Batch"),s("th",{style:{"text-align":"center"}},"Qty")])],-1),Ge={style:{"text-align":"center"}},Oe={style:{"text-align":"center"}},Ye={class:"bottom-action-button"},Je={class:"action-item"},it=fe({__name:"scan",setup(Xe){const V=pe(),w=me(),L=b(!1),p=b(!1),z=b({}),m=b({}),v=b({}),i=b([]),x=b(""),Q=b(null),T=b({show:!1});he(()=>{U()});async function U(){L.value=!0,Y(),await J(),await X(),L.value=!1}async function Y(){const f=V.params.id;await P.getDetailAdjustment(f).then(n=>{z.value=n.data}).catch(n=>{const l=n.response.data;w.error(l.message)})}async function J(){const f=localStorage.getItem("product_id");await P.getDetailProduct(f).then(async n=>{m.value=n.data}).catch(n=>{const l=n.response.data;w.error(l.message)})}async function X(){const f=localStorage.getItem("product_id"),n={adjustment_id:V.params.id,adjustment_product_id:f,limit:1e3};await P.getListDetailAdjustment(n).then(async l=>{v.value=l.data}).catch(l=>{const h=l.response.data;w.error(h.message)})}function Z(){T.value.show=!0}function ee(){T.value.show=!1}function te(f){f.forEach(n=>{i.value.length>0?i.value.forEach(l=>{if(n.id!==l.id){const h=i.value.filter(q=>q.id!==n.id);i.value=h,i.value.push({id:n.id,code:n.code,serialize:{level:n.level,first_level_qty:n.qty},reception:{batch_number:n.batch_number}})}}):i.value.push({id:n.id,code:n.code,serialize:{level:n.level,first_level_qty:n.qty},reception:{batch_number:n.batch_number}})})}async function $(){p.value=!0;const f=x.value,n=localStorage.getItem("product_id");await P.getDetailByCodeAdjustment(f,n).then(l=>{var h,q,g,y;i.value.length>0?parseInt((q=(h=l==null?void 0:l.data)==null?void 0:h.serialize)==null?void 0:q.first_level_qty)+K(v.value.list)+K(i.value)>m.value.qty?w.error("Qty serialisasi tidak dapat melebihi Qty Adjustment"):i.value.forEach(S=>{var D;if(S.code===l.data.code)w.error("Kode serialisasi sudah ada di list");else{const A=i.value.filter(I=>I.code!==l.data.code);i.value=A,i.value.push(l.data),(D=Q.value)==null||D.focus()}}):parseInt((y=(g=l==null?void 0:l.data)==null?void 0:g.serialize)==null?void 0:y.first_level_qty)+K(v.value.list)>m.value.qty?w.error("Qty serialisasi tidak dapat melebihi Qty Adjustment"):v.value.list.length>0?v.value.list.forEach(S=>{var D;if(S.serialize.code===l.data.code)w.error("Kode serialisasi sudah ada di list");else{const A=i.value.filter(I=>I.code!==l.data.code);i.value=A,i.value.push(l.data),(D=Q.value)==null||D.focus()}}):i.value.push(l.data),x.value="",p.value=!1}).catch(l=>{x.value="",p.value=!1;const h=l.response.data;w.error(h.message)}).finally(()=>{var l;(l=Q.value)==null||l.focus()})}function K(f){let n=0;return f.forEach(l=>{n+=l.serialize.first_level_qty}),n}function ae(){oe()}function ne(){p.value=!0;const f=localStorage.getItem("product_id"),n=new FormData;n.append("adjustment_product_id",f),i.value.forEach(l=>{n.append("codes[]",l.code)}),P.updateAdjustment(n).then(()=>{p.value=!1,setTimeout(()=>{u.value.title="Berhasil",u.value.subtitle=`${K(i.value)} kode serialisasi berhasil dikonfirmasi`,ie()},300)}).catch(l=>{p.value=!1;const h=l.response.data;w.error(h.message)})}const u=b({show:b(!1),type:"",icon:ge(),iconColor:"",hideIcon:!1,title:"",subtitle:"",align:"center"});function le(){u.value.show=!1}function se(){i.value=[],U(),u.value.show=!1}function oe(){u.value.type="confirm",u.value.hideIcon=!0,u.value.title="Konfirmasi",u.value.subtitle="Apakah Anda yakin untuk melakukan adjustment?",u.value.show=!0}function ie(){u.value.type="success",u.value.hideIcon=!1,u.value.iconColor="#219653",u.value.icon=Me,u.value.show=!0}return(f,n)=>{const l=_e,h=Ce,q=xe,g=Se,y=De,S=je,D=ze,A=Ke,I=qe,ue=Ae,C=Ie,W=Be,ce=ye("router-link"),de=re;return _(),k(N,null,[s("div",Ne,[e(L)?(_(),k("div",Pe,[a(l)])):(_(),F(g,{key:1,vertical:"",size:24},{default:t(()=>{var E,G;return[a(g,{justify:"space-between"},{default:t(()=>[a(g,{align:"center"},{default:t(()=>[a(h,{style:{"font-weight":"500","font-size":"16px",margin:"auto"}},{default:t(()=>{var o;return[c(" Kode Produk : "+d((o=e(m).product)==null?void 0:o.item_code),1)]}),_:1}),a(q,{round:"",bordered:!1,strong:"",type:e(z).status==="complete"?"success":"warning",size:"large"},{default:t(()=>[c(d(e(z).status),1)]),_:1},8,["type"])]),_:1})]),_:1}),a(ue,{cols:12},{default:t(()=>[a(S,{span:6},{default:t(()=>[a(g,{vertical:""},{default:t(()=>[a(y,null,{default:t(()=>{var o;return[c("Nama Produk : "+d((o=e(m).product)==null?void 0:o.short_name),1)]}),_:1}),a(y,null,{default:t(()=>[c("Batch : "+d(e(m).batch),1)]),_:1})]),_:1})]),_:1}),a(S,{span:6},{default:t(()=>[a(g,{vertical:""},{default:t(()=>[a(y,null,{default:t(()=>{var o,r;return[c("Building : "+d((r=(o=e(m).from)==null?void 0:o.building)==null?void 0:r.name),1)]}),_:1}),a(y,null,{default:t(()=>{var o,r;return[c("Room : "+d((r=(o=e(m).from)==null?void 0:o.room)==null?void 0:r.name),1)]}),_:1})]),_:1})]),_:1}),a(S,{span:6},{default:t(()=>[a(g,{vertical:""},{default:t(()=>[a(y,null,{default:t(()=>{var o,r;return[c("Rack : "+d((r=(o=e(m).from)==null?void 0:o.rack_pallete)==null?void 0:r.name),1)]}),_:1}),a(y,null,{default:t(()=>{var o,r;return[c("Bin : "+d((r=(o=e(m).from)==null?void 0:o.bin)==null?void 0:r.name),1)]}),_:1})]),_:1})]),_:1}),a(S,{span:6},{default:t(()=>[a(I,{style:{width:"300px","text-align":"center","border-radius":"15px",background:"#eee"}},{default:t(()=>{var o;return[a(D,{style:{"font-size":"14px"}},{default:t(()=>[c("Qty Terkonfirmasi/Qty Adjust")]),_:1}),(o=e(v))!=null&&o.list?(_(),F(A,{key:0,style:{"margin-top":"0px"}},{default:t(()=>[c(d(K(e(v).list)+"/"+e(m).qty),1)]),_:1})):j("",!0)]}),_:1})]),_:1})]),_:1}),((E=e(v))==null?void 0:E.list)&&e(z).status!=="cancel"?(_(),k(N,{key:0},[K(e(v).list)!==e(z).total_qty?(_(),k("div",Qe,[a(g,{vertical:"",align:"center"},{default:t(()=>[a(y,null,{default:t(()=>[c("Silakan masukkan Kode Serialisasi")]),_:1}),a(g,null,{default:t(()=>[a(e(ve),{ref_key:"input",ref:Q,value:e(x),"onUpdate:value":n[0]||(n[0]=o=>be(x)?x.value=o:null),placeholder:"",clearable:"",onKeyup:ke($,["enter"]),style:{width:"35rem"}},null,8,["value","onKeyup"]),a(C,{loading:e(p),disabled:e(x)=="",strong:"",secondary:"",type:"primary",class:"button-tnt",onClick:$},{default:t(()=>[c("Cari")]),_:1},8,["loading","disabled"])]),_:1}),a(C,{type:"primary",text:"",onClick:we(Z,["prevent"])},{default:t(()=>[c(" Ambil Kode dari Warehouse Produk Hilang ")]),_:1},8,["onClick"]),a(D,{style:{"font-size":"0.8rem"}},{default:t(()=>[c("Atau Scan Kode")]),_:1}),a(C,{loading:e(p),disabled:e(x)=="",type:"primary",class:"button-tnt",onClick:$},{default:t(()=>[c(" Scan Kode ")]),_:1},8,["loading","disabled"])]),_:1})])):j("",!0)],64)):j("",!0),e(i).length>0?(_(),k("div",Ee,[a(y,null,{default:t(()=>[c("Serialisasi Terscan / Warehouse Hilang")]),_:1}),s("div",Fe,[a(W,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:t(()=>[Le,s("tbody",null,[(_(!0),k(N,null,O(e(i),(o,r)=>{var B,R,M;return _(),k("tr",{key:r},[s("td",null,d(r+1),1),s("td",null,d(o.code),1),s("td",Te,d((B=o.serialize)==null?void 0:B.level),1),s("td",null,d((R=o.reception)==null?void 0:R.batch_number),1),s("td",$e,d((M=o.serialize)==null?void 0:M.first_level_qty),1),s("td",He,[a(C,{text:"",type:"error",onClick:H=>e(i).splice(r,1)},{default:t(()=>[c(" Hapus ")]),_:2},1032,["onClick"])])])}),128))])]),_:1})])])):j("",!0),((G=e(v).list)==null?void 0:G.length)>0?(_(),k("div",Ve,[a(y,null,{default:t(()=>[c("Serialisasi Terkonfirmasi")]),_:1}),s("div",Ue,[a(W,{"single-line":!1,"bottom-bordered":!1,bordered:!1},{default:t(()=>[We,s("tbody",null,[(_(!0),k(N,null,O(e(v).list,(o,r)=>{var B,R,M,H;return _(),k("tr",{key:r},[s("td",null,d(r+1),1),s("td",null,d((B=o.serialize)==null?void 0:B.code),1),s("td",Ge,d((R=o.serialize)==null?void 0:R.level),1),s("td",null,d((M=o.serialize)==null?void 0:M.batch),1),s("td",Oe,d((H=o.serialize)==null?void 0:H.first_level_qty),1)])}),128))])]),_:1})])])):j("",!0)]}),_:1})),s("div",Ye,[s("div",Je,[a(ce,{to:{name:"penyimpanan-penyesuaian-id"},class:"text-decoration-none"},{default:t(()=>[a(C,{loading:e(p),color:"#828282",class:"button-tnt",style:{width:"120px"}},{default:t(()=>[c("Kembali")]),_:1},8,["loading"])]),_:1}),e(z).status==="pending"?(_(),F(C,{key:0,disabled:e(i).length===0,loading:e(p),type:"primary",class:"button-tnt",style:{width:"120px"},onClick:ae},{default:t(()=>[c(" Konfirmasi ")]),_:1},8,["disabled","loading"])):j("",!0)])])]),a(Re,{show:e(T).show,product:e(m),"onClick:close":ee,"onClick:input":te},null,8,["show","product"]),a(de,{show:e(u).show,"onUpdate:show":n[1]||(n[1]=E=>e(u).show=E),icon:e(u).icon,"hide-icon":e(u).hideIcon,title:e(u).title,subtitle:e(u).subtitle,align:e(u).align},{default:t(()=>[a(g,{justify:"center"},{default:t(()=>[e(u).type=="confirm"?(_(),k(N,{key:0},[a(C,{loading:e(p),color:"#828282",class:"button-tnt",onClick:le},{default:t(()=>[c(" Tutup ")]),_:1},8,["loading"]),a(C,{loading:e(p),type:"primary",class:"button-tnt",onClick:ne},{default:t(()=>[c(" Yakin ")]),_:1},8,["loading"])],64)):j("",!0),e(u).type=="success"?(_(),F(C,{key:1,color:"#828282",class:"button-tnt",onClick:se},{default:t(()=>[c(" Tutup ")]),_:1})):j("",!0)]),_:1})]),_:1},8,["show","icon","hide-icon","title","subtitle","align"])],64)}}});export{it as default};
