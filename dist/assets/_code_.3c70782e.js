import{_ as ce}from"./t-scan-modal.vue_vue_type_script_setup_true_lang.af24c4ce.js";import{_ as de}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{p as z,_ as me}from"./pengemasan.c1a27849.js";import{_ as _e}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as pe,b as fe,u as ve,E as ge,W as V,r as g,f as he,o as $,c as U,a as Q,i as l,h as D,w as n,k as a,q as c,t as _,j as J,F as O,g as ke,S as j,af as ye,am as be,an as we,v as xe,aJ as ze,s as Ie,ad as Se,N as $e,K as Ke,a9 as Ne,ae as Ce,aS as Le,y as Be,aQ as Pe,a4 as W}from"./index.21c0d750.js";import{A as Ve}from"./Add.4f3b52cf.js";import{E as De}from"./EllipsisVertical.56989e7a.js";import"./CheckmarkCircleOutline.8fddcae1.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const je={class:"body-tnt"},qe={class:"table-tnt",style:{"margin-top":"0"}},Ee=pe({__name:"[code]",setup(Me){const h=fe(),q=ve(),d=ge(),G=V(()=>{var s,e;return[{label:"No"},{label:"ID Level "+(parseInt((e=(s=o.value)==null?void 0:s.serialize)==null?void 0:e.level)-1)},{label:"Batch"},{label:"Aksi",style:{width:"3rem"}}]}),X=V(()=>[{label:"Hapus",key:"delete"}]),w=g(!1),k=g(!1),o=g(),y=g(!1),B=g(!1),x=g([]),I=g(""),K=g([]),v=V(()=>[...K.value,...x.value]);he(async()=>{w.value=!0,await Y(),await E(),w.value=!1});async function Y(){const{data:s}=await z.detailKemasan({code:h.params.code,level:h.params.level,reception_id:h.params.id});o.value=s}async function E(){var e,m,r,u,b;const{data:s}=await z.listItemKemas(o.value.id,{limit:(r=(m=(e=o.value)==null?void 0:e.serialize)==null?void 0:m.maximum)!=null?r:10});K.value=s.list,v.value.length<((b=(u=o.value)==null?void 0:u.serialize)==null?void 0:b.maximum)&&(y.value=!0)}async function Z(s){var m,r,u,b,f,S;if(!s){d.error("Kode packing tidak boleh kosong");return}k.value=!0;const{data:e}=await ee(s);if(k.value=!1,["void"].includes(e.status)){d.error("Status serialisasi void tidak dapat ditambahkan");return}if(h.params.level=="2"&&((m=e.serialize)==null?void 0:m.level)!=1){d.error("Item tidak ditemukan.");return}if(((u=(r=o.value)==null?void 0:r.serialize)==null?void 0:u.maximum)<=v.value.length){d.error("Kemasan penuh"),y.value=!1;return}if(!((b=e.print)!=null&&b.is_printed)){d.error("Label item belum tercetak");return}if(e.is_packed){d.error("Item sudah dikemas (items packed)");return}x.value.findIndex(N=>N.id==e.id)==-1?(d.success("Item berhasil ditambahkan"),x.value.push(e),((S=(f=o.value)==null?void 0:f.serialize)==null?void 0:S.maximum)==v.value.length&&(M(),y.value=!1)):d.warning("Item sudah ditambahkan sebelumnya")}async function ee(s){var e,m;return((e=o.value.serialize)==null?void 0:e.level)>2?await z.detailKemasan({code:s,level:((m=o.value.serialize)==null?void 0:m.level)-1+"",reception_id:h.params.id}).catch(r=>{k.value=!1;let u=r.message;throw r.response.data&&(u=r.response.data.message),d.error(u),r}).finally(()=>{k.value=!1,I.value=""}):await z.detailItem({code:s,reception_detail_id:o.value.id}).catch(r=>{k.value=!1;let u=r.message;throw r.response.data&&(u=r.response.data.message),d.error(u),r}).finally(()=>{k.value=!1,I.value=""})}async function ae(s,e){if(e>K.value.length)x.value.splice(e-K.value.length,1);else{const m=v.value[e];await z.batalKemasItem({id_kemasan:o.value.id,id_item:m.id}),E()}d.success("Item berhasil dihapus")}async function M(){x.value.length>0&&(w.value=!0,await z.kemasItem({reception_detail_id:o.value.id,ids:x.value.map(s=>s.id)}).catch(s=>{let e=s.message;s.response.data&&(e=s.response.data.message),d.error(e)}).finally(()=>{w.value=!1})),d.success("Item berhasil dikemas"),q.push({name:"produksi-pengemasan-id",query:{level:h.params.level}})}function te(){q.push({name:"produksi-pengemasan-id",query:{level:h.params.level}})}return(s,e)=>{var F,H,R,T;const m=_e,r=ye,u=be,b=we,f=xe,S=ze,N=Ie,P=Se,A=$e,C=Ke,ne=Ne,se=Ce,L=Le,le=Be,oe=Pe,ie=me,re=de,ue=ce;return $(),U(O,null,[Q("div",je,[l(w)?($(),D(m,{key:0})):($(),D(f,{key:1,vertical:"",size:24},{default:n(()=>[a(f,{vertical:"",size:0},{default:n(()=>[a(r,{style:{"margin-bottom":"0"}},{default:n(()=>{var t,i;return[c(" Packing Level "+_((i=(t=l(o))==null?void 0:t.serialize)==null?void 0:i.level),1)]}),_:1}),a(b,null,{default:n(()=>[a(u,{onClick:e[0]||(e[0]=t=>s.$router.push("/pengemasan"))},{default:n(()=>[c("Pengemasan")]),_:1}),a(u,{onClick:e[1]||(e[1]=t=>s.$router.push({name:"produksi-pengemasan-id",params:{id:s.$route.params.id}}))},{default:n(()=>[c("Detail Pengemasan")]),_:1}),a(u,null,{default:n(()=>{var t,i;return[c("Packing Level "+_((i=(t=l(o))==null?void 0:t.serialize)==null?void 0:i.level),1)]}),_:1})]),_:1})]),_:1}),a(se,{cols:"2","item-responsive":"",responsive:"screen","x-gap":16,"y-gap":16},{default:n(()=>[a(P,{span:"2 s:1"},{default:n(()=>[a(f,{vertical:"",size:0},{default:n(()=>[a(S,{style:{"margin-bottom":"5px"}},{default:n(()=>{var t,i,p;return[c(" Kode Level "+_((i=(t=l(o))==null?void 0:t.serialize)==null?void 0:i.level)+" : "+_((p=l(o))==null?void 0:p.code),1)]}),_:1}),a(S,{style:{"margin-bottom":"0"}},{default:n(()=>{var t,i;return[c(" Kode PK : "+_((i=(t=l(o))==null?void 0:t.reception)==null?void 0:i.pk_id),1)]}),_:1}),a(N,{style:{"margin-bottom":"0"}},{default:n(()=>{var t,i,p;return[c(_((p=(i=(t=l(o))==null?void 0:t.reception)==null?void 0:i.product)==null?void 0:p.long_name),1)]}),_:1}),J("",!0)]),_:1})]),_:1}),a(P,{span:"2 s:1"},{default:n(()=>[a(f,{justify:"end"},{default:n(()=>[a(C,{type:"warning",class:"button-tnt",style:{width:"120px"},onClick:e[2]||(e[2]=t=>y.value=!0)},{default:n(()=>[a(A,{component:l(Ve)},null,8,["component"]),c(" Scan ID ")]),_:1})]),_:1})]),_:1}),a(P,{span:"2 s:1"},{default:n(()=>[a(ne,{style:{"border-radius":"8px",width:"100%",padding:"1rem","justify-content":"center"},strong:""},{default:n(()=>[a(N,{style:{"text-align":"center"}},{default:n(()=>{var t,i;return[c(" Qty: "+_(l(v).length)+"/"+_((i=(t=l(o))==null?void 0:t.serialize)==null?void 0:i.maximum),1)]}),_:1})]),_:1})]),_:1})]),_:1}),Q("div",qe,[a(ie,{headers:l(G)},{default:n(()=>[($(!0),U(O,null,ke(l(v),(t,i)=>($(),D(oe,{key:t.id},{default:n(()=>[a(L,null,{default:n(()=>[c(_(i+1),1)]),_:2},1024),a(L,null,{default:n(()=>[c(_(t.code),1)]),_:2},1024),a(L,null,{default:n(()=>{var p;return[c(_((p=t==null?void 0:t.reception)==null?void 0:p.batch_number),1)]}),_:2},1024),a(L,null,{default:n(()=>[a(le,{trigger:"click",options:l(X),onSelect:p=>ae(p,i)},{default:n(()=>[a(C,{bordered:!1,circle:""},{default:n(()=>[a(A,{component:l(De)},null,8,["component"])]),_:1})]),_:2},1032,["options","onSelect"])]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["headers"])]),a(f,{justify:"center"},{default:n(()=>[a(C,{loading:l(w),type:"primary",class:"button-tnt",style:{width:"120px"},onClick:M},{default:n(()=>[c(" Simpan ")]),_:1},8,["loading"])]),_:1})]),_:1}))]),a(re,{show:l(B),"onUpdate:show":e[3]||(e[3]=t=>j(B)?B.value=t:null),title:"Selamat",subtitle:`${l(v).length} Item telah terkemas`},{default:n(()=>[a(f,{justify:"center"},{default:n(()=>[a(C,{type:"primary",onClick:te},{default:n(()=>[c("Selesai")]),_:1})]),_:1})]),_:1},8,["show","subtitle"]),J("",!0),a(ue,{show:l(y),"onUpdate:show":e[5]||(e[5]=t=>j(y)?y.value=t:null),code:l(I),"onUpdate:code":e[6]||(e[6]=t=>j(I)?I.value=t:null),title:`Packing Level ${((H=(F=l(o))==null?void 0:F.serialize)==null?void 0:H.level)-1}`,total_items:l(v).length,qty_max:(T=(R=l(o))==null?void 0:R.serialize)==null?void 0:T.maximum,loading:l(k),onScanned:Z},null,8,["show","code","title","total_items","qty_max","loading"])],64)}}});typeof W=="function"&&W(Ee);export{Ee as default};
