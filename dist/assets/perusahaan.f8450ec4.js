import{_ as se}from"./t-permission-modal.bdf6acbc.js";import{_ as re}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as ue}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as de,b as ce,E as pe,r as d,a1 as me,f as _e,aF as fe,p as ge,o as f,c as M,a as k,k as o,w as i,q as p,i as t,h,j as b,F as q,ah as be,af as ve,am as he,an as ke,ak as we,I as ye,s as Ce,H as Pe,K as Ve,aM as Ne,R as De,bq as Ue,v as xe,J as Be}from"./index.21c0d750.js";import{c as I}from"./constant.549d5c21.js";import{o as P}from"./option.2657b089.js";import{s as Fe}from"./storage.731d7fd8.js";import{m as $}from"./master-perusahaan.ac657e6f.js";import{C as Ee}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Ke}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const Me={class:"body-tnt"},qe={class:"card-tnt"},Ie=k("div",{class:"divider-horizontal-tnt",style:{"border-color":"#DFDFDF","margin-top":"5px"}},null,-1),$e={class:"bottom-action-button"},Se={class:"action-item"},Ze=de({__name:"perusahaan",setup(ze){const V=ce(),m=pe(),w=d(!1),c=d(!1),N=d([]),D=d([]),U=d([]),x=d([]),B=d(null),n=d({image:{id:"",url:""}}),F=d(),l=d({show:d(!1),icon:me(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),y=d({show:!1});_e(()=>{fe.isGranted(I.accessPrivileges.company+".update")?z():y.value.show=!0});function S(){y.value.show=!1}async function z(){w.value=!0;const a=V.params.id;await L(),await O(),await A(),await R(),await $.getDetailCompany(a).then(e=>{J(e.data),w.value=!1}).catch(e=>{w.value=!1;const s=e.response.data;m.error(s.message)})}async function L(){n.value.province=null;const a={limit:1e3};await P.getProvinces(a).then(e=>{N.value=[],e.data.list.forEach(u=>{N.value.push({label:u.name,value:u.id})})}).catch(e=>{const s=e.response.data;m.error(s.message)})}async function O(){n.value.district=null;const a={limit:1e3,province_id:n.value.province};await P.getDistricts(a).then(e=>{D.value=[],e.data.list.forEach(u=>{D.value.push({label:u.name,value:u.id})})}).catch(e=>{const s=e.response.data;m.error(s.message)})}async function A(){n.value.subDistrict=null;const a={limit:1e3,district_id:n.value.district};await P.getSubDistricts(a).then(e=>{U.value=[],e.data.list.forEach(u=>{U.value.push({label:u.name,value:u.id})})}).catch(e=>{const s=e.response.data;m.error(s.message)})}async function R(){n.value.urbanVillage=null;const a={limit:1e3,sub_district_id:n.value.subDistrict};await P.getUrbanVillages(a).then(e=>{x.value=[],e.data.list.forEach(u=>{x.value.push({label:u.name,value:u.id})})}).catch(e=>{const s=e.response.data;m.error(s.message)})}async function T(a){var s;return["image/png","image/jpeg"].indexOf(String((s=a.file.file)==null?void 0:s.type))===-1?(m.error("Format gambar harus png atau jpg, tolong upload ulang"),!1):!0}function j(a){c.value=!0;const e=new FormData;e.append("file",a.file.file),e.append("source","upload"),e.append("title",a.file.name),e.append("caption",a.file.name),e.append("alt",a.file.name),Fe.uploadStorage(e).then(s=>{n.value.image.id=s.data.data.id,n.value.image.url=s.data.data.public_url,c.value=!1}).catch(s=>{const u=s.response.data;m.error(u.message),c.value=!1})}async function G(a){var e;a.preventDefault(),await((e=B.value)==null?void 0:e.validate().then(()=>{Y()}).catch(()=>{m.error("Form tidak valid, tolong periksa kembali")}))}function H(){c.value=!0;const a={name:n.value.name,address:{detail:n.value.address},latitude:parseFloat(n.value.latitude),longitude:parseFloat(n.value.longitude),erp_code:n.value.erpCode,pbf_permisson_number:parseInt(n.value.pbfNumber),pak_permisson_number:parseInt(n.value.pakNumber),image_id:n.value.image.id,setting:{under_maintenance:!1}},e=V.params.id;$.updateCompany(e,a).then(()=>{c.value=!1,C(),setTimeout(()=>{Q()},300)}).catch(s=>{c.value=!1;const u=s.response.data;m.error(u.message),C(),setTimeout(()=>{W(u)},300)})}function J(a){n.value={name:a.name,province:a.address.province.id,district:a.address.district.id,subDistrict:a.address.sub_district.id,urbanVillage:a.address.urban_village.id,address:a.address.detail,longitude:String(a.location.coordinates[1]),latitude:String(a.location.coordinates[0]),erpCode:a.erp_code,serializationPrefiks:a.prefix,pbfNumber:String(a.pbf_permission_numer),pakNumber:String(a.pak_permission_numer),image:{id:a.image.id,url:a.image.url}}}function C(){l.value.show=!1}function Y(){l.value.type="confirm",l.value.hideIcon=!0,l.value.title="Konfirmasi",l.value.subtitle="Apakah Anda yakin untuk mengedit data perusahaan?",l.value.show=!0}function Q(){l.value.type="success",l.value.hideIcon=!1,l.value.iconColor="#219653",l.value.icon=Ee,l.value.title="Berhasil Edit Data",l.value.subtitle="Data perusahaan berhasil diedit",l.value.show=!0}function W(a){l.value.type="failed",l.value.hideIcon=!1,l.value.iconColor="#EB5757",l.value.icon=Ke,l.value.title="Gagal",Object.keys(a.validation).length>0?l.value.subtitle=a.validation:l.value.subtitle=a.message,l.value.show=!0}return F.value={name:{required:!0,message:"Nama perusahaan tidak boleh kosong",trigger:"blur"},province:{required:!0,message:"Provinsi tidak boleh kosong",trigger:"blur"},district:{required:!0,message:"Kota/Kabupaten tidak boleh kosong",trigger:"blur"},subDistrict:{required:!0,message:"Kecamatan tidak boleh kosong",trigger:"blur"},urbanVillage:{required:!0,message:"Kelurahan tidak boleh kosong",trigger:"blur"},address:{required:!0,message:"Keterangan alamat tidak boleh kosong",trigger:"blur"},longitude:{required:!0,validator(a,e){if(!e)return new Error("Longitude tidak boleh kosong");if(e.includes(","))return new Error("Longitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Longitude harus angka atau tidak valid")},trigger:["input","blur"]},latitude:{required:!0,validator(a,e){if(!e)return new Error("Latitude tidak boleh kosong");if(e.includes(","))return new Error("Latitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Latitude harus angka atau tidak valid")},trigger:["input","blur"]},erpCode:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:"blur"},serializationPrefiks:{required:!0,message:"Prefiks serialisasi tidak boleh kosong",trigger:"blur"},pbfNumber:{required:!0,message:"Nomor izin PBF tidak boleh kosong",trigger:"blur"},pakNumber:{required:!0,message:"Nomor izin PAK tidak boleh kosong",trigger:"blur"},imageUrl:{required:!1}},(a,e)=>{const s=ve,u=ge("router-link"),E=he,X=ke,Z=ue,g=we,_=ye,ee=Ce,Le=Pe,v=Ve,ae=Ne,te=De,ne=Ue,K=xe,oe=Be,le=re,ie=se;return f(),M(q,null,[k("div",Me,[o(s,{style:{"margin-bottom":"4px"}},{default:i(()=>[p("Edit Info Perusahaan")]),_:1}),o(X,null,{default:i(()=>[o(E,null,{default:i(()=>[o(u,{to:"/setting/master-perusahaan",class:"text-decoration-none"},{default:i(()=>[p(" Master Perusahaan ")]),_:1})]),_:1}),o(E,null,{default:i(()=>[p("Edit Info Perusahaan")]),_:1})]),_:1}),k("div",qe,[t(w)?(f(),h(Z,{key:0})):(f(),h(oe,{key:1,ref_key:"formRef",ref:B,class:"form-tnt","show-require-mark":!1,"label-width":80,model:t(n),rules:t(F)},{default:i(()=>[o(_,{label:"Nama Perusahaan",path:"name"},{default:i(()=>[o(g,{value:t(n).name,"onUpdate:value":e[0]||(e[0]=r=>t(n).name=r),placeholder:"Masukkan nama perusahaan"},null,8,["value"])]),_:1}),Ie,o(ee,{style:{display:"block","font-weight":"500",margin:"10px 0 15px 0"}},{default:i(()=>[p("Alamat Perusahaan")]),_:1}),b("",!0),b("",!0),b("",!0),b("",!0),o(_,{label:"Keterangan Alamat (Nama jalan dan No. Bangunan)",path:"address"},{default:i(()=>[o(g,{value:t(n).address,"onUpdate:value":e[5]||(e[5]=r=>t(n).address=r),placeholder:"Masukkan keterangan alamat"},null,8,["value"])]),_:1}),o(_,{label:"Longitude",path:"longitude"},{default:i(()=>[o(g,{value:t(n).longitude,"onUpdate:value":e[6]||(e[6]=r=>t(n).longitude=r),placeholder:"Masukkan longitude"},null,8,["value"])]),_:1}),o(_,{label:"Latitude",path:"latitude"},{default:i(()=>[o(g,{value:t(n).latitude,"onUpdate:value":e[7]||(e[7]=r=>t(n).latitude=r),placeholder:"Masukkan latitude"},null,8,["value"])]),_:1}),o(_,{label:"Kode ERP",path:"erpCode"},{default:i(()=>[o(g,{value:t(n).erpCode,"onUpdate:value":e[8]||(e[8]=r=>t(n).erpCode=r),placeholder:"Masukkan kode ERP"},null,8,["value"])]),_:1}),o(_,{label:"Prefiks Serialisasi",path:"serializationPrefiks"},{default:i(()=>[o(g,{value:t(n).serializationPrefiks,"onUpdate:value":e[9]||(e[9]=r=>t(n).serializationPrefiks=r),placeholder:"Masukkan prefiks serialisasi"},null,8,["value"])]),_:1}),o(_,{label:"Nomor Izin PBF",path:"pbfNumber"},{default:i(()=>[o(g,{value:t(n).pbfNumber,"onUpdate:value":e[10]||(e[10]=r=>t(n).pbfNumber=r),placeholder:"Masukkan nomor izin PBF"},null,8,["value"])]),_:1}),o(_,{label:"Nomor Izin PAK",path:"pakNumber"},{default:i(()=>[o(g,{value:t(n).pakNumber,"onUpdate:value":e[11]||(e[11]=r=>t(n).pakNumber=r),placeholder:"Masukkan nomor izin PAK"},null,8,["value"])]),_:1}),o(_,{label:"Ubah Logo",path:"imageUrl"},{default:i(()=>[o(ae,{action:"",onBeforeUpload:T,"show-file-list":!1,"custom-request":j},{default:i(()=>[o(v,{loading:t(c),color:"#219653",class:"button-tnt"},{default:i(()=>[p(" Ubah Logo ")]),_:1},8,["loading"])]),_:1})]),_:1}),t(c)?(f(),h(K,{key:5,size:8},{default:i(()=>[o(ne,{height:"90px",width:"96px"})]),_:1})):(f(),h(te,{key:4,width:"110",src:t(n).image.url,style:{"margin-top":"10px","border-radius":"12px"}},null,8,["src"]))]),_:1},8,["model","rules"]))]),k("div",$e,[k("div",Se,[o(u,{to:"/setting/master-perusahaan",class:"text-decoration-none"},{default:i(()=>[o(v,{color:"#828282",class:"button-tnt"},{default:i(()=>[p(" Kembali ")]),_:1})]),_:1}),a.$filters.isGranted(t(I).accessPrivileges.company+".update")?(f(),h(v,{key:0,color:"#219653",class:"button-tnt",loading:t(c),onClick:G},{default:i(()=>[p(" Simpan ")]),_:1},8,["loading"])):b("",!0)])])]),o(le,{show:t(l).show,"onUpdate:show":e[12]||(e[12]=r=>t(l).show=r),icon:t(l).icon,"icon-color":t(l).iconColor,"hide-icon":t(l).hideIcon,title:t(l).title,subtitle:t(l).subtitle},{default:i(()=>[o(K,{justify:"center"},{default:i(()=>[t(l).type=="confirm"?(f(),M(q,{key:0},[o(v,{loading:t(c),color:"#828282",class:"button-tnt",onClick:C},{default:i(()=>[p(" Tutup ")]),_:1},8,["loading"]),o(v,{loading:t(c),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:be(H,["prevent"])},{default:i(()=>[p(" Yakin ")]),_:1},8,["loading","onClick"])],64)):b("",!0),t(l).type=="success"?(f(),h(u,{key:1,to:{name:"setting-master-perusahaan"},class:"text-decoration-none"},{default:i(()=>[o(v,{color:"#219653",class:"button-tnt"},{default:i(()=>[p(" Kembali ke Beranda ")]),_:1})]),_:1})):b("",!0),t(l).type=="failed"?(f(),h(v,{key:2,color:"#828282",class:"button-tnt",onClick:C},{default:i(()=>[p(" Tutup ")]),_:1})):b("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),o(ie,{show:t(y).show,"onUpdate:show":e[13]||(e[13]=r=>t(y).show=r),"onClick:close":S},null,8,["show"])],64)}}});export{Ze as default};
