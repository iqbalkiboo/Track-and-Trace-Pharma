import{_ as Me}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as Ne}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as $e,b as Be,u as qe,E as Fe,r as c,W as Ue,a1 as Pe,f as Ae,p as Ee,o as _,c as S,a as u,i as t,k as a,F as A,w as l,q as g,t as b,g as ie,h as T,j as M,ah as ue,S as J,n as Ie,af as Oe,K as Le,v as Re,s as je,ad as Je,ae as Ke,aj as Qe,I as Ge,J as He,H as We,ak as Ye,N as Xe,b1 as Ze,a9 as et,aa as tt,ab as at,ag as lt}from"./index.21c0d750.js";import{h as K}from"./moment.62d3fb0a.js";import{a as nt,s as $}from"./serialisasi.378d5040.js";import{_ as ot}from"./modal-add-serialize.vue_vue_type_script_setup_true_lang.427f3a0a.js";import"./Add.4f3b52cf.js";import{C as st}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as it}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const ut={class:"body-tnt"},dt={key:0,class:"card-tnt"},rt=u("span",null,"No Perintah Kemas : ",-1),ct={style:{"font-weight":"500"}},_t=u("span",null,"Kode Produk : ",-1),pt={style:{"font-weight":"500"}},vt=u("span",null,"UOM : ",-1),ft={style:{"font-weight":"500"}},mt=u("span",null,"No Batch Produksi : ",-1),gt={style:{"font-weight":"500"}},ht=u("span",null,"Qty : ",-1),yt={style:{"font-weight":"500"}},kt={class:"card-tnt"},bt={style:{"margin-top":"18px"}},wt={class:"card-tnt"},St={class:"table-tnt",style:{"margin-top":"0"}},Ct=u("th",{style:{"text-align":"center"}},"No",-1),xt=u("th",null,"ID Serialisasi",-1),zt=u("th",null,"Status Cetak",-1),Vt={key:0,style:{"text-align":"center"}},Tt={style:{display:"flex","justify-content":"center"}},Dt=u("div",{style:{"padding-right":"10px"}},"Pilih Semua",-1),Mt={style:{"text-align":"center"}},Nt={key:0,style:{"text-align":"center"}},$t={style:{"text-align":"center"}},Bt={key:1,colspan:"4",style:{"text-align":"center"}},qt={class:"table-footer"},Ft={class:"bottom-action-button"},Ut={class:"action-item"},ea=$e({__name:"print",setup(Pt){const B=Be(),de=qe(),Q=Fe(),re=nt(),E=c(!1),r=c(!1),I=c(!1),w=c({}),O=c({}),C=c({}),Z=c(null),G=c(0),q=c(!1),y=c([]),ce=Ue(()=>[{label:"Semua Data",value:""},{label:"Belum Tercetak",value:0},{label:"Sudah Tercetak",value:1}]),k=c({qty:0,status:""}),d=c({is_printed:"",status:"",level:1,page:1,limit:10,reception_id:B.params.id}),s=c({show:c(!1),icon:Pe(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),x=c({}),F=c(!1);Ae(()=>{_e()});async function _e(){pe(),await ee("")}async function ee(o){E.value=!0;const e=B.params.id;await $.getDetailSerialize(e).then(i=>{var h;w.value=i.data,D(o==="after_add_qty"?d.value.level:(h=w.value)==null?void 0:h.serialize[0].level),me(i.data)}).catch(i=>{const h=i.response.data;Q.error(h.message)})}function pe(){const o=B.params.id;$.getDetailSerializeProduct(o).then(e=>{O.value=e.data}).catch(e=>{const i=e.response.data;Q.error(i.message)})}async function D(o){return I.value=!0,r.value=!0,d.value.level=o,Z.value==="void"?d.value.status="void":d.value.status="",await $.getSerializeLevel(d.value).then(e=>(C.value=e.data,C.value.list.forEach(i=>i.checked=!1),E.value=!1,I.value=!1,r.value=!1,q.value=!1,y.value=[],e.data)).catch(e=>{E.value=!1,I.value=!1,r.value=!1;const i=e.response.data;Q.error(i.message)})}function ve(o){d.value.page=1,d.value.limit=o,D(d.value.level)}const fe=c(null),p=c({}),At=c({}),Et=[{label:"Telah Dicetak",value:"yes"},{label:"Belum Dicetak",value:"no"}];function me(o){var e;o.serialize.forEach(i=>{if(i.qty===null)return i.qty=0}),o.date.manufacture_date!==null&&(p.value.manufacture_date=K(o.date.manufacture_date).format("yyyy-MM-DD")),o.date.expired_date!==null&&(p.value.expired_date=K(o.date.expired_date).format("yyyy-MM-DD")),o.date.package_start_date!==null&&(p.value.package_start_date=K(o.date.package_start_date).format("yyyy-MM-DD")),o.date.package_end_date!==null&&(p.value.package_end_date=K(o.date.package_end_date).format("yyyy-MM-DD")),p.value.highest_retail_price=Math.round((e=o.product)==null?void 0:e.highest_retail_price),p.value.serialize=o.serialize}function ge(o,e){G.value=o,d.value.page=1,D(e)}function he(){x.value.id=B.params.id,x.value.qty=0,x.value.level=d.value.level,F.value=!0}function ye(){r.value=!0;const o=new FormData;o.append("reception_id",x.value.id),o.append("level",String(d.value.level)),o.append("qty",x.value.qty),$.addSerializeQty(o).then(()=>{r.value=!1,ee("after_add_qty"),F.value=!1,G.value=0,z(),setTimeout(()=>{W()},300)}).catch(e=>{const i=e.response.data;r.value=!1,z(),setTimeout(()=>{Y(i)},300)})}function ke(){q.value?(y.value=[],C.value.list.forEach(o=>(y.value.push(o.id),o.checked=!0))):C.value.list.forEach(o=>(y.value=[],o.checked=!1))}function be(o,e){o.checked==!0?y.value.push(e):y.value=y.value.filter(function(i){return i!==e})}function H(o){k.value.qty=y.value.length,k.value.status=o,Se()}async function we(){r.value=!0;const o=String(B.params.id);if(k.value.status=="print"){const e=new FormData;e.append("reception_id",o),y.value.forEach(i=>{e.append("ids[]",i)}),$.printSerialize(e).then(()=>{var i,h,f;if(r.value=!1,localStorage.setItem("is_label_open","0"),localStorage.setItem("labels",JSON.stringify(re.labels=((h=(i=C.value)==null?void 0:i.list)!=null?h:[]).filter(V=>y.value.includes(V.id)))),d.value.level!=1){localStorage.setItem("config",JSON.stringify((f=O.value)==null?void 0:f.serialize)),localStorage.setItem("data",JSON.stringify(O.value)),localStorage.setItem("detail",JSON.stringify(w.value));const V=document.createElement("a");V.target="_blank",V.href=de.resolve({name:"print-labels"}).href,V.click(),V.remove()}z(),setTimeout(()=>{D(d.value.level),W()},300)}).catch(i=>{const h=i.response.data;r.value=!1,z(),setTimeout(()=>{Y(h)},300)})}else{const e=new FormData;k.value.status=="void"?e.append("kind","1"):e.append("kind","0"),y.value.forEach(i=>{e.append("ids[]",i)}),$.voidSerialize(e).then(()=>{r.value=!1,D(d.value.level),z(),setTimeout(()=>{W()},300)}).catch(i=>{const h=i.response.data;r.value=!1,z(),setTimeout(()=>{Y(h)},300)})}}function z(){s.value.show=!1}function Se(){s.value.type="confirm",s.value.hideIcon=!0,k.value.status=="print"?(s.value.title="Konfirmasi Cetak",s.value.subtitle=`Anda akan mencetak ${k.value.qty} id`):k.value.status=="void"?(s.value.title="Konfirmasi Void",s.value.subtitle=`Anda akan melakukan void ${k.value.qty} id`):(s.value.title="Konfirmasi Batal Void",s.value.subtitle=`Anda akan membatalkan void ${k.value.qty} id`),s.value.show=!0}function W(){s.value.type="success",s.value.hideIcon=!1,s.value.iconColor="#219653",s.value.icon=st,k.value.status=="print"?(s.value.title="Berhasil Cetak",s.value.subtitle="Proses cetak telah selesai dilakukan"):k.value.status=="void"?(s.value.title="Berhasil Void",s.value.subtitle="Proses void telah selesai dilakukan"):k.value.status=="cancel-void"?(s.value.title="Berhasil Batal Void",s.value.subtitle="Proses batal void telah selesai dilakukan"):(s.value.title="Generate Serialisasi Berhasil",s.value.subtitle=`${x.value.qty} kemasan level ${d.value.level} berhasil tergenerate`),s.value.show=!0}function Y(o){s.value.type="failed",s.value.hideIcon=!1,s.value.iconColor="#EB5757",s.value.icon=it,s.value.title="Gagal",Object.keys(o.validation).length>0?s.value.subtitle=o.validation:s.value.subtitle=o.message,s.value.show=!0}return(o,e)=>{const i=Ne,h=Oe,f=Le,V=Ee("router-link"),v=Re,U=je,N=Je,L=Ke,R=Qe,j=Ge,Ce=He,xe=We,It=Ye,Ot=Xe,te=Ze,ae=et,ze=tt,Ve=at,Te=lt,De=Me;return _(),S(A,null,[u("div",ut,[t(E)?(_(),S("div",dt,[a(i)])):(_(),S(A,{key:1},[a(v,{justify:"space-between"},{default:l(()=>[a(h,{style:{"margin-bottom":"16px"}},{default:l(()=>{var n;return[g(b((n=t(w).product)==null?void 0:n.short_name),1)]}),_:1}),a(V,{to:{name:"produksi-serialisasi-id-barcode"},class:"text-decoration-none"},{default:l(()=>[a(f,{type:"warning",class:"button-tnt"},{default:l(()=>[g("Cetak Serialisasi")]),_:1})]),_:1})]),_:1}),a(L,{cols:"3","item-responsive":"",responsive:"screen","x-gap":"16","y-gap":"16"},{default:l(()=>[a(N,{span:"3 m:1"},{default:l(()=>[a(v,{vertical:"",size:15},{default:l(()=>[a(v,{vertical:"",size:0},{default:l(()=>[a(U,{style:{"margin-bottom":"0"}},{default:l(()=>[rt,u("span",ct,b(t(w).pk_id),1)]),_:1})]),_:1}),a(v,{vertical:"",size:0},{default:l(()=>[a(U,{style:{"margin-bottom":"0"}},{default:l(()=>{var n;return[_t,u("span",pt,b((n=t(w).product)==null?void 0:n.item_code),1)]}),_:1})]),_:1}),a(v,{vertical:"",size:0},{default:l(()=>[a(U,{style:{"margin-bottom":"0"}},{default:l(()=>{var n;return[vt,u("span",ft,b((n=t(O).uom)==null?void 0:n.name),1)]}),_:1})]),_:1})]),_:1})]),_:1}),a(N,{span:"3 m:1"},{default:l(()=>[a(v,{vertical:"",size:15},{default:l(()=>[a(v,{vertical:"",size:0},{default:l(()=>[a(U,{style:{"margin-bottom":"0"}},{default:l(()=>[mt,u("span",gt,b(t(w).batch_number),1)]),_:1})]),_:1}),a(v,{vertical:"",size:0},{default:l(()=>[a(U,{style:{"margin-bottom":"0"}},{default:l(()=>[ht,u("span",yt,b(t(w).serialize?t(w).serialize[0].qty:0),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u("div",kt,[a(v,{vertical:"",size:24},{default:l(()=>[a(v,{vertical:"",size:0},{default:l(()=>[a(Ce,{ref_key:"formRef",ref:fe,class:"form-tnt","show-require-mark":!1,"label-width":80,model:t(p)},{default:l(()=>[a(L,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:l(()=>[a(N,{span:"4 m:1"},{default:l(()=>[a(j,{label:"Tanggal Manufaktur"},{default:l(()=>[a(R,{disabled:"","formatted-value":t(p).manufacture_date,"onUpdate:formattedValue":e[0]||(e[0]=n=>t(p).manufacture_date=n),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1}),a(N,{span:"4 m:1"},{default:l(()=>[a(j,{label:"Expired Date"},{default:l(()=>[a(R,{disabled:"","formatted-value":t(p).expired_date,"onUpdate:formattedValue":e[1]||(e[1]=n=>t(p).expired_date=n),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1})]),_:1}),a(L,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:l(()=>[a(N,{span:"4 m:1"},{default:l(()=>[a(j,{label:"Tanggal Mulai Pengemasan"},{default:l(()=>[a(R,{disabled:"","formatted-value":t(p).package_start_date,"onUpdate:formattedValue":e[2]||(e[2]=n=>t(p).package_start_date=n),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1}),a(N,{span:"4 m:1"},{default:l(()=>[a(j,{label:"Tanggal Selesai Pengemasan"},{default:l(()=>[a(R,{disabled:"","formatted-value":t(p).package_end_date,"onUpdate:formattedValue":e[3]||(e[3]=n=>t(p).package_end_date=n),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),u("div",bt,[a(L,{cols:"6","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:l(()=>[(_(!0),S(A,null,ie(t(w).serialize,(n,m)=>(_(),T(N,{span:"3 s:2 m:1",key:m},{default:l(()=>[a(f,{loading:t(r),block:"",color:"#219653",ghost:t(d).level!==n.level,class:"button-tnt",onClick:X=>ge(m,n.level)},{default:l(()=>[g(b(n.name)+" ("+b(n.qty>0?n.qty:0)+") ",1)]),_:2},1032,["loading","ghost","onClick"])]),_:2},1024))),128))]),_:1})]),u("div",wt,[a(v,{vertical:"",size:10},{default:l(()=>[M("",!0),a(v,{vertical:"",size:14},{default:l(()=>[a(v,null,{default:l(()=>[a(xe,{value:t(d).is_printed,"onUpdate:value":[e[6]||(e[6]=n=>t(d).is_printed=n),e[7]||(e[7]=n=>D(t(d).level))],disabled:t(r),options:t(ce),style:{width:"250px"}},null,8,["value","disabled","options"]),t(G)!==0?(_(),T(f,{key:0,loading:t(r),color:"#219653",ghost:"",class:"button-tnt",onClick:ue(he,["prevent"])},{default:l(()=>[g(" Tambah Serialisasi ")]),_:1},8,["loading","onClick"])):M("",!0)]),_:1}),t(y).length>0?(_(),T(v,{key:0,justify:"end"},{default:l(()=>[a(f,{type:"error",ghost:"",class:"button-tnt",onClick:e[8]||(e[8]=n=>H("cancel-void"))},{default:l(()=>[g(" Batalkan Void ")]),_:1}),a(f,{type:"error",ghost:"",class:"button-tnt",onClick:e[9]||(e[9]=n=>H("void"))},{default:l(()=>[g(" Void ")]),_:1}),a(f,{type:"primary",ghost:"",class:"button-tnt",onClick:e[10]||(e[10]=n=>H("print"))},{default:l(()=>[g(" Cetak ")]),_:1})]),_:1})):M("",!0),u("div",St,[t(I)?(_(),T(i,{key:0})):(_(),T(Ve,{key:1,"x-scrollable":""},{default:l(()=>[a(ze,{"single-line":!1},{default:l(()=>{var n;return[u("thead",null,[u("tr",null,[Ct,xt,zt,t(d).level!=1?(_(),S("th",Vt," Jumlah Tercetak ")):M("",!0),u("th",null,[u("div",Tt,[Dt,a(te,{size:"large",label:"",checked:t(q),"onUpdate:checked":e[11]||(e[11]=m=>J(q)?q.value=m:null),onClick:ke},null,8,["checked"])])])])]),u("tbody",null,[((n=t(C).list)==null?void 0:n.length)>0?(_(!0),S(A,{key:0},ie(t(C).list,(m,X)=>{var le,ne,oe,se;return _(),S("tr",{key:X,class:Ie(m.status==="print_void"?"bg-print-void":"")},[u("td",Mt,b(t(d).limit*(t(d).page-1)+(X+1)),1),u("td",null,b(m.code),1),u("td",null,[t(Z)=="void"?(_(),T(ae,{key:0,bordered:!1,type:"error"},{default:l(()=>[g(" Void ")]),_:1})):(_(),T(ae,{key:1,bordered:!1,type:(le=m.print)!=null&&le.is_printed?"success":"primary"},{default:l(()=>{var P;return[g(b((P=m.print)!=null&&P.is_printed?"Telah Dicetak":"Belum Dicetak"),1)]}),_:2},1032,["type"]))]),t(d).level!=1?(_(),S("td",Nt,b((se=(oe=(ne=m.print)==null?void 0:ne.logs)==null?void 0:oe.value)!=null?se:0),1)):M("",!0),u("td",$t,[a(te,{size:"large",label:"",checked:m.checked,"onUpdate:checked":P=>m.checked=P,onClick:P=>be(m,m.id)},null,8,["checked","onUpdate:checked","onClick"])])],2)}),128)):(_(),S("td",Bt," Belum ada data tersedia "))])]}),_:1})]),_:1})),u("div",qt,[a(Te,{page:t(d).page,"onUpdate:page":[e[12]||(e[12]=n=>t(d).page=n),e[13]||(e[13]=n=>D(t(d).level))],"page-count":t(C).total_page,"page-slot":7,"show-size-picker":t(C).total_data>10,"page-sizes":[10,20,30,40,50],"onUpdate:pageSize":ve},null,8,["page","page-count","show-size-picker"])])])]),_:1})]),_:1})])],64)),u("div",Ft,[u("div",Ut,[a(V,{to:"/produksi/serialisasi",class:"text-decoration-none"},{default:l(()=>[a(f,{color:"#828282",class:"button-tnt"},{default:l(()=>[g(" Kembali ")]),_:1})]),_:1})])])]),a(ot,{"is-show":t(F),"onUpdate:isShow":e[14]||(e[14]=n=>J(F)?F.value=n:null),value:t(x),"onUpdate:value":e[15]||(e[15]=n=>J(x)?x.value=n:null),loading:t(r),"onUpdate:loading":e[16]||(e[16]=n=>J(r)?r.value=n:null),"onClick:submit":ye},null,8,["is-show","value","loading"]),a(De,{show:t(s).show,"onUpdate:show":e[17]||(e[17]=n=>t(s).show=n),icon:t(s).icon,"icon-color":t(s).iconColor,"hide-icon":t(s).hideIcon,title:t(s).title,subtitle:t(s).subtitle},{default:l(()=>[a(v,{justify:"center"},{default:l(()=>[t(s).type=="confirm"?(_(),S(A,{key:0},[a(f,{loading:t(r),color:"#828282",class:"button-tnt",onClick:z},{default:l(()=>[g(" Tutup ")]),_:1},8,["loading"]),a(f,{loading:t(r),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:ue(we,["prevent"])},{default:l(()=>[g(" Yakin ")]),_:1},8,["loading","onClick"])],64)):M("",!0),t(s).type=="success"?(_(),T(f,{key:1,color:"#828282",class:"button-tnt",onClick:z},{default:l(()=>[g(" Tutup ")]),_:1})):M("",!0),t(s).type=="failed"?(_(),T(f,{key:2,color:"#828282",class:"button-tnt",onClick:z},{default:l(()=>[g(" Tutup ")]),_:1})):M("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"])],64)}}});export{ea as default};
