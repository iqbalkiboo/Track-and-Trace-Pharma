import{_ as ne}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as oe,u as re,b as le,E as ie,r as h,W as se,f as de,p as ue,o as w,c as C,a as _,i as t,h as U,F as $,k as e,w as a,q as d,t as b,ah as pe,j as _e,af as me,s as ce,v as ge,a7 as fe,K as ve,a8 as he,ar as be,H as ye,I as ke,ad as Pe,aj as we,ae as xe,ak as Te,N as Ne,a$ as Me,aM as Se,J as qe,a4 as j}from"./index.21c0d750.js";import{a as B,u as De}from"./http.7151dc47.js";import{g as S}from"./getCompanyId.7d0eb93b.js";import{s as Ee}from"./storage.731d7fd8.js";import{h as A}from"./moment.62d3fb0a.js";import{A as Oe}from"./AddOutline.a2e673de.js";const ze={class:"body-tnt"},He={class:"card-tnt",style:{"margin-bottom":"1rem"}},Ce={class:"card-tnt"},Ue={style:{"margin-bottom":"12px"}},$e={class:"bottom-action-button"},je={class:"action-item"},Be=oe({__name:"assign-porter",setup(Ae){const q=re(),x=le(),T=ie(),D=h(null),s=h({}),y=h(!0),l=h({porter:null,delivery_date:void 0,handover_date:void 0,images:[],receiver:{name:"",email:"",phone:""}}),E=h();E.value={porter:{required:!0,message:"Nama Pengirim tidak boleh kosong",trigger:["input","blur"]},delivery_date:{required:!0,message:"Tanggal Pengiriman tidak boleh kosong",trigger:["input","blur"]},handover_date:{required:!0,message:"Tanggal Penerimaan tidak boleh kosong",trigger:["input","blur"]},images:{type:"array",required:!0,message:"Bukti Serah Terima tidak boleh kosong",trigger:["input","blur"]},receiver:{name:{required:!0,message:"Nama Penerima tidak boleh kosong",trigger:["input","blur"]},email:{required:!0,validator(n,o){const i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(o){if(!o.match(i))return new Error("Email Penerimaa tidak valid")}else return new Error("Email Penerimaa tidak boleh kosong");return!0},trigger:["input","blur"]},phone:{required:!0,validator(n,o){if(o)if(/^\d*$/.test(o)){if(o.length<8)return new Error("No. Hp Penerimaa lebih dari 8 angka")}else return new Error("No. Hp Penerimaa harus angka");else return new Error("No. Hp Penerimaa tidak boleh kosong");return!0}}}};const{data:F}=B("/user/v1/list",{params:{limit:1e4,company_id:S,user_type:"porter"},keys:["porter"],queryOptions:{onSuccess:()=>{y.value=!1}}}),{mutate:I,isLoading:V}=De("shipping/v1/manifest/assign-porter",{method:"POST",httpOptions:{params:{company_id:S}},queryOptions:{onSuccess:()=>{q.push("/pengiriman/assign-porter")},onError:n=>{T.error(n.data.message)}}}),K=se(()=>{var n,o;return(o=(n=F.value)==null?void 0:n.data.list.map(i=>({label:i.name,value:i.id})))!=null?o:[]}),N=h([]);function R(n){var i;return["image/png","image/jpeg"].indexOf(String((i=n.file.file)==null?void 0:i.type))===-1?(T.error("Format gambar harus png atau jpg, tolong upload ulang"),!1):!0}async function Y({file:n,onFinish:o}){const i=new FormData;i.append("file",n.file),i.append("source","upload"),i.append("title",n.name),i.append("caption",n.name),i.append("alt",n.name);const m=await Ee.uploadStorage(i);l.value.images.push({id:m.data.data.id}),N.value.push({id:m.data.data.id,name:m.data.data.title,status:"finished",url:m.data.data.public_url}),o()}de(()=>{Z()});async function L(n){var o,i,m,p,u,c,f;l.value={delivery_date:n.delivery_date,handover_date:A((o=n.receiver_info)==null?void 0:o.received_date).format("YYYY-MM-DD"),receiver:{name:(i=n.receiver_info)==null?void 0:i.name,email:(m=n.receiver_info)==null?void 0:m.email,phone:(p=n.receiver_info)==null?void 0:p.phone},porter:(c=(u=n.driver_info)==null?void 0:u.porter)==null?void 0:c.id,images:null},N.value=(f=n.receiver_info)==null?void 0:f.images.map(k=>({id:k.id,name:"Bukti Serah Terima",status:"finished",url:k.public_url}))}function Z(){y.value=!0,B(`shipping/v1/manifest/detail/${x.params.id}`,{params:{company_id:S},queryOptions:{onSuccess:n=>{s.value=n.data,s.value.status!=="need_assign_porter"&&L(n.data),y.value=!1}}})}async function G(){var n;await((n=D.value)==null?void 0:n.validate().then(()=>{I({manifest_id:x.params.id,delivery_date:l.value.delivery_date,handover_date:l.value.handover_date,porter_id:l.value.porter,receiver:{name:l.value.receiver.name,email:l.value.receiver.email,phone:l.value.receiver.phone},images:l.value.images})}).catch(()=>{T.error("Form tidak valid, tolong periksa kembali")}))}function J(){localStorage.setItem("manifest_id",x.params.id);const n=q.resolve({path:"/print/loading-manifest"});window.open(n.href,"_blank")}return(n,o)=>{const i=ne,m=me,p=ce,u=ge,c=fe,f=ve,k=he,O=be,Q=ye,g=ke,v=Pe,z=we,H=xe,M=Te,W=Ne,X=Me,ee=Se,ae=qe,te=ue("router-link");return w(),C($,null,[_("div",ze,[t(y)?(w(),U(i,{key:0})):(w(),C($,{key:1},[e(m,{style:{"margin-bottom":"4px"}},{default:a(()=>[d("Direct Manual")]),_:1}),e(k,{cols:12,style:{display:"flex","justify-content":"space-between","align-items":"center"}},{default:a(()=>[e(c,{span:10},{default:a(()=>[e(u,{vertical:"",size:0},{default:a(()=>[e(u,{align:"center"},{default:a(()=>[e(p,{style:{"margin-bottom":"0"}},{default:a(()=>[d(" Kode Manifest :")]),_:1}),_("span",null,b(t(s).code),1)]),_:1}),e(u,{align:"center"},{default:a(()=>{var r;return[e(p,null,{default:a(()=>[d("Kode PO :")]),_:1}),_("span",null,b((r=t(s).do)==null?void 0:r.code),1)]}),_:1})]),_:1})]),_:1}),e(c,{span:10},{default:a(()=>[e(u,{vertical:"",size:0},{default:a(()=>[e(u,{align:"center"},{default:a(()=>{var r,P;return[e(p,null,{default:a(()=>[d(" Tujuan :")]),_:1}),_("span",null,b((P=(r=t(s).do)==null?void 0:r.destination)==null?void 0:P.name),1)]}),_:1}),e(p,null,{default:a(()=>{var r,P;return[d(b(n.$filters.setAddress((P=(r=t(s).do)==null?void 0:r.destination)==null?void 0:P.address)),1)]}),_:1})]),_:1})]),_:1}),e(c,{span:3},{default:a(()=>[e(f,{ghost:"",type:"primary",class:"button-tnt",style:{float:"right"},onClick:pe(J,["prevent"])},{default:a(()=>[d(" Cetak Manifest ")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(k,{cols:12,style:{display:"flex","justify-content":"space-between","align-items":"center","margin-top":"20px"}},{default:a(()=>[e(c,{span:12},{default:a(()=>[e(u,{vertical:"",size:0},{default:a(()=>[e(u,{align:"center"},{default:a(()=>[e(p,null,{default:a(()=>[d("Tanggal Kirim :")]),_:1}),_("span",null,b(t(A)(t(s).delivery_date).format("yyyy-MM-DD")),1)]),_:1}),e(u,{align:"center"},{default:a(()=>{var r;return[e(p,null,{default:a(()=>[d("Total Qty Packing :")]),_:1}),_("span",null,b((r=t(s).total)==null?void 0:r.packing),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(ae,{ref_key:"formRef",ref:D,class:"form-tnt","show-require-mark":!1,"label-width":80,model:t(l),rules:t(E)},{default:a(()=>[_("div",He,[e(O,null,{default:a(()=>[d("Assign Porter")]),_:1}),e(H,{cols:2,"x-gap":"4"},{default:a(()=>[e(v,null,{default:a(()=>[e(g,{label:"Dikirim Oleh",path:"porter"},{default:a(()=>[e(Q,{disabled:t(s).status!=="need_assign_porter",value:t(l).porter,"onUpdate:value":o[0]||(o[0]=r=>t(l).porter=r),clearable:"",options:t(K),placeholder:"Pilih Porter"},null,8,["disabled","value","options"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(g,{label:"Tanggal Pengiriman",path:"delivery_date"},{default:a(()=>[e(z,{disabled:t(s).status!=="need_assign_porter","formatted-value":t(l).delivery_date,"onUpdate:formattedValue":o[1]||(o[1]=r=>t(l).delivery_date=r),type:"date",clearable:"",style:{width:"100%"},placeholder:"Pilih Tanggal Pengiriman"},null,8,["disabled","formatted-value"])]),_:1})]),_:1})]),_:1})]),_("div",Ce,[e(O,null,{default:a(()=>[d("Penerimaan")]),_:1}),e(H,{cols:2,"x-gap":"4"},{default:a(()=>[e(v,null,{default:a(()=>[e(g,{label:"Diterima Oleh",path:"receiver.name"},{default:a(()=>[e(M,{disabled:t(s).status!=="need_assign_porter",clearable:"",value:t(l).receiver.name,"onUpdate:value":o[2]||(o[2]=r=>t(l).receiver.name=r),type:"text",placeholder:"Diterima Oleh"},null,8,["disabled","value"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(g,{label:"Email Penerima",path:"receiver.email"},{default:a(()=>[e(M,{disabled:t(s).status!=="need_assign_porter",value:t(l).receiver.email,"onUpdate:value":o[3]||(o[3]=r=>t(l).receiver.email=r),type:"text",placeholder:"Email Penerima"},null,8,["disabled","value"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(g,{label:"No. Hanphone Penerima",path:"receiver.phone"},{default:a(()=>[e(M,{disabled:t(s).status!=="need_assign_porter",value:t(l).receiver.phone,"onUpdate:value":o[4]||(o[4]=r=>t(l).receiver.phone=r),placeholder:"No. Handphone Penerima",type:"text",style:{width:"100%"}},null,8,["disabled","value"])]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(g,{label:"Tanggal Penerimaan",path:"handover_date"},{default:a(()=>[e(z,{disabled:t(s).status!=="need_assign_porter","formatted-value":t(l).handover_date,"onUpdate:formattedValue":o[5]||(o[5]=r=>t(l).handover_date=r),type:"date",clearable:"",style:{width:"100%"},placeholder:"Pilih Tanggal Penerimaan"},null,8,["disabled","formatted-value"])]),_:1})]),_:1})]),_:1}),e(g,{label:"Bukti Serah Terima",path:"images"},{default:a(()=>[e(u,{vertical:"",size:0},{default:a(()=>[e(ee,{disabled:t(s).status!=="need_assign_porter",style:{"max-width":"300px","margin-top":"1rem"},"directory-dnd":"",multiple:"","default-file-list":t(N),onBeforeUpload:R,"custom-request":Y},{default:a(()=>[e(X,null,{default:a(()=>[_("div",Ue,[e(W,{size:"48",style:{opacity:"0.6"},depth:3},{default:a(()=>[e(t(Oe))]),_:1})]),e(p,{style:{"font-size":"12px",opacity:"0.7"}},{default:a(()=>[d(" klik atau tarik file ke area upload ini ")]),_:1})]),_:1})]),_:1},8,["disabled","default-file-list"]),e(p,{style:{"font-size":"9px"}},{default:a(()=>[d("Gambar berupa png/jpg maksimal 2mb ")]),_:1})]),_:1})]),_:1})])]),_:1},8,["model","rules"])],64))]),_("div",$e,[_("div",je,[e(te,{to:{path:"/pengiriman/assign-porter"},class:"text-decoration-none"},{default:a(()=>[e(f,{color:"#828282",class:"button-tnt"},{default:a(()=>[d("Kembali ")]),_:1})]),_:1}),t(s).status==="need_assign_porter"?(w(),U(f,{key:0,color:"#219653",class:"button-tnt",loading:t(V)||t(y),onClick:G},{default:a(()=>[d("Simpan ")]),_:1},8,["loading"])):_e("",!0)])])],64)}}});typeof j=="function"&&j(Be);export{Be as default};
