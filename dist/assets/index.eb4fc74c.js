import{_ as pe}from"./t-permission-modal.bdf6acbc.js";import{_ as ce}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as me}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as fe,b as he,u as ve,E as ge,e as ke,r as p,f as _e,aF as j,a1 as be,p as ye,o as g,c as D,a as R,k as l,w as i,q as f,t as L,i as t,h as C,aY as we,aZ as Ce,j as E,F as I,ah as Ee,af as Pe,am as Ue,an as Ae,ak as xe,I as Te,H as Me,J as Fe,K as Re,v as qe}from"./index.21c0d750.js";import{c as q}from"./constant.549d5c21.js";import{m as P}from"./master-user.75b9491b.js";import{a as He}from"./hak-akses.99e628b7.js";import{m as Ne}from"./master-warehouse.353b4b3b.js";import{g as De}from"./getCompanyId.7d0eb93b.js";import{C as Ie}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Se}from"./AlertCircleOutline.19cf574c.js";import"./getSuperholdingId.94511ad9.js";import"./getHoldingId.48f570fc.js";const $e={class:"body-tnt"},Be={class:"card-tnt"},Ke={class:"bottom-action-button"},Ve={class:"action-item"},oa=fe({__name:"index",setup(Oe){const H=he(),Y=ve(),_=ge(),x=ke.getAuth(),U=p(!1),Q=p(""),c=p(""),N=p([]),S=p([]),X=[{label:"Aktif",value:1},{label:"Tidak Aktif",value:0}],A=p({show:!1}),T=De;_e(()=>{H.params.crud=="create"?(c.value="create",j.isGranted(q.accessPrivileges.porter+".create")?$():A.value.show=!0):(c.value="update",j.isGranted(q.accessPrivileges.porter+".update")?$():A.value.show=!0)});function ee(){A.value.show=!1}async function $(){if(U.value=!0,c.value=="update"){const a=H.params.id;x.xxtype=="5up3r4dm1n"&&await B(),await K(),await P.getDetailUser(a).then(e=>{te(e.data),U.value=!1}).catch(e=>{U.value=!1;const s=e.response.data;_.error(s.message)})}else x.xxtype=="5up3r4dm1n"&&await B(),await K(),U.value=!1}async function B(){o.value.access=null,o.value.roleUser=T;const a={limit:1e3};await He.getRoleType(a).then(e=>{e.data.list.forEach(r=>{r.key==="porter"&&(c.value==="create"&&(o.value.access=r.id,W(r.key,r)),N.value.push({key:r.key,value:r.id,label:r.name}))})}).catch(e=>{const s=e.response.data;_.error(s.message)})}async function K(){o.value.plant=null;const a={limit:1e3};await Ne.getWarehouse(a).then(e=>{e.data.list.forEach(r=>{S.value.push({key:r.key,value:r.id,label:r.name})})}).catch(e=>{const s=e.response.data;_.error(s.message)})}async function V(a){const e={limit:1e3};a==="company"?(b.value=[],await P.getCompany(e).then(s=>{s.data.list.forEach(d=>{b.value.push({key:d.name,value:d.id,label:d.name})})}).catch(s=>{const r=s.response.data;_.error(r.message)})):a==="holding"?(b.value=[],await P.getHolding(e).then(s=>{s.data.list.forEach(d=>{b.value.push({key:d.name,value:d.id,label:d.name})})}).catch(s=>{const r=s.response.data;_.error(r.message)})):(b.value=[],P.getSuperHolding(e).then(s=>{const r=s.data.list;console.log(r),r.forEach(d=>{b.value.push({key:d.name,value:d.id,label:d.name})})}).catch(s=>{const r=s.response.data;_.error(r.message)}))}const O=p(null),o=p({status:1}),M=p(!0),G=p();G.value={name:{required:!0,message:"Nama porter tidak boleh kosong",trigger:["input","blur"]},username:{required:!0,validator(a,e){const s=/\s/;if(e){if(e.match(s))return new Error("Username tidak boleh menggunakan spasi")}else return new Error("Username tidak boleh kosong");return!0},trigger:["input","blur"]},email:{required:!0,validator(a,e){const s=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(e){if(!e.match(s))return new Error("Email tidak valid")}else return new Error("Email tidak boleh kosong");return!0},trigger:["input","blur"]},phone:{required:!0,validator(a,e){if(e)if(/^\d*$/.test(e)){if(e.length<8)return new Error("No. Hp kurang dari 8 angka")}else return new Error("No. Hp harus angka");else return new Error("No. Hp tidak boleh kosong");return!0},trigger:["input","blur"]},position:{required:!0,message:"Jabatan tidak boleh kosong",trigger:["input","blur"]},access:{required:!0,message:"Hak akses tidak boleh kosong",trigger:["input","blur"]},roleUser:{required:!0,message:"Kolom tidak boleh kosong",trigger:["input","blur"]},plant:{type:"array",required:!0,message:"Nama plant/cabang tidak boleh kosong",trigger:["input","blur"]},password:{required:!0,validator(a,e){const s=/[a-z]/g,r=/[A-Z]/g,d=/[0-9]/g;if(e)if(e.match(s))if(e.match(r))if(e.match(d)){if(e.length<4)return new Error("Password minimal 4 karakter")}else return new Error("Password minimal 1 angka");else return new Error("Password minimal 1 huruf besar");else return new Error("Password minimal 1 huruf kecil");else return new Error("Password tidak boleh kosong");return!0},trigger:["input","blur"]},confirmPassword:{required:!0,validator(a,e){if(e){if(e!==o.value.password)return new Error("Konfirmasi password harus sama dengan password")}else return new Error("Konfirmasi password tidak boleh kosong");return!0},trigger:["input","blur"]},erpCode:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:["input","blur"]},status:{type:"number",required:!0,message:"Status tidak boleh kosong",trigger:["input","blur"]}};const m=p({id:"",key:"",label:""}),b=p([]);function W(a,e){a=="add"?(Y.push({path:"/setting/hak-akses/create/1"}),m.value.key=e.key):(m.value.id=e.id,m.value.label=e.name,m.value.key=e.key,V(e.key))}async function Z(a){var e;a.preventDefault(),await((e=O.value)==null?void 0:e.validate().then(()=>{se()}).catch(()=>{_.error("Form tidak valid, tolong periksa kembali")}))}const v=p(!1);function ae(){v.value=!0;const a=new FormData;if(a.append("name",o.value.name),a.append("username",o.value.username),a.append("email",o.value.email),a.append("phone",o.value.phone),a.append("position",o.value.position),x.xxtype=="5up3r4dm1n"&&(a.append("roles",o.value.access),a.append("role_user_type_id",o.value.roleUser)),a.append("status",o.value.status),a.append("erp_code",o.value.erpCode),o.value.plant.forEach(e=>{a.append("warehouse_id[]",e)}),c.value=="create"){let e={};a.append("company_id",T),e.company_id=T,P.createUser(a,e).then(()=>{v.value=!1,oe(),y(),setTimeout(()=>{z()},300)}).catch(s=>{const r=s.response.data;v.value=!1,y(),setTimeout(()=>{J(r)},300)})}else{let e={};a.append("company_id",o.value.roleId),e.company_id=o.value.roleId;const s=H.params.id;P.updateUser(s,a,e).then(()=>{v.value=!1,y(),setTimeout(()=>{z()},300)}).catch(r=>{const d=r.response.data;v.value=!1,y(),setTimeout(()=>{J(d)},300)})}}function te(a){x.xxtype=="5up3r4dm1n"&&N.value.forEach(async s=>{s.key===a.role.slug&&(m.value.id=s.value,m.value.key=s.key,m.value.label=s.label,await V(s.key),o.value.roleUser=a.user_type.id=="null"?T:a.user_type.id,o.value.access=m.value.id)});const e=p([]);a.warehouses.forEach(s=>{e.value.push(s.id)}),o.value={name:a.name,username:a.username,email:a.email,phone:a.phone,position:a.position,plant:e.value,is_verified_email:a.is_verified_email?a.is_verified_email:!0,password:"Admin123!",confirmPassword:"Admin123!",erpCode:a.erp_code,status:a.status.value},Q.value=a.email,m.value.key=a.user_type.kind}function oe(){o.value={name:"",username:"",email:"",phone:"",position:"",plant:null,password:"",confirmPassword:"",erpCode:"",status:1}}const n=p({show:p(!1),icon:be(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""});function y(){n.value.show=!1}function se(){n.value.type="confirm",n.value.hideIcon=!0,n.value.title="Konfirmasi",c.value=="create"?n.value.subtitle="Apakah Anda yakin untuk menambah data porter?":n.value.subtitle="Apakah Anda yakin untuk mengubah data porter?",n.value.show=!0}function z(){n.value.type="success",n.value.hideIcon=!1,n.value.iconColor="#219653",n.value.icon=Ie,c.value=="create"?(n.value.title="Berhasil Tambah Data",n.value.subtitle="Data porter berhasil ditambahkan"):(n.value.title="Berhasil Ubah Data",n.value.subtitle="Data porter berhasil diubah"),n.value.show=!0}function J(a){n.value.type="failed",n.value.hideIcon=!1,n.value.iconColor="#EB5757",n.value.icon=Se,n.value.title="Gagal",Object.keys(a.validation).length>0?n.value.subtitle=a.validation:n.value.subtitle=a.message,n.value.show=!0}return(a,e)=>{const s=Pe,r=ye("router-link"),d=Ue,ne=Ae,le=me,w=xe,h=Te,F=Me,re=Fe,k=Re,ie=qe,ue=ce,de=pe;return g(),D(I,null,[R("div",$e,[l(s,{style:{"margin-bottom":"4px"}},{default:i(()=>[f(L(t(c)=="create"?"Tambah Porter":"Edit Porter"),1)]),_:1}),l(ne,null,{default:i(()=>[l(d,null,{default:i(()=>[l(r,{to:"/setting/master-porter",class:"text-decoration-none"},{default:i(()=>[f(" Master Porter ")]),_:1})]),_:1}),l(d,null,{default:i(()=>[f(L(t(c)=="create"?"Tambah Porter":"Edit Porter"),1)]),_:1})]),_:1}),R("div",Be,[t(U)?(g(),C(le,{key:0})):(g(),C(re,{key:1,ref_key:"formRef",ref:O,class:"form-tnt",model:t(o),rules:t(G),"show-require-mark":!1},{default:i(()=>[l(h,{path:"name",label:"Nama Porter"},{default:i(()=>[l(w,{value:t(o).name,"onUpdate:value":e[0]||(e[0]=u=>t(o).name=u),placeholder:"Masukkan Nama Porter"},null,8,["value"])]),_:1}),l(h,{path:"username",label:"Username"},{default:i(()=>[l(w,{disabled:t(c)==="update",value:t(o).username,"onUpdate:value":e[1]||(e[1]=u=>t(o).username=u),placeholder:"Masukkan Username"},null,8,["disabled","value"])]),_:1}),l(h,{path:"email",label:"Email"},{default:i(()=>[l(w,{readonly:t(M),onFocus:e[2]||(e[2]=u=>M.value=!1),value:t(o).email,"onUpdate:value":e[3]||(e[3]=u=>t(o).email=u),placeholder:"Masukkan Email"},null,8,["readonly","value"])]),_:1}),l(h,{path:"position",label:"Jabatan"},{default:i(()=>[l(w,{value:t(o).position,"onUpdate:value":e[4]||(e[4]=u=>t(o).position=u),placeholder:"Masukkan Jabatan"},null,8,["value"])]),_:1}),l(h,{path:"access",label:"Hak Akses"},{default:i(()=>[l(F,{disabled:!0,value:t(o).access,"onUpdate:value":[e[5]||(e[5]=u=>t(o).access=u),W],options:t(N),placeholder:"Tentukan Hak Akses"},null,8,["value","options"])]),_:1}),we(l(h,{path:"roleUser",label:"Pilih "+t(m).label},{default:i(()=>[l(F,{value:t(o).roleUser,"onUpdate:value":e[6]||(e[6]=u=>t(o).roleUser=u),options:t(b),placeholder:"Pilih "+t(m).label},null,8,["value","options","placeholder"])]),_:1},8,["label"]),[[Ce,!1]]),l(h,{path:"phone",label:"Phone"},{default:i(()=>[l(w,{readonly:t(M),onFocus:e[7]||(e[7]=u=>M.value=!1),value:t(o).phone,"onUpdate:value":e[8]||(e[8]=u=>t(o).phone=u),placeholder:"Masukkan Phone"},null,8,["readonly","value"])]),_:1}),l(h,{path:"plant",label:"Nama Plant/Cabang"},{default:i(()=>[l(F,{filterable:"",multiple:"",value:t(o).plant,"onUpdate:value":e[9]||(e[9]=u=>t(o).plant=u),options:t(S),placeholder:"Pilih Plant/Cabang",style:{width:"100%"}},null,8,["value","options"])]),_:1}),l(h,{label:"Kode ERP",path:"erpCode"},{default:i(()=>[l(w,{value:t(o).erpCode,"onUpdate:value":e[10]||(e[10]=u=>t(o).erpCode=u),placeholder:"Masukkan kode ERP"},null,8,["value"])]),_:1}),l(h,{path:"status",label:"Status"},{default:i(()=>[l(F,{value:t(o).status,"onUpdate:value":e[11]||(e[11]=u=>t(o).status=u),options:X,placeholder:"Pilih Status Porter",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),R("div",Ke,[R("div",Ve,[l(r,{to:{name:"setting-master-porter"},class:"text-decoration-none"},{default:i(()=>[l(k,{color:"#828282",class:"button-tnt"},{default:i(()=>[f("Kembali")]),_:1})]),_:1}),t(c)==="create"&&a.$filters.isGranted(t(q).accessPrivileges.porter+".create")?(g(),C(k,{key:0,color:"#219653",class:"button-tnt",loading:t(v),onClick:Z},{default:i(()=>[f(" Simpan ")]),_:1},8,["loading"])):E("",!0),t(c)==="update"&&a.$filters.isGranted(t(q).accessPrivileges.porter+".update")?(g(),C(k,{key:1,color:"#219653",class:"button-tnt",loading:t(v),onClick:Z},{default:i(()=>[f(" Simpan ")]),_:1},8,["loading"])):E("",!0)])])]),l(ue,{show:t(n).show,"onUpdate:show":e[12]||(e[12]=u=>t(n).show=u),icon:t(n).icon,"icon-color":t(n).iconColor,"hide-icon":t(n).hideIcon,title:t(n).title,subtitle:t(n).subtitle},{default:i(()=>[l(ie,{justify:"center"},{default:i(()=>[t(n).type=="confirm"?(g(),D(I,{key:0},[l(k,{loading:t(v),color:"#828282",class:"button-tnt",onClick:y},{default:i(()=>[f(" Tutup ")]),_:1},8,["loading"]),l(k,{loading:t(v),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Ee(ae,["prevent"])},{default:i(()=>[f(" Yakin ")]),_:1},8,["loading","onClick"])],64)):E("",!0),t(n).type=="success"?(g(),D(I,{key:1},[t(c)=="create"?(g(),C(k,{key:0,color:"#828282",class:"button-tnt",onClick:y},{default:i(()=>[f(" Tambah Lainya ")]),_:1})):E("",!0),l(r,{to:{name:"setting-master-porter"},class:"text-decoration-none"},{default:i(()=>[l(k,{color:"#219653",class:"button-tnt"},{default:i(()=>[f(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):E("",!0),t(n).type=="failed"?(g(),C(k,{key:2,color:"#828282",class:"button-tnt",onClick:y},{default:i(()=>[f(" Tutup ")]),_:1})):E("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),l(de,{show:t(A).show,"onUpdate:show":e[13]||(e[13]=u=>t(A).show=u),"onClick:close":ee},null,8,["show"])],64)}}});export{oa as default};
