import{_ as oe}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as ie}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as re,b as ue,E as de,r as v,a1 as ce,f as _e,p as pe,o as m,c as w,a as c,i as t,k as e,F as z,w as a,q as f,t as _,g as fe,h as P,j as q,ah as me,af as ge,s as ve,v as ye,ad as he,ae as ke,aj as be,I as we,b0 as xe,J as ze,K as Me}from"./index.21c0d750.js";import{h as D}from"./moment.62d3fb0a.js";import{s as N}from"./serialisasi.378d5040.js";import{C as Te}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as qe}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const De={class:"body-tnt"},Ce={key:0,class:"card-tnt"},Ee=c("span",null,"No Perintah Kemas : ",-1),Se={style:{"font-weight":"500"}},Be=c("span",null,"Kode Produk : ",-1),Fe={style:{"font-weight":"500"}},Ve=c("span",null,"UOM : ",-1),Ke={style:{"font-weight":"500"}},Ue=c("span",null,"No Batch Produksi : ",-1),Ne={style:{"font-weight":"500"}},$e=c("span",null,"Qty : ",-1),Ie={style:{"font-weight":"500"}},Le={class:"card-tnt"},Pe={class:"bottom-action-button"},Re={class:"action-item"},Ze=re({__name:"index",setup(Qe){const $=ue(),I=de(),K=v(!1),y=v(!1),u=v({}),M=v({}),R=v(null),i=v({}),o=v({show:v(!1),icon:ce(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),Q=v();Q.value={manufacture_date:{required:!0,message:"Tanggal Manufaktur tidak boleh kosong",trigger:["blur","change"]},package_start_date:{required:!0,message:"Tanggal Mulai tidak boleh kosong",trigger:["blur","change"]},package_end_date:{required:!0,validator(s,l){if(l){if(l<i.value.package_start_date)return new Error("Tanggal Selesai tidak boleh kurang dari Tanggal Mulai")}else return new Error("Tanggal Selesai tidak boleh kosong");return!0},trigger:["input","blur"]}},_e(()=>{Y()});async function Y(){K.value=!0;const s=$.params.id;W(),await N.getDetailSerialize(s).then(l=>{u.value=l.data,u.value.serialize.forEach(r=>{r.min_qty=r.qty}),j(u.value.serialize[0],u.value.serialize[1]),Z(l.data),K.value=!1}).catch(l=>{K.value=!1;const r=l.response.data;I.error(r.message)})}function W(){const s=$.params.id;N.getDetailSerializeProduct(s).then(l=>{M.value=l.data}).catch(l=>{const r=l.response.data;I.error(r.message)})}function j(s,l,r){l&&(l.qty=Math.ceil(s.qty/l.maximum))}function X(s){var h;const l=parseInt((h=u.value.product)==null?void 0:h.expired_date_duration),r=D(s).add(l,"y");i.value.expired_date=D(r).format("yyyy-MM-DD")}function Z(s){var l;s.serialize.forEach(r=>{if(r.qty===null)return r.qty=0}),s.date.manufacture_date!==null&&(i.value.manufacture_date=D(s.date.manufacture_date).format("yyyy-MM-DD")),s.date.expired_date!==null&&(i.value.expired_date=D(s.date.expired_date).format("yyyy-MM-DD")),s.date.package_start_date!==null&&(i.value.package_start_date=D(s.date.package_start_date).format("yyyy-MM-DD")),s.date.package_end_date!==null&&(i.value.package_end_date=D(s.date.package_end_date).format("yyyy-MM-DD")),i.value.highest_retail_price=Math.round((l=s.product)==null?void 0:l.highest_retail_price),i.value.serialize=s.serialize}async function ee(s){var l;s.preventDefault(),await((l=R.value)==null?void 0:l.validate().then(()=>{te()}).catch(()=>{I.error("Form tidak valid, tolong periksa kembali")}))}function ae(){y.value=!0;const s=new FormData;s.append("manufacture_date",i.value.manufacture_date),s.append("expired_date",i.value.expired_date),s.append("package_start_date",i.value.package_start_date),s.append("package_end_date",i.value.package_end_date),i.value.serialize.forEach(r=>{s.append("newqty[]",r.qty)});const l=$.params.id;N.updateSerialize(l,s).then(()=>{N.getGenerateSerialize(l).then(()=>{y.value=!1,C(),setTimeout(()=>{le()},300)}).catch(r=>{const h=r.response.data;y.value=!1,C(),setTimeout(()=>{A(h)},300)})}).catch(r=>{const h=r.response.data;y.value=!1,C(),setTimeout(()=>{A(h)},300)})}function C(){o.value.show=!1}function te(){o.value.type="confirm",o.value.hideIcon=!0,o.value.title="Konfirmasi",o.value.subtitle="Apakah Anda yakin untuk generate serialisasi?",o.value.show=!0}function le(){o.value.type="success",o.value.hideIcon=!1,o.value.iconColor="#219653",o.value.icon=Te,o.value.title="Berhasil Generate Serialisasi",o.value.subtitle="Kemasan berhasil terserialisasi",o.value.show=!0}function A(s){o.value.type="failed",o.value.hideIcon=!1,o.value.iconColor="#EB5757",o.value.icon=qe,o.value.title="Gagal",Object.keys(s.validation).length>0?o.value.subtitle=s.validation:o.value.subtitle=s.message,o.value.show=!0}return(s,l)=>{var H,J;const r=ie,h=ge,g=ve,p=ye,k=he,E=ke,U=be,T=we,G=xe,ne=ze,x=Me,L=pe("router-link"),se=oe;return m(),w(z,null,[c("div",De,[t(K)?(m(),w("div",Ce,[e(r)])):(m(),w(z,{key:1},[e(h,{style:{"margin-bottom":"16px"}},{default:a(()=>{var n;return[f(_((n=t(u).product)==null?void 0:n.short_name),1)]}),_:1}),e(E,{cols:"3","item-responsive":"",responsive:"screen","x-gap":"16","y-gap":"16"},{default:a(()=>[e(k,{span:"3 m:1"},{default:a(()=>[e(p,{vertical:"",size:15},{default:a(()=>[e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"margin-bottom":"0"}},{default:a(()=>[Ee,c("span",Se,_(t(u).pk_id),1)]),_:1})]),_:1}),e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"margin-bottom":"0"}},{default:a(()=>{var n;return[Be,c("span",Fe,_((n=t(u).product)==null?void 0:n.item_code),1)]}),_:1})]),_:1}),e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"margin-bottom":"0"}},{default:a(()=>{var n;return[Ve,c("span",Ke,_((n=t(M).uom)==null?void 0:n.name),1)]}),_:1})]),_:1})]),_:1})]),_:1}),e(k,{span:"3 m:1"},{default:a(()=>[e(p,{vertical:"",size:15},{default:a(()=>[e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"margin-bottom":"0"}},{default:a(()=>[Ue,c("span",Ne,_(t(u).batch_number),1)]),_:1})]),_:1}),e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"margin-bottom":"0"}},{default:a(()=>[$e,c("span",Ie,_(t(u).serialize?t(u).serialize[0].qty:0),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),c("div",Le,[e(p,{vertical:"",size:24},{default:a(()=>[e(p,{vertical:"",size:0},{default:a(()=>[e(ne,{ref_key:"formRef",ref:R,class:"form-tnt","show-require-mark":!1,"label-width":80,model:t(i),rules:t(Q)},{default:a(()=>[e(E,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:a(()=>[e(k,{span:"4 m:1"},{default:a(()=>[e(T,{label:"Tanggal Manufaktur",path:"manufacture_date"},{default:a(()=>{var n;return[e(U,{disabled:((n=t(u).date)==null?void 0:n.generate_at)!==null,"formatted-value":t(i).manufacture_date,"onUpdate:formattedValue":l[0]||(l[0]=d=>t(i).manufacture_date=d),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"},"onUpdate:value":X},null,8,["disabled","formatted-value"])]}),_:1})]),_:1}),e(k,{span:"4 m:1"},{default:a(()=>[e(T,{label:"Expired Date"},{default:a(()=>{var n;return[e(U,{disabled:((n=t(u).date)==null?void 0:n.generate_at)!==null,"formatted-value":t(i).expired_date,"onUpdate:formattedValue":l[1]||(l[1]=d=>t(i).expired_date=d),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["disabled","formatted-value"])]}),_:1})]),_:1})]),_:1}),e(E,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:a(()=>[e(k,{span:"4 m:1"},{default:a(()=>[e(T,{label:"Tanggal Mulai Pengemasan",path:"package_start_date"},{default:a(()=>{var n;return[e(U,{disabled:((n=t(u).date)==null?void 0:n.generate_at)!==null,"formatted-value":t(i).package_start_date,"onUpdate:formattedValue":l[2]||(l[2]=d=>t(i).package_start_date=d),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal Mulai",style:{width:"100%"}},null,8,["disabled","formatted-value"])]}),_:1})]),_:1}),e(k,{span:"4 m:1"},{default:a(()=>[e(T,{label:"Tanggal Selesai Pengemasan",path:"package_end_date"},{default:a(()=>{var n;return[e(U,{disabled:((n=t(u).date)==null?void 0:n.generate_at)!==null,"formatted-value":t(i).package_end_date,"onUpdate:formattedValue":l[3]||(l[3]=d=>t(i).package_end_date=d),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal Selesai",style:{width:"100%"}},null,8,["disabled","formatted-value"])]}),_:1})]),_:1})]),_:1}),e(E,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:a(()=>[e(k,{span:"4 m:1"},{default:a(()=>[e(T,{label:"Harga Eceran Tertinggi (HET)",path:"het"},{default:a(()=>[e(G,{disabled:"",value:t(i).highest_retail_price,"onUpdate:value":l[4]||(l[4]=n=>t(i).highest_retail_price=n),placeholder:"Masukkan Harga Eceran Tertinggi",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(E,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"16"},{default:a(()=>[(m(!0),w(z,null,fe(t(i).serialize,(n,d)=>(m(),P(k,{span:"4 m:1",key:d},{default:a(()=>[e(T,{label:d==0?"Jumlah Level 1 (Box 10 Kaplet)":`Estimasi Level ${n.level}`,path:`serialize[${d}].qty`,rule:{type:"number",required:!0,message:"Estimasi tidak boleh kosong",trigger:["input","blur"]}},{default:a(()=>[e(p,{vertical:"",style:{width:"100%"}},{default:a(()=>{var O;return[e(G,{disabled:d===0||((O=t(u).date)==null?void 0:O.generate_at)!==null,value:n.qty,"onUpdate:value":[b=>n.qty=b,b=>j(n,t(i).serialize[d+1],"changed")],placeholder:d==0?"Jumlah Level 1 (Box 10 Kaplet)":`Estimasi Level ${d+1}`,min:n.min_qty,style:{width:"100%"}},null,8,["disabled","value","onUpdate:value","placeholder","min"]),e(p,{vertical:"",size:0},{default:a(()=>[e(g,{style:{"font-size":"11px"}},{default:a(()=>[f("Jumlah Max Qty Level "+_(n.level)+" : "+_(n.maximum),1)]),_:2},1024),e(g,{style:{"font-size":"11px"}},{default:a(()=>[f("Isi : "+_(n.maximum)+" Kotak",1)]),_:2},1024),t(u).serialize[0].level===n.level?(m(),w(z,{key:0},[e(g,{style:{"font-size":"11px"}},{default:a(()=>{var b,S,B,F,V;return[f("Qty terkecil : "+_(s.$filters.toNumber((S=(b=t(M))==null?void 0:b.unit_first_level)==null?void 0:S.qty))+" "+_((V=(F=(B=t(M))==null?void 0:B.unit_first_level)==null?void 0:F.uom)==null?void 0:V.name),1)]}),_:1}),e(g,{style:{"font-size":"11px"}},{default:a(()=>{var b,S,B,F,V;return[f("Total Qty terkecil : "+_(s.$filters.toNumber(((S=(b=t(M))==null?void 0:b.unit_first_level)==null?void 0:S.qty)*(n==null?void 0:n.qty)))+" "+_((V=(F=(B=t(M))==null?void 0:B.unit_first_level)==null?void 0:F.uom)==null?void 0:V.name),1)]}),_:2},1024)],64)):q("",!0)]),_:2},1024)]}),_:2},1024)]),_:2},1032,["label","path"])]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})])],64)),c("div",Pe,[c("div",Re,[e(L,{to:"/produksi/serialisasi",class:"text-decoration-none"},{default:a(()=>[e(x,{loading:t(y),color:"#828282",class:"button-tnt"},{default:a(()=>[f(" Kembali ")]),_:1},8,["loading"])]),_:1}),((H=t(u).status)==null?void 0:H.global.value)!=="canceled"?(m(),w(z,{key:0},[((J=t(u).date)==null?void 0:J.generate_at)===null?(m(),P(x,{key:0,loading:t(y),color:"#219653",class:"button-tnt",onClick:ee},{default:a(()=>[f(" Generate ")]),_:1},8,["loading"])):q("",!0)],64)):q("",!0)])])]),e(se,{show:t(o).show,"onUpdate:show":l[5]||(l[5]=n=>t(o).show=n),icon:t(o).icon,"icon-color":t(o).iconColor,"hide-icon":t(o).hideIcon,title:t(o).title,subtitle:t(o).subtitle},{default:a(()=>[e(p,{justify:"center"},{default:a(()=>[t(o).type=="confirm"?(m(),w(z,{key:0},[e(x,{loading:t(y),color:"#828282",class:"button-tnt",onClick:C},{default:a(()=>[f(" Tutup ")]),_:1},8,["loading"]),e(x,{loading:t(y),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:me(ae,["prevent"])},{default:a(()=>[f(" Yakin ")]),_:1},8,["loading","onClick"])],64)):q("",!0),t(o).type=="success"?(m(),w(z,{key:1},[e(L,{to:{name:"produksi-serialisasi"},class:"text-decoration-none"},{default:a(()=>[e(x,{color:"#828282",class:"button-tnt"},{default:a(()=>[f(" Kembali ke Beranda ")]),_:1})]),_:1}),e(L,{to:{name:"produksi-serialisasi-id-print"},class:"text-decoration-none"},{default:a(()=>[e(x,{color:"#219653",class:"button-tnt"},{default:a(()=>[f(" Cetak Serialisasi ")]),_:1})]),_:1})],64)):q("",!0),t(o).type=="failed"?(m(),P(x,{key:2,color:"#828282",class:"button-tnt",onClick:C},{default:a(()=>[f(" Tutup ")]),_:1})):q("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"])],64)}}});export{Ze as default};
