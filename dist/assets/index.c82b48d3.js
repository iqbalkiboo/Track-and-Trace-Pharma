import{_ as de}from"./t-permission-modal.bdf6acbc.js";import{_ as me}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as pe}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as _e,b as ge,E as fe,r as c,a1 as he,f as ve,e as be,aF as $,p as ke,o as p,c as V,a as U,k as l,w as s,q as m,t as B,i as a,h,j as k,F as S,ah as we,af as ye,am as De,an as Ce,ak as Ue,I as xe,K as Me,aM as Te,R as Fe,bq as Ve,v as Be,J as Se}from"./index.21c0d750.js";import{c as x}from"./constant.549d5c21.js";import{o as M}from"./option.2657b089.js";import{m as N}from"./master-holding.d2183378.js";import{s as Ne}from"./storage.731d7fd8.js";import{C as Pe}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Ee}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";import"./getSuperholdingId.94511ad9.js";const Ie={class:"body-tnt"},Ae={class:"card-tnt"},Oe={class:"bottom-action-button"},qe={class:"action-item"},ea=_e({__name:"index",setup(je){const T=ge(),f=fe(),z=c(),y=c(!1),r=c(!1),d=c(""),P=c([]),E=c([]),I=c([]),A=c([]),t=c({show:c(!1),icon:he(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),i=c({image:{id:"",url:""}}),O=c(),q=c();q.value={name:{required:!0,message:"Nama holding tidak boleh kosong",trigger:["input","blur"]},address:{required:!0,message:"Keterangan alamat tidak boleh kosong",trigger:["input","blur"]},description:{required:!0,message:"Description tidak boleh kosong",trigger:["input","blur"]}};const w=c({show:!1});ve(()=>{z.value=be.getAuth(),T.params.crud=="create"?(d.value="create",$.isGranted(x.accessPrivileges.holding+".create")?j():w.value.show=!0):(d.value="update",$.isGranted(x.accessPrivileges.holding+".update")?j():w.value.show=!0)});function J(){w.value.show=!1}async function j(){if(d.value=="update"){y.value=!0;const n=T.params.id;await K(),await Y(),await Q(),await W(),await N.getDetailHolding(n).then(e=>{Z(e.data),y.value=!1}).catch(e=>{y.value=!1;const o=e.response.data;f.error(o.message)})}else K()}async function K(){i.value.province_id=null;const n={limit:1e3};await M.getProvinces(n).then(e=>{I.value=[],e.data.list.forEach(u=>{I.value.push({label:u.name,value:u.id})})}).catch(e=>{const o=e.response.data;f.error(o.message)})}async function Y(){i.value.district_id=null;const n={limit:1e3,province_id:i.value.province_id};await M.getDistricts(n).then(e=>{P.value=[],e.data.list.forEach(u=>{P.value.push({label:u.name,value:u.id})})}).catch(e=>{const o=e.response.data;f.error(o.message)})}async function Q(){i.value.sub_district_id=null;const n={limit:1e3,district_id:i.value.district_id};await M.getSubDistricts(n).then(e=>{E.value=[],e.data.list.forEach(u=>{E.value.push({label:u.name,value:u.id})})}).catch(e=>{const o=e.response.data;f.error(o.message)})}async function W(){i.value.urban_village_id=null;const n={limit:1e3,sub_district_id:i.value.sub_district_id};await M.getUrbanVillages(n).then(e=>{A.value=[],e.data.list.forEach(u=>{A.value.push({label:u.name,value:u.id})})}).catch(e=>{const o=e.response.data;f.error(o.message)})}function X(){r.value=!0;let n={name:i.value.name,address:i.value.address,image_id:i.value.image.id,description:i.value.description};if(d.value=="create")N.createHolding(n).then(()=>{r.value=!1,ee(),v(),setTimeout(()=>{L()},300)}).catch(e=>{const o=e.response.data;r.value=!1,v(),setTimeout(()=>{R(o)},300)});else{const e=T.params.id;N.updateHolding(e,n).then(()=>{r.value=!1,v(),setTimeout(()=>{L()},300)}).catch(o=>{const u=o.response.data;r.value=!1,v(),setTimeout(()=>{R(u)},300)})}}function Z(n){i.value={name:n.name,address:n.address,image:{id:n.image.id,url:n.image.url},description:n.description}}function ee(){i.value={name:"",province_id:null,district_id:null,sub_district_id:null,urban_village_id:null,address:"",longitude:"",latitude:"",erp_code:"",pbf_permisson_number:null,pak_permisson_number:null,image:{id:"",url:""},kind:""}}function v(){t.value.show=!1}function ae(){t.value.type="confirm",t.value.hideIcon=!0,t.value.title="Konfirmasi",d.value=="create"?t.value.subtitle="Apakah Anda yakin untuk menambah data holding?":t.value.subtitle="Apakah Anda yakin untuk mengubah data holding?",t.value.show=!0}function L(){t.value.type="success",t.value.hideIcon=!1,t.value.iconColor="#219653",t.value.icon=Pe,d.value=="create"?(t.value.title="Berhasil Tambah Data",t.value.subtitle="Data holding berhasil ditambahkan"):(t.value.title="Berhasil Ubah Data",t.value.subtitle="Data holding berhasil diubah"),t.value.show=!0}function R(n){t.value.type="failed",t.value.hideIcon=!1,t.value.iconColor="#EB5757",t.value.icon=Ee,t.value.title="Gagal",Object.keys(n.validation).length>0?t.value.subtitle=n.validation:t.value.subtitle=n.message,t.value.show=!0}async function G(n){var e;n.preventDefault(),await((e=O.value)==null?void 0:e.validate().then(()=>{ae()}).catch(()=>{f.error("Form tidak valid, tolong periksa kembali")}))}async function te(n){var o;return["image/png","image/jpeg"].indexOf(String((o=n.file.file)==null?void 0:o.type))===-1?(f.error("Format gambar harus png atau jpg, tolong upload ulang"),!1):!0}function ne({file:n,onFinish:e}){r.value=!0;const o=new FormData;o.append("file",n.file),o.append("source","upload"),o.append("title",n.name),o.append("caption",n.name),o.append("alt",n.name),Ne.uploadStorage(o).then(u=>{var b,D;i.value.image.id=(b=u.data.data)==null?void 0:b.id,i.value.image.url=(D=u.data.data)==null?void 0:D.public_url,r.value=!1,e()}).catch(u=>{const b=u.response.data;f.error(b.message),r.value=!1,e()})}return(n,e)=>{const o=ye,u=ke("router-link"),b=De,D=Ce,oe=pe,F=Ue,C=xe,_=Me,se=Te,le=Fe,ie=Ve,H=Be,ue=Se,re=me,ce=de;return p(),V(S,null,[U("div",Ie,[l(o,{style:{"margin-bottom":"4px"}},{default:s(()=>[m(B(a(d)=="create"?"Tambah holding":"Edit holding"),1)]),_:1}),l(D,null,{default:s(()=>[l(b,null,{default:s(()=>[l(u,{to:"/setting/master-holding",class:"text-decoration-none"},{default:s(()=>[m(" Master holding ")]),_:1})]),_:1}),l(b,null,{default:s(()=>[m(B(a(d)=="create"?"Tambah holding":"Edit holding"),1)]),_:1})]),_:1}),U("div",Ae,[a(y)?(p(),h(oe,{key:0})):(p(),h(ue,{key:1,ref_key:"formRef",ref:O,model:a(i),rules:a(q),"show-require-mark":!1,class:"form-tnt"},{default:s(()=>[l(C,{path:"name",label:"Nama holding"},{default:s(()=>[l(F,{value:a(i).name,"onUpdate:value":e[0]||(e[0]=g=>a(i).name=g),placeholder:"Masukkan Nama holding"},null,8,["value"])]),_:1}),l(C,{label:"Keterangan Alamat (Nama jalan dan No. Bangunan)",path:"address"},{default:s(()=>[l(F,{value:a(i).address,"onUpdate:value":e[1]||(e[1]=g=>a(i).address=g),placeholder:"Masukkan keterangan alamat"},null,8,["value"])]),_:1}),l(C,{label:"Upload Logo","show-feedback":!1},{default:s(()=>[l(se,{action:"",onBeforeUpload:te,"show-file-list":!1,"custom-request":ne},{default:s(()=>[l(_,{loading:a(r),color:"#219653",class:"button-tnt"},{default:s(()=>[m(B(a(d)=="create"?"Upload Logo":"Ubah Logo"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(r)?(p(),h(H,{key:1,size:8},{default:s(()=>[l(ie,{height:"90px",width:"96px"})]),_:1})):(p(),h(le,{key:0,width:"110",src:a(i).image.url,style:{"margin-top":"10px","border-radius":"12px"}},null,8,["src"])),l(C,{label:"Deskripsi",path:"description"},{default:s(()=>[l(F,{value:a(i).description,"onUpdate:value":e[2]||(e[2]=g=>a(i).description=g),placeholder:"Masukkan Deskripsi"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),U("div",Oe,[U("div",qe,[l(u,{to:{name:"setting-master-holding"},class:"text-decoration-none"},{default:s(()=>[l(_,{color:"#828282",class:"button-tnt"},{default:s(()=>[m("Kembali ")]),_:1})]),_:1}),a(d)==="create"&&n.$filters.isGranted(a(x).accessPrivileges.holding+".create")?(p(),h(_,{key:0,color:"#219653",class:"button-tnt",loading:a(r),onClick:G},{default:s(()=>[m(" Simpan ")]),_:1},8,["loading"])):k("",!0),a(d)==="update"&&n.$filters.isGranted(a(x).accessPrivileges.holding+".update")?(p(),h(_,{key:1,color:"#219653",class:"button-tnt",loading:a(r),onClick:G},{default:s(()=>[m(" Simpan ")]),_:1},8,["loading"])):k("",!0)])])]),l(re,{show:a(t).show,"onUpdate:show":e[3]||(e[3]=g=>a(t).show=g),icon:a(t).icon,"icon-color":a(t).iconColor,"hide-icon":a(t).hideIcon,title:a(t).title,subtitle:a(t).subtitle},{default:s(()=>[l(H,{justify:"center"},{default:s(()=>[a(t).type=="confirm"?(p(),V(S,{key:0},[l(_,{loading:a(r),color:"#828282",class:"button-tnt",onClick:v},{default:s(()=>[m(" Tutup ")]),_:1},8,["loading"]),l(_,{loading:a(r),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:we(X,["prevent"])},{default:s(()=>[m(" Yakin ")]),_:1},8,["loading","onClick"])],64)):k("",!0),a(t).type=="success"?(p(),V(S,{key:1},[a(d)=="create"?(p(),h(_,{key:0,color:"#828282",class:"button-tnt",onClick:v},{default:s(()=>[m(" Tambah Lainya ")]),_:1})):k("",!0),l(u,{to:{name:"setting-master-holding"},class:"text-decoration-none"},{default:s(()=>[l(_,{color:"#219653",class:"button-tnt"},{default:s(()=>[m(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):k("",!0),a(t).type=="failed"?(p(),h(_,{key:2,color:"#828282",class:"button-tnt",onClick:v},{default:s(()=>[m(" Tutup ")]),_:1})):k("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),l(ce,{show:a(w).show,"onUpdate:show":e[4]||(e[4]=g=>a(w).show=g),"onClick:close":J},null,8,["show"])],64)}}});export{ea as default};
