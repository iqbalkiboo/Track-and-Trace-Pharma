import{_ as ge}from"./t-permission-modal.bdf6acbc.js";import{_ as ve}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as fe}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as be,b as he,E as ke,r as p,a1 as ye,f as we,e as Pe,aF as W,p as Ce,o as g,c as S,a as D,k as i,w as l,q as _,t as T,i as a,h as b,j as y,F as B,ah as Ue,af as Ke,am as De,an as Me,ak as Ee,I as Fe,H as qe,b0 as xe,bt as Le,K as Ne,aM as Se,R as Te,bq as Be,v as Ve,J as Ie}from"./index.21c0d750.js";import{c as M}from"./constant.549d5c21.js";import{o as E}from"./option.2657b089.js";import{m as V}from"./master-company.1c364b5b.js";import{s as Ae}from"./storage.731d7fd8.js";import{C as Oe}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Re}from"./AlertCircleOutline.19cf574c.js";import"./getCompanyId.7d0eb93b.js";import"./getHoldingId.48f570fc.js";const $e={class:"body-tnt"},je={class:"card-tnt"},Ge={class:"bottom-action-button"},He={class:"action-item"},oa=be({__name:"index",setup(ze){const F=he(),f=ke(),X=p(),U=p(!1),c=p(!1),m=p(""),q=p([]),x=p([]),L=p([]),N=p([]),o=p({show:p(!1),icon:ye(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),t=p({image:{id:"",url:""},setting:{under_maintenance:!1}}),Z=[{label:"Manufacture",value:"manufacture"},{label:"Distributor",value:"distribution"}],I=p(),A=p();A.value={name:{required:!0,message:"Nama Perusahaan tidak boleh kosong",trigger:["input","blur"]},kind:{required:!0,message:"Kind tidak boleh kosong",trigger:["input","blur"]},province_id:{required:!0,message:"Provinsi tidak boleh kosong",trigger:["input","blur"]},district_id:{required:!0,message:"Kota/Kabupaten tidak boleh kosong",trigger:["input","blur"]},sub_district_id:{required:!0,message:"Kecamatan tidak boleh kosong",trigger:["input","blur"]},urban_village_id:{required:!0,message:"Kelurahan tidak boleh kosong",trigger:["input","blur"]},address:{required:!0,message:"Keterangan alamat tidak boleh kosong",trigger:["input","blur"]},longitude:{required:!0,validator(n,e){if(!e)return new Error("Longitude tidak boleh kosong");if(e.includes(","))return new Error("Longitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Longitude harus angka atau tidak valid")},trigger:["input","blur"]},latitude:{required:!0,validator(n,e){if(!e)return new Error("Latitude tidak boleh kosong");if(e.includes(","))return new Error("Latitude tidak boleh menggunakan tanda koma");if(!/^[-]?[0-9]*\.?[0-9]*$/.test(e))return new Error("Latitude harus angka atau tidak valid")},trigger:["input","blur"]},erp_code:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:["input","blur"]}};const w=p({show:!1});we(()=>{X.value=Pe.getAuth(),F.params.crud=="create"?(m.value="create",W.isGranted(M.accessPrivileges.company+".create")?O():w.value.show=!0):(m.value="update",W.isGranted(M.accessPrivileges.company+".update")?O():w.value.show=!0)});function ee(){w.value.show=!1}async function O(){if(m.value=="update"){U.value=!0;const n=F.params.id;await R(),await $(),await j(),await G(),await V.getDetailCompany(n).then(e=>{te(e.data),U.value=!1}).catch(e=>{U.value=!1;const s=e.response.data;f.error(s.message)})}else R()}async function R(){t.value.province_id=null;const n={limit:1e3};await E.getProvinces(n).then(e=>{L.value=[],e.data.list.forEach(r=>{L.value.push({label:r.name,value:r.id})})}).catch(e=>{const s=e.response.data;f.error(s.message)})}async function $(){t.value.district_id=null;const n={limit:1e3,province_id:t.value.province_id};await E.getDistricts(n).then(e=>{q.value=[],e.data.list.forEach(r=>{q.value.push({label:r.name,value:r.id})})}).catch(e=>{const s=e.response.data;f.error(s.message)})}async function j(){t.value.sub_district_id=null;const n={limit:1e3,district_id:t.value.district_id};await E.getSubDistricts(n).then(e=>{x.value=[],e.data.list.forEach(r=>{x.value.push({label:r.name,value:r.id})})}).catch(e=>{const s=e.response.data;f.error(s.message)})}async function G(){t.value.urban_village_id=null;const n={limit:1e3,sub_district_id:t.value.sub_district_id};await E.getUrbanVillages(n).then(e=>{N.value=[],e.data.list.forEach(r=>{N.value.push({label:r.name,value:r.id})})}).catch(e=>{const s=e.response.data;f.error(s.message)})}function ae(){c.value=!0;let n={name:t.value.name,address:{province_id:t.value.province_id,district_id:t.value.district_id,sub_district_id:t.value.sub_district_id,urban_village_id:t.value.urban_village_id,detail:t.value.address},latitude:parseInt(t.value.latitude),longitude:parseInt(t.value.longitude),erp_code:t.value.erp_code,pbf_permisson_number:t.value.pbf_permisson_numer,pak_permisson_number:t.value.pak_permisson_numer,kind:t.value.kind,image_id:t.value.image.id,setting:{under_maintenance:t.value.setting.under_maintenance}};if(m.value=="create")V.createCompany(n).then(()=>{c.value=!1,ne(),h(),setTimeout(()=>{H()},300)}).catch(e=>{const s=e.response.data;c.value=!1,h(),setTimeout(()=>{z(s)},300)});else{const e=F.params.id;V.updateCompany(e,n).then(()=>{c.value=!1,h(),setTimeout(()=>{H()},300)}).catch(s=>{const r=s.response.data;c.value=!1,h(),setTimeout(()=>{z(r)},300)})}}function te(n){t.value={name:n.name,province_id:n.address.province.id,district_id:n.address.district.id,sub_district_id:n.address.sub_district.id,urban_village_id:n.address.urban_village.id,address:n.address.detail,latitude:String(n.location.coordinates.at(0)),longitude:String(n.location.coordinates.at(1)),erp_code:n.erp_code,pbf_permisson_numer:n.pbf_permission_numer,pak_permisson_numer:n.pak_permission_numer,image:{id:n.image.id,url:n.image.url},kind:n.kind,setting:{under_maintenance:n.setting.under_maintenance}}}function ne(){t.value={name:"",province_id:null,district_id:null,sub_district_id:null,urban_village_id:null,address:"",longitude:"",latitude:"",erp_code:"",pbf_permisson_number:null,pak_permisson_number:null,image:{id:"",url:""},kind:""}}function h(){o.value.show=!1}function ie(){o.value.type="confirm",o.value.hideIcon=!0,o.value.title="Konfirmasi",m.value=="create"?o.value.subtitle="Apakah Anda yakin untuk menambah data company?":o.value.subtitle="Apakah Anda yakin untuk mengubah data company?",o.value.show=!0}function H(){o.value.type="success",o.value.hideIcon=!1,o.value.iconColor="#219653",o.value.icon=Oe,m.value=="create"?(o.value.title="Berhasil Tambah Data",o.value.subtitle="Data company berhasil ditambahkan"):(o.value.title="Berhasil Ubah Data",o.value.subtitle="Data company berhasil diubah"),o.value.show=!0}function z(n){o.value.type="failed",o.value.hideIcon=!1,o.value.iconColor="#EB5757",o.value.icon=Re,o.value.title="Gagal",Object.keys(n.validation).length>0?o.value.subtitle=n.validation:o.value.subtitle=n.message,o.value.show=!0}async function J(n){var e;n.preventDefault(),await((e=I.value)==null?void 0:e.validate().then(()=>{ie()}).catch(()=>{f.error("Form tidak valid, tolong periksa kembali")}))}async function le(n){var s;return["image/png","image/jpeg"].indexOf(String((s=n.file.file)==null?void 0:s.type))===-1?(f.error("Format gambar harus png atau jpg, tolong upload ulang"),!1):!0}function oe({file:n,onFinish:e}){c.value=!0;const s=new FormData;s.append("file",n.file),s.append("source","upload"),s.append("title",n.name),s.append("caption",n.name),s.append("alt",n.name),Ae.uploadStorage(s).then(r=>{var k,K;t.value.image.id=(k=r.data.data)==null?void 0:k.id,t.value.image.url=(K=r.data.data)==null?void 0:K.public_url,c.value=!1,e()}).catch(r=>{const k=r.response.data;f.error(k.message),c.value=!1,e()})}return(n,e)=>{const s=Ke,r=Ce("router-link"),k=De,K=Me,se=fe,P=Ee,d=Fe,C=qe,Y=xe,ue=Le,v=Ne,re=Se,de=Te,ce=Be,Q=Ve,pe=Ie,me=ve,_e=ge;return g(),S(B,null,[D("div",$e,[i(s,{style:{"margin-bottom":"4px"}},{default:l(()=>[_(T(a(m)=="create"?"Tambah Perusahaan":"Edit Perusahaan"),1)]),_:1}),i(K,null,{default:l(()=>[i(k,null,{default:l(()=>[i(r,{to:"/setting/master-company",class:"text-decoration-none"},{default:l(()=>[_(" Master Perusahaan ")]),_:1})]),_:1}),i(k,null,{default:l(()=>[_(T(a(m)=="create"?"Tambah Perusahaan":"Edit Perusahaan"),1)]),_:1})]),_:1}),D("div",je,[a(U)?(g(),b(se,{key:0})):(g(),b(pe,{key:1,ref_key:"formRef",ref:I,model:a(t),rules:a(A),"show-require-mark":!1,class:"form-tnt"},{default:l(()=>[i(d,{path:"name",label:"Nama Perusahaan"},{default:l(()=>[i(P,{value:a(t).name,"onUpdate:value":e[0]||(e[0]=u=>a(t).name=u),placeholder:"Masukkan Nama Perusahaan"},null,8,["value"])]),_:1}),i(d,{path:"kind",label:"Kelompok Perusahaan"},{default:l(()=>[i(C,{value:a(t).kind,"onUpdate:value":e[1]||(e[1]=u=>a(t).kind=u),options:Z,placeholder:"Masukkan Kelompok Perusahaan"},null,8,["value"])]),_:1}),i(d,{label:"Provinsi",path:"province_id"},{default:l(()=>[i(C,{value:a(t).province_id,"onUpdate:value":[e[2]||(e[2]=u=>a(t).province_id=u),$],options:a(L),filterable:"",placeholder:"Pilih provinsi"},null,8,["value","options"])]),_:1}),i(d,{label:"Kota/Kabupaten",path:"district_id"},{default:l(()=>[i(C,{value:a(t).district_id,"onUpdate:value":[e[3]||(e[3]=u=>a(t).district_id=u),j],options:a(q),filterable:"",placeholder:"Pilih kota/kabupaten"},null,8,["value","options"])]),_:1}),i(d,{label:"Kecamatan",path:"sub_district_id"},{default:l(()=>[i(C,{value:a(t).sub_district_id,"onUpdate:value":[e[4]||(e[4]=u=>a(t).sub_district_id=u),G],options:a(x),filterable:"",placeholder:"Pilih kecamatan"},null,8,["value","options"])]),_:1}),i(d,{label:"Kelurahan",path:"urban_village_id"},{default:l(()=>[i(C,{value:a(t).urban_village_id,"onUpdate:value":e[5]||(e[5]=u=>a(t).urban_village_id=u),options:a(N),filterable:"",placeholder:"Pilih kecamatan"},null,8,["value","options"])]),_:1}),i(d,{label:"Keterangan Alamat (Nama jalan dan No. Bangunan)",path:"address"},{default:l(()=>[i(P,{value:a(t).address,"onUpdate:value":e[6]||(e[6]=u=>a(t).address=u),placeholder:"Masukkan keterangan alamat"},null,8,["value"])]),_:1}),i(d,{label:"Longitude",path:"longitude"},{default:l(()=>[i(P,{value:a(t).longitude,"onUpdate:value":e[7]||(e[7]=u=>a(t).longitude=u),placeholder:"Masukkan longitude"},null,8,["value"])]),_:1}),i(d,{label:"Latitude",path:"latitude"},{default:l(()=>[i(P,{value:a(t).latitude,"onUpdate:value":e[8]||(e[8]=u=>a(t).latitude=u),placeholder:"Masukkan latitude"},null,8,["value"])]),_:1}),i(d,{path:"erp_code",label:"Kode ERP"},{default:l(()=>[i(P,{value:a(t).erp_code,"onUpdate:value":e[9]||(e[9]=u=>a(t).erp_code=u),placeholder:"Masukkan Kode ERP"},null,8,["value"])]),_:1}),i(d,{path:"pbf_permisson_numer",label:"PBF Permisson Numer"},{default:l(()=>[i(Y,{style:{width:"100%"},value:a(t).pbf_permisson_numer,"onUpdate:value":e[10]||(e[10]=u=>a(t).pbf_permisson_numer=u),placeholder:"Masukkan PBF Permisson Numer"},null,8,["value"])]),_:1}),i(d,{path:"pak_permisson_numer",label:"PAK Permisson Numer"},{default:l(()=>[i(Y,{style:{width:"100%"},value:a(t).pak_permisson_numer,"onUpdate:value":e[11]||(e[11]=u=>a(t).pak_permisson_numer=u),placeholder:"Masukkan PAK Permisson Numer"},null,8,["value"])]),_:1}),i(d,{label:"Setting"},{default:l(()=>[i(d,{label:"Under Maintenance"},{default:l(()=>[i(ue,{value:a(t).setting.under_maintenance,"onUpdate:value":e[12]||(e[12]=u=>a(t).setting.under_maintenance=u)},null,8,["value"])]),_:1})]),_:1}),i(d,{label:"Upload Logo","show-feedback":!1},{default:l(()=>[i(re,{action:"",onBeforeUpload:le,"show-file-list":!1,"custom-request":oe},{default:l(()=>[i(v,{loading:a(c),color:"#219653",class:"button-tnt"},{default:l(()=>[_(T(a(m)=="create"?"Upload Logo":"Ubah Logo"),1)]),_:1},8,["loading"])]),_:1})]),_:1}),a(c)?(g(),b(Q,{key:1,size:8},{default:l(()=>[i(ce,{height:"90px",width:"96px"})]),_:1})):(g(),b(de,{key:0,width:"110",src:a(t).image.url,style:{"margin-top":"10px","border-radius":"12px"}},null,8,["src"]))]),_:1},8,["model","rules"]))]),D("div",Ge,[D("div",He,[i(r,{to:{name:"setting-master-company"},class:"text-decoration-none"},{default:l(()=>[i(v,{color:"#828282",class:"button-tnt"},{default:l(()=>[_("Kembali ")]),_:1})]),_:1}),a(m)==="create"&&n.$filters.isGranted(a(M).accessPrivileges.company+".create")?(g(),b(v,{key:0,color:"#219653",class:"button-tnt",loading:a(c),onClick:J},{default:l(()=>[_(" Simpan ")]),_:1},8,["loading"])):y("",!0),a(m)==="update"&&n.$filters.isGranted(a(M).accessPrivileges.company+".update")?(g(),b(v,{key:1,color:"#219653",class:"button-tnt",loading:a(c),onClick:J},{default:l(()=>[_(" Simpan ")]),_:1},8,["loading"])):y("",!0)])])]),i(me,{show:a(o).show,"onUpdate:show":e[13]||(e[13]=u=>a(o).show=u),icon:a(o).icon,"icon-color":a(o).iconColor,"hide-icon":a(o).hideIcon,title:a(o).title,subtitle:a(o).subtitle},{default:l(()=>[i(Q,{justify:"center"},{default:l(()=>[a(o).type=="confirm"?(g(),S(B,{key:0},[i(v,{loading:a(c),color:"#828282",class:"button-tnt",onClick:h},{default:l(()=>[_(" Tutup ")]),_:1},8,["loading"]),i(v,{loading:a(c),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Ue(ae,["prevent"])},{default:l(()=>[_(" Yakin ")]),_:1},8,["loading","onClick"])],64)):y("",!0),a(o).type=="success"?(g(),S(B,{key:1},[a(m)=="create"?(g(),b(v,{key:0,color:"#828282",class:"button-tnt",onClick:h},{default:l(()=>[_(" Tambah Lainya ")]),_:1})):y("",!0),i(r,{to:{name:"setting-master-company"},class:"text-decoration-none"},{default:l(()=>[i(v,{color:"#219653",class:"button-tnt"},{default:l(()=>[_(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):y("",!0),a(o).type=="failed"?(g(),b(v,{key:2,color:"#828282",class:"button-tnt",onClick:h},{default:l(()=>[_(" Tutup ")]),_:1})):y("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),i(_e,{show:a(w).show,"onUpdate:show":e[14]||(e[14]=u=>a(w).show=u),"onClick:close":ee},null,8,["show"])],64)}}});export{oa as default};
