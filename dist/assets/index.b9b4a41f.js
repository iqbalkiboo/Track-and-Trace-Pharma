import{_ as it}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{a2 as K,a3 as rt,d as dt,E as ut,r as u,f as _t,p as pt,o as m,c as g,k as t,w as a,q as h,a as s,i as o,ah as ct,F as A,h as mt,j as C,t as _,g as ft,af as gt,am as ht,an as kt,ak as yt,I as vt,ad as bt,H as wt,aj as Pt,ae as xt,J as Ct,K as Mt,v as Nt,as as St,s as Bt,a7 as $t,a8 as At,aa as Et,ab as Kt}from"./index.21c0d750.js";import{t as E}from"./feedback.0313b46e.js";import{g as V}from"./getHoldingId.48f570fc.js";import{e as I}from"./exportFromJSON.6e5672c8.js";import{o as O}from"./option.2657b089.js";import"./getCompanyId.7d0eb93b.js";K.interceptors.request.use(rt.auth);const R={async mutationProduct(v){return v.holding_id=V,(await K.post("/report/v1/mutation/product",v,{params:{holding_id:V}})).data},async getWarehouse(v){return(await K.get("/warehouse/v1/list",{params:v})).data}},Vt={class:"body-tnt"},Tt={class:"card-tnt"},qt={key:0,class:"card-tnt"},zt={class:"card-tnt"},Ft={class:"table-tnt",style:{"margin-top":"0"}},Ut=s("thead",null,[s("tr",null,[s("th",null,"No"),s("th",null,"Principal"),s("th",null,"Kode Produk"),s("th",null,"Deskripsi Produk"),s("th",{style:{"text-align":"right"}},"Stok Awal"),s("th",{style:{"text-align":"right"}},"Stok Masuk"),s("th",{style:{"text-align":"right"}},"Stok Keluar"),s("th",{style:{"text-align":"right"}},"Stok Akhir")])],-1),Dt={"data-label":"No"},Lt={"data-label":"Principal"},Ht={"data-label":"Kode Produk"},It={"data-label":"Deskripsi Produk"},Ot={"data-label":"Stok Awal",style:{"text-align":"right"}},Rt={"data-label":"Stok Masuk",style:{"text-align":"right"}},jt={"data-label":"Stok Keluar",style:{"text-align":"right"}},Jt={"data-label":"Stok Akhir",style:{"text-align":"right"}},Wt={key:1},Gt=s("td",{colspan:"8",style:{"text-align":"center"}}," Belum ada data tersedia ",-1),Qt=[Gt],ne=dt({__name:"index",setup(v){const f=ut(),P=u(!1),p=u(!1),T=u(!1),q=u(null),n=u({}),M=u([]),N=u([]),S=u([]),b=u([]),z=u();z.value={warehouse_id:{required:!0,message:"Plant/Cabang tidak boleh kosong",trigger:["input","blur"]},company_id:{required:!0,message:"Company tidak boleh kosong",trigger:["input","blur"]},period_start:{required:!0,message:"Periode Mulai tidak boleh kosong",trigger:["input","blur"]},period_end:{required:!0,validator(r,e){if(e){if(e<n.value.period_start)return new Error("Periode Akhir tidak boleh kurang dari Periode Mulai")}else return new Error("Periode Akhir tidak boleh kosong");return!0},trigger:["input","blur"]}},_t(()=>{j()});async function j(){p.value=!0,J(),await W(),p.value=!1}async function J(){const r={limit:1e4};await O.getPrincipal(r).then(e=>{const l=e.data.list;M.value=[],l.forEach(d=>{M.value.push({key:d.name,label:d.name,value:d.id})}),E.value.show=!1}).catch(e=>{const l=e.response.data;f.error(l.message)})}async function W(){const r={limit:1e4,holding_id:V};await O.getCompany(r).then(e=>{const l=e.data.list;N.value=[],l.forEach(d=>{N.value.push({key:d.name,label:d.name,value:d.id})}),E.value.show=!1}).catch(e=>{const l=e.response.data;f.error(l.message)})}async function G(){const r={limit:1e4,company_id:n.value.company_id};await R.getWarehouse(r).then(e=>{const l=e.data.list;S.value=[],l.forEach(d=>{S.value.push({key:d.name,label:d.name,value:d.id})}),n.value.warehouse_id=null,E.value.show=!1}).catch(e=>{const l=e.response.data;f.error(l.message)})}function Q(){var r;(r=q.value)==null||r.validate().then(()=>{P.value=!0,p.value=!0;const e={product_code:n.value.product_code,principal_id:n.value.principal_id,company_id:n.value.company_id,warehouse_id:n.value.warehouse_id,period_start:n.value.period_start,period_end:n.value.period_end};R.mutationProduct(e).then(l=>{P.value=!1,p.value=!1,b.value=l.data,T.value=!0}).catch(l=>{const d=l.response.data;f.error(d.message),P.value=!1,p.value=!1})}).catch(()=>{f.error("Form tidak valid, tolong periksa kembali")})}function X(){const r=[];b.value.forEach((c,B)=>{var x;r.push({No:B+1,Principal:(x=c.principal)==null?void 0:x.name,"Kode Produk":c.product_code,"Deskripsi Produk":c.product_desc,"Stok Awal":c.stock_begin,"Stok Masuk":c.stock_in,"Stok Keluar":c.stock_out,"Stok Akhir":c.stock_final})});const e=r,l="Laporan_Mutasi_Barang",d=I.types.csv;e&&I({data:e,fileName:l,exportType:d})}function Y(){G()}return(r,e)=>{const l=gt,d=ht,c=kt,B=pt("h-3"),x=yt,k=vt,y=bt,$=wt,F=Pt,Z=xt,tt=Ct,U=Mt,w=Nt,et=it,at=St,ot=Bt,D=$t,nt=At,st=Et,lt=Kt;return m(),g("div",Vt,[t(l,{style:{"margin-bottom":"4px"}},{default:a(()=>[h("Mutasi Barang")]),_:1}),t(c,null,{default:a(()=>[t(d,null,{default:a(()=>[h("Mutasi Barang")]),_:1})]),_:1}),s("div",Tt,[t(w,{vertical:"",size:24},{default:a(()=>[t(B,{style:{"font-weight":"500","font-size":"16px"}},{default:a(()=>[h("Form Mutasi")]),_:1}),t(tt,{ref_key:"formRef",ref:q,class:"form-tnt","show-require-mark":!1,"label-width":80,model:o(n),rules:o(z)},{default:a(()=>[t(Z,{cols:"4","item-responsive":"",responsive:"screen","x-gap":"26","y-gap":"0"},{default:a(()=>[t(y,{span:"4 m:2"},{default:a(()=>[t(k,{label:"Kode Produk",path:"product_code"},{default:a(()=>[t(x,{value:o(n).product_code,"onUpdate:value":e[0]||(e[0]=i=>o(n).product_code=i),placeholder:"Masukkan Kode Produk",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),t(y,{span:"4 m:2"},{default:a(()=>[t(k,{label:"Principal",path:"principal_id"},{default:a(()=>[t($,{disabled:o(p),value:o(n).principal_id,"onUpdate:value":e[1]||(e[1]=i=>o(n).principal_id=i),options:o(M),filterable:"",placeholder:"Pilih Principal",style:{width:"100%"}},null,8,["disabled","value","options"])]),_:1})]),_:1}),t(y,{span:"4 m:2"},{default:a(()=>[t(k,{label:"Company",path:"company_id"},{default:a(()=>[t($,{disabled:o(p),value:o(n).company_id,"onUpdate:value":[e[2]||(e[2]=i=>o(n).company_id=i),Y],options:o(N),filterable:"",placeholder:"Pilih Company",style:{width:"100%"}},null,8,["disabled","value","options"])]),_:1})]),_:1}),t(y,{span:"4 m:2"},{default:a(()=>[t(k,{label:"Plant/Cabang",path:"warehouse_id"},{default:a(()=>[t($,{disabled:o(p),value:o(n).warehouse_id,"onUpdate:value":e[3]||(e[3]=i=>o(n).warehouse_id=i),options:o(S),filterable:"",placeholder:"Pilih Plant/Cabang",style:{width:"100%"}},null,8,["disabled","value","options"])]),_:1})]),_:1}),t(y,{span:"4 m:1"},{default:a(()=>[t(k,{label:"Periode Mulai",path:"period_start"},{default:a(()=>[t(F,{"formatted-value":o(n).period_start,"onUpdate:formattedValue":e[4]||(e[4]=i=>o(n).period_start=i),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1}),t(y,{span:"4 m:1"},{default:a(()=>[t(k,{label:"Periode Akhir",path:"period_end"},{default:a(()=>[t(F,{"formatted-value":o(n).period_end,"onUpdate:formattedValue":e[5]||(e[5]=i=>o(n).period_end=i),"value-format":"yyyy-MM-dd",type:"date",placeholder:"Tentukan Tanggal",style:{width:"100%"}},null,8,["formatted-value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),t(w,{justify:"center"},{default:a(()=>[t(U,{loading:o(p),type:"primary",class:"button-tnt",onClick:ct(Q,["prevent"])},{default:a(()=>[h(" Cari ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),o(P)?(m(),g("div",qt,[t(et)])):(m(),g(A,{key:1},[o(T)?(m(),g(A,{key:0},[t(w,{vertical:"",size:0,style:{"margin-top":"24px"}},{default:a(()=>[t(at,{style:{"font-weight":"500","font-size":"16px","margin-bottom":"0"}},{default:a(()=>[h(" Laporan Mutasi Barang ")]),_:1}),t(nt,{gutter:"16",style:{"margin-top":"14px"}},{default:a(()=>[t(D,{span:12},{default:a(()=>[t(w,{vertical:"",size:0},{default:a(()=>[C("",!0),C("",!0),t(ot,null,{default:a(()=>[h("Periode : "+_(o(n).period_start)+" - "+_(o(n).period_end),1)]),_:1})]),_:1})]),_:1}),t(D,{span:12},{default:a(()=>[o(b).length>0?(m(),mt(w,{key:0,vertical:"",size:0,align:"end"},{default:a(()=>[t(U,{type:"primary",class:"button-tnt",onClick:X},{default:a(()=>[h(" Export Csv ")]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1})]),_:1}),s("div",zt,[s("div",Ft,[t(lt,{"x-scrollable":""},{default:a(()=>[t(st,{"single-line":!1},{default:a(()=>[Ut,s("tbody",null,[o(b).length>0?(m(!0),g(A,{key:0},ft(o(b),(i,L)=>{var H;return m(),g("tr",{key:L},[s("td",Dt,_(L+1),1),s("td",Lt,_((H=i.principal)==null?void 0:H.name),1),s("td",Ht,_(i.product_code),1),s("td",It,_(i.product_desc),1),s("td",Ot,_(r.$filters.toNumber(i.stock_begin)),1),s("td",Rt,_(r.$filters.toNumber(i.stock_in)),1),s("td",jt,_(r.$filters.toNumber(i.stock_out)),1),s("td",Jt,_(r.$filters.toNumber(i.stock_final)),1)])}),128)):(m(),g("tr",Wt,Qt))])]),_:1})]),_:1})])])],64)):C("",!0)],64))])}}});export{ne as default};
