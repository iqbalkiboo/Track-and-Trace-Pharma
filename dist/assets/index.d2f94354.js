import{_ as fe}from"./t-permission-modal.bdf6acbc.js";import{_ as he}from"./t-feedback.vue_vue_type_script_setup_true_lang.83eb0b14.js";import{_ as ve}from"./t-loading.vue_vue_type_script_setup_true_lang.71bf4981.js";import{d as ge,b as ke,u as _e,E as be,e as ye,r as c,Q as Y,N as we,a1 as Ue,f as Ce,aF as Q,p as Ee,o as f,c as N,a as S,k as n,w as i,q as h,t as X,i as t,h as _,j as g,aY as xe,aZ as Ae,F as V,ah as Pe,af as Ie,am as Te,an as Ne,ak as Se,I as Fe,s as He,K as Me,H as qe,J as Re,v as Be}from"./index.21c0d750.js";import{c as F}from"./constant.549d5c21.js";import{m as E}from"./master-user.75b9491b.js";import{a as De}from"./hak-akses.99e628b7.js";import{m as Ve}from"./master-warehouse.353b4b3b.js";import{g as Ke}from"./getSuperholdingId.94511ad9.js";import{g as $e}from"./getHoldingId.48f570fc.js";import{g as Oe}from"./getCompanyId.7d0eb93b.js";import{A as We}from"./Add.4f3b52cf.js";import{C as ze}from"./CheckmarkCircleOutline.8fddcae1.js";import{A as Ge}from"./AlertCircleOutline.19cf574c.js";const Ze={class:"body-tnt"},Je={class:"card-tnt"},je={key:0},Le={class:"bottom-action-button"},Ye={class:"action-item"},fa=ge({__name:"index",setup(Qe){const H=ke(),ee=_e(),b=be(),A=ye.getAuth(),P=c(!1),K=c(""),m=c(""),M=c([{key:"add",value:"add",label:()=>Y("span",{style:{color:"#0B8F9D",fontWeight:600}},[Y(we,{component:We}),"Tambah Hak Akses"])}]),$=c([]),ae=[{label:"Aktif",value:1},{label:"Tidak Aktif",value:0}],x=c({show:!1}),O=c(null),s=c({status:1}),I=c(!0),l=c({show:c(!1),icon:Ue(),iconColor:"",hideIcon:!1,title:"",subtitle:"",type:""}),q=Ke,R=$e,B=Oe;Ce(()=>{H.params.crud=="create"?(m.value="create",Q.isGranted(F.accessPrivileges.user+".create")?W():x.value.show=!0):(m.value="update",Q.isGranted(F.accessPrivileges.user+".update")?W():x.value.show=!0)});function te(){x.value.show=!1}async function W(){if(m.value=="update"){P.value=!0;const a=H.params.id;A.xxtype=="5up3r4dm1n"&&await z(),await G(),await E.getDetailUser(a).then(e=>{oe(e.data),P.value=!1}).catch(e=>{P.value=!1;const o=e.response.data;b.error(o.message)})}else A.xxtype=="5up3r4dm1n"&&await z(),await G()}async function z(){s.value.access=null;const a={limit:1e3};await De.getRoleType(a).then(e=>{e.data.list.forEach(r=>{M.value.push({key:r.key,value:r.id,label:r.name})})}).catch(e=>{const o=e.response.data;b.error(o.message)})}async function G(){s.value.plant=null;const a={limit:1e3};await Ve.getWarehouse(a).then(e=>{e.data.list.forEach(r=>{$.value.push({key:r.key,value:r.id,label:r.name})})}).catch(e=>{const o=e.response.data;b.error(o.message)})}async function Z(a){const e={limit:1e3};a==="company"?(y.value=[],await E.getCompany(e).then(o=>{o.data.list.forEach(u=>{y.value.push({key:u.name,value:u.id,label:u.name})})}).catch(o=>{const r=o.response.data;b.error(r.message)})):a==="holding"?(y.value=[],await E.getHolding(e).then(o=>{o.data.list.forEach(u=>{y.value.push({key:u.name,value:u.id,label:u.name})})}).catch(o=>{const r=o.response.data;b.error(r.message)})):(y.value=[],E.getSuperHolding(e).then(o=>{o.data.list.forEach(u=>{y.value.push({key:u.name,value:u.id,label:u.name})})}).catch(o=>{const r=o.response.data;b.error(r.message)}))}const D=c(),p=c({id:"",key:"",label:""}),y=c([]);async function se(a,e){a=="add"?ee.push({path:"/setting/hak-akses/create/1"}):(s.value.roleUser=null,p.value.id=e.value,p.value.label=e.label,p.value.key=e.key,await Z(e.key),p.value.key==="superholding"?s.value.roleUser=q:p.value.key==="holding"?s.value.roleUser=R:p.value.key==="company"&&(s.value.roleUser=B))}async function J(a){var e;a.preventDefault(),await((e=O.value)==null?void 0:e.validate().then(()=>{re()}).catch(()=>{b.error("Form tidak valid, tolong periksa kembali")}))}const w=c(!1);function le(){w.value=!0;const a=new FormData;if(a.append("name",s.value.name),a.append("username",s.value.username),a.append("email",s.value.email),a.append("position",s.value.position),A.xxtype=="5up3r4dm1n"&&(a.append("roles",s.value.access),a.append("role_user_type_id",s.value.roleUser)),p.value.key!=="company"&&p.value.key!=="holding"&&p.value.key!=="superholding"&&a.append("phone",s.value.phone),a.append("status",s.value.status),a.append("erp_code",s.value.erpCode),s.value.plant.forEach(e=>{a.append("warehouse_id[]",e)}),m.value=="create"){let e={};p.value.key==="superholding"?(a.append("superholding_id",q),e.superholding_id=q):p.value.key==="holding"?(a.append("holding_id",R),e.holding_id=R):(a.append("company_id",B),e.company_id=B),E.createUser(a,e).then(()=>{w.value=!1,ne(),U(),setTimeout(()=>{j()},300)}).catch(o=>{const r=o.response.data;w.value=!1,U(),setTimeout(()=>{L(r)},300)})}else{let e={};s.value.roleSlug==="superholding"?(a.append("superholding_id",s.value.roleId),e.superholding_id=s.value.roleId):s.value.roleSlug==="holding"?(a.append("holding_id",s.value.roleId),e.holding_id=s.value.roleId):(a.append("company_id",s.value.roleId),e.company_id=s.value.roleId);const o=H.params.id;E.updateUser(o,a,e).then(()=>{w.value=!1,U(),setTimeout(()=>{j()},300)}).catch(r=>{const u=r.response.data;w.value=!1,U(),setTimeout(()=>{L(u)},300)})}}function oe(a){var o,r;A.xxtype=="5up3r4dm1n"&&M.value.forEach(async u=>{u.label==a.role.name&&(p.value.id=u.value,p.value.key=u.key,p.value.label=u.label,await Z(p.value.key),s.value.roleUser=a.user_type.id,s.value.access=p.value.id)});const e=c([]);a.warehouses.forEach(u=>{e.value.push(u.id)}),s.value={name:a.name,username:a.username,email:a.email,phone:a.phone,position:a.position,plant:e.value,is_verified_email:a.is_verified_email?a.is_verified_email:!0,password:"Admin123!",confirmPassword:"Admin123!",erpCode:a.erp_code,status:a.status.value,roleId:(o=a==null?void 0:a.role)==null?void 0:o.id,roleSlug:(r=a==null?void 0:a.role)==null?void 0:r.slug},K.value=a.email,p.value.key=a.user_type.kind}function ne(){s.value={name:"",username:"",email:"",phone:"",position:"",access:null,roleUser:null,plant:null,password:"",confirmPassword:"",erpCode:"",status:1}}function U(){l.value.show=!1}function re(){l.value.type="confirm",l.value.hideIcon=!0,l.value.title="Konfirmasi",m.value=="create"?l.value.subtitle="Apakah Anda yakin untuk menambah data user?":l.value.subtitle="Apakah Anda yakin untuk mengubah data user?",l.value.show=!0}function j(){l.value.type="success",l.value.hideIcon=!1,l.value.iconColor="#219653",l.value.icon=ze,m.value=="create"?(l.value.title="Berhasil Tambah Data",l.value.subtitle="Data user berhasil ditambahkan"):(l.value.title="Berhasil Ubah Data",l.value.subtitle="Data user berhasil diubah"),l.value.show=!0}function L(a){l.value.type="failed",l.value.hideIcon=!1,l.value.iconColor="#EB5757",l.value.icon=Ge,l.value.title="Gagal",Object.keys(a.validation).length>0?l.value.subtitle=a.validation:l.value.subtitle=a.message,l.value.show=!0}return D.value={name:{required:!0,message:"Nama user tidak boleh kosong",trigger:["input","blur"]},username:{required:!0,validator(a,e){const o=/\s/;if(e){if(e.match(o))return new Error("Username tidak boleh menggunakan spasi")}else return new Error("Username tidak boleh kosong");return!0},trigger:["input","blur"]},email:{required:!0,validator(a,e){const o=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;if(e){if(!e.match(o))return new Error("Email tidak valid")}else return new Error("Email tidak boleh kosong");return!0},trigger:["input","blur"]},phone:{required:!0,validator(a,e){if(e)if(/^\d*$/.test(e)){if(e.length<8)return new Error("No. Hp kurang dari 8 angka")}else return new Error("No. Hp harus angka");else return new Error("No. Hp tidak boleh kosong");return!0},trigger:["input","blur"]},position:{required:!0,message:"Jabatan tidak boleh kosong",trigger:["input","blur"]},access:{required:!0,message:"Hak akses tidak boleh kosong",trigger:["input","blur"]},roleUser:{required:!0,message:"Kolom tidak boleh kosong",trigger:["input","blur"]},plant:{type:"array",required:!0,message:"Nama plant/cabang tidak boleh kosong",trigger:["input","blur"]},password:{required:!0,validator(a,e){const o=/[a-z]/g,r=/[A-Z]/g,u=/[0-9]/g;if(e)if(e.match(o))if(e.match(r))if(e.match(u)){if(e.length<4)return new Error("Password minimal 4 karakter")}else return new Error("Password minimal 1 angka");else return new Error("Password minimal 1 huruf besar");else return new Error("Password minimal 1 huruf kecil");else return new Error("Password tidak boleh kosong");return!0},trigger:["input","blur"]},confirmPassword:{required:!0,validator(a,e){if(e){if(e!==s.value.password)return new Error("Konfirmasi password harus sama dengan password")}else return new Error("Konfirmasi password tidak boleh kosong");return!0},trigger:["input","blur"]},erpCode:{required:!0,message:"Kode ERP tidak boleh kosong",trigger:["input","blur"]},status:{type:"number",required:!0,message:"Status tidak boleh kosong",trigger:["input","blur"]}},(a,e)=>{const o=Ie,r=Ee("router-link"),u=Te,ie=Ne,ue=ve,C=Se,v=Fe,Xe=He,k=Me,T=qe,de=Re,pe=Be,ce=he,me=fe;return f(),N(V,null,[S("div",Ze,[n(o,{style:{"margin-bottom":"4px"}},{default:i(()=>[h(X(t(m)=="create"?"Tambah User":"Edit User"),1)]),_:1}),n(ie,null,{default:i(()=>[n(u,null,{default:i(()=>[n(r,{to:"/setting/master-user",class:"text-decoration-none"},{default:i(()=>[h(" Master User ")]),_:1})]),_:1}),n(u,null,{default:i(()=>[h(X(t(m)=="create"?"Tambah User":"Edit User"),1)]),_:1})]),_:1}),S("div",Je,[t(P)?(f(),_(ue,{key:0})):(f(),_(de,{key:1,ref_key:"formRef",ref:O,class:"form-tnt",model:t(s),rules:t(D),"show-require-mark":!1},{default:i(()=>[n(v,{path:"name",label:"Nama User"},{default:i(()=>[n(C,{value:t(s).name,"onUpdate:value":e[0]||(e[0]=d=>t(s).name=d),placeholder:"Masukkan Nama User"},null,8,["value"])]),_:1}),n(v,{path:"username",label:"Username"},{default:i(()=>[n(C,{disabled:t(m)==="update",value:t(s).username,"onUpdate:value":e[1]||(e[1]=d=>t(s).username=d),placeholder:"Masukkan Username"},null,8,["disabled","value"])]),_:1}),n(v,{path:"email",label:"Email"},{default:i(()=>[n(C,{readonly:t(I),onFocus:e[2]||(e[2]=d=>I.value=!1),value:t(s).email,"onUpdate:value":e[3]||(e[3]=d=>t(s).email=d),placeholder:"Masukkan Email"},null,8,["readonly","value"])]),_:1}),t(D).email.validator("required",t(s).email)==!0&&t(m)=="update"&&!t(s).is_verified_email||t(s).email!=t(K)?(f(),N("div",je,[g("",!0),g("",!0)])):g("",!0),n(v,{path:"position",label:"Jabatan"},{default:i(()=>[n(C,{value:t(s).position,"onUpdate:value":e[4]||(e[4]=d=>t(s).position=d),placeholder:"Masukkan Jabatan"},null,8,["value"])]),_:1}),n(v,{path:"access",label:"Hak Akses"},{default:i(()=>[n(T,{disabled:t(m)==="update",value:t(s).access,"onUpdate:value":[e[5]||(e[5]=d=>t(s).access=d),se],options:t(M),placeholder:"Tentukan Hak Akses"},null,8,["disabled","value","options"])]),_:1}),t(p).key==="company"||t(p).key==="holding"||t(p).key==="superholding"?xe((f(),_(v,{key:1,path:"roleUser",label:t(p).label},{default:i(()=>[n(T,{disabled:"",value:t(s).roleUser,"onUpdate:value":e[6]||(e[6]=d=>t(s).roleUser=d),options:t(y),placeholder:t(p).label},null,8,["value","options","placeholder"])]),_:1},8,["label"])),[[Ae,t(p).id]]):(f(),_(v,{key:2,path:"phone",label:"Phone"},{default:i(()=>[n(C,{readonly:t(I),onFocus:e[7]||(e[7]=d=>I.value=!1),value:t(s).phone,"onUpdate:value":e[8]||(e[8]=d=>t(s).phone=d),placeholder:"Masukkan Phone"},null,8,["readonly","value"])]),_:1})),n(v,{path:"plant",label:"Nama Plant/Cabang"},{default:i(()=>[n(T,{filterable:"",multiple:"",value:t(s).plant,"onUpdate:value":e[9]||(e[9]=d=>t(s).plant=d),options:t($),placeholder:"Pilih Plant/Cabang",style:{width:"100%"}},null,8,["value","options"])]),_:1}),n(v,{label:"Kode ERP",path:"erpCode"},{default:i(()=>[n(C,{value:t(s).erpCode,"onUpdate:value":e[10]||(e[10]=d=>t(s).erpCode=d),placeholder:"Masukkan kode ERP"},null,8,["value"])]),_:1}),n(v,{path:"status",label:"Status"},{default:i(()=>[n(T,{value:t(s).status,"onUpdate:value":e[11]||(e[11]=d=>t(s).status=d),options:ae,placeholder:"Pilih Status User",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model","rules"]))]),S("div",Le,[S("div",Ye,[n(r,{to:{name:"setting-master-user"},class:"text-decoration-none"},{default:i(()=>[n(k,{color:"#828282",class:"button-tnt"},{default:i(()=>[h("Kembali ")]),_:1})]),_:1}),t(m)==="create"&&a.$filters.isGranted(t(F).accessPrivileges.user+".create")?(f(),_(k,{key:0,color:"#219653",class:"button-tnt",onClick:J},{default:i(()=>[h(" Simpan ")]),_:1})):g("",!0),t(m)==="update"&&a.$filters.isGranted(t(F).accessPrivileges.user+".update")?(f(),_(k,{key:1,color:"#219653",class:"button-tnt",onClick:J},{default:i(()=>[h(" Simpan ")]),_:1})):g("",!0)])])]),n(ce,{show:t(l).show,"onUpdate:show":e[12]||(e[12]=d=>t(l).show=d),icon:t(l).icon,"icon-color":t(l).iconColor,"hide-icon":t(l).hideIcon,title:t(l).title,subtitle:t(l).subtitle},{default:i(()=>[n(pe,{justify:"center"},{default:i(()=>[t(l).type=="confirm"?(f(),N(V,{key:0},[n(k,{loading:t(w),color:"#828282",class:"button-tnt",onClick:U},{default:i(()=>[h(" Tutup ")]),_:1},8,["loading"]),n(k,{loading:t(w),color:"#219653",class:"button-tnt",style:{"padding-left":"25px","padding-right":"25px"},onClick:Pe(le,["prevent"])},{default:i(()=>[h(" Yakin ")]),_:1},8,["loading","onClick"])],64)):g("",!0),t(l).type=="success"?(f(),N(V,{key:1},[t(m)=="create"?(f(),_(k,{key:0,color:"#828282",class:"button-tnt",onClick:U},{default:i(()=>[h(" Tambah Lainya ")]),_:1})):g("",!0),n(r,{to:{name:"setting-master-user"},class:"text-decoration-none"},{default:i(()=>[n(k,{color:"#219653",class:"button-tnt"},{default:i(()=>[h(" Kembali ke Beranda ")]),_:1})]),_:1})],64)):g("",!0),t(l).type=="failed"?(f(),_(k,{key:2,color:"#828282",class:"button-tnt",onClick:U},{default:i(()=>[h(" Tutup ")]),_:1})):g("",!0)]),_:1})]),_:1},8,["show","icon","icon-color","hide-icon","title","subtitle"]),n(me,{show:t(x).show,"onUpdate:show":e[13]||(e[13]=d=>t(x).show=d),"onClick:close":te},null,8,["show"])],64)}}});export{fa as default};
